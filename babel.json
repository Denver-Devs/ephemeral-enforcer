{
  "/usr/src/app/test/spec/endpoints.test.js:{}:4.7.16": {
    "code": "/* global describe it before after afterEach */\n\n\"use strict\";\n\nvar app = require(\"../../\");\nvar nock = require(\"nock\");\n\n/**\n * Mock the commands because all we are testing is that they get run.\n */\nvar commands = {\n  on: function commandOn() {\n    return Promise.resolve(\"On ran.\");\n  },\n  off: function commandOff() {\n    return Promise.resolve(\"Off ran.\");\n  },\n  level: function commandLevel() {\n    return Promise.resolve(\"level ran\");\n  }\n};\nvar request = require(\"supertest\")(app(commands));\n\ndescribe(\"POST /ephemeral\", function () {\n  before(function () {\n    // nock.recorder.rec()\n    nock.enableNetConnect(/^.*127\\.0\\.0\\.1.*$/);\n  });\n\n  after(function () {\n    // nock.recorder.play()\n    nock.disableNetConnect(/^.*127\\.0\\.0\\.1.*$/);\n  });\n\n  afterEach(function () {\n    nock.cleanAll();\n  });\n\n  it(\"should respond 200 to supported commands\", function (done) {\n    var body = \"command=/ephemeral&text=on\";\n    request.post(\"/ephemeral\").send(body).expect(200, done);\n  });\n\n  it(\"should respond 400 to unsupported commands\", function (done) {\n    var body = \"command=/ephemeral&text=butts\";\n    request.post(\"/ephemeral\").send(body).expect(400, done);\n  });\n});\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi91c3Ivc3JjL2FwcC90ZXN0L3NwZWMvZW5kcG9pbnRzLnRlc3QuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUVBLElBQUksR0FBRyxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQTtBQUMzQixJQUFJLElBQUksR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUE7Ozs7O0FBSzFCLElBQUksUUFBUSxHQUFHO0FBQ2IsTUFBTSxTQUFTLFNBQVMsR0FBSTtBQUMxQixXQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUE7R0FDbEM7QUFDRCxPQUFPLFNBQVMsVUFBVSxHQUFJO0FBQzVCLFdBQU8sT0FBTyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQTtHQUNuQztBQUNELFNBQVMsU0FBUyxZQUFZLEdBQUk7QUFDaEMsV0FBTyxPQUFPLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFBO0dBQ3BDO0NBQ0YsQ0FBQTtBQUNELElBQUksT0FBTyxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQTs7QUFFakQsUUFBUSxDQUFDLGlCQUFpQixFQUFFLFlBQVk7QUFDdEMsUUFBTSxDQUFDLFlBQVk7O0FBRWpCLFFBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFBO0dBRTVDLENBQUMsQ0FBQTs7QUFFRixPQUFLLENBQUMsWUFBWTs7QUFFaEIsUUFBSSxDQUFDLGlCQUFpQixDQUFDLG9CQUFvQixDQUFDLENBQUE7R0FDN0MsQ0FBQyxDQUFBOztBQUVGLFdBQVMsQ0FBQyxZQUFZO0FBQ3BCLFFBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQTtHQUNoQixDQUFDLENBQUE7O0FBRUYsSUFBRSxDQUFDLDBDQUEwQyxFQUFFLFVBQVUsSUFBSSxFQUFFO0FBQzdELFFBQUksSUFBSSwrQkFBK0IsQ0FBQTtBQUN2QyxXQUFPLENBQ0osSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUNsQixJQUFJLENBQUMsSUFBSSxDQUFDLENBQ1YsTUFBTSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsQ0FBQTtHQUNyQixDQUFDLENBQUE7O0FBRUYsSUFBRSxDQUFDLDRDQUE0QyxFQUFFLFVBQVUsSUFBSSxFQUFFO0FBQy9ELFFBQUksSUFBSSxrQ0FBa0MsQ0FBQTtBQUMxQyxXQUFPLENBQ0osSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUNsQixJQUFJLENBQUMsSUFBSSxDQUFDLENBQ1YsTUFBTSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsQ0FBQTtHQUNyQixDQUFDLENBQUE7Q0FDSCxDQUFDLENBQUEiLCJmaWxlIjoiL3Vzci9zcmMvYXBwL3Rlc3Qvc3BlYy9lbmRwb2ludHMudGVzdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGdsb2JhbCBkZXNjcmliZSBpdCBiZWZvcmUgYWZ0ZXIgYWZ0ZXJFYWNoICovXG5cbnZhciBhcHAgPSByZXF1aXJlKCcuLi8uLi8nKVxudmFyIG5vY2sgPSByZXF1aXJlKCdub2NrJylcblxuLyoqXG4gKiBNb2NrIHRoZSBjb21tYW5kcyBiZWNhdXNlIGFsbCB3ZSBhcmUgdGVzdGluZyBpcyB0aGF0IHRoZXkgZ2V0IHJ1bi5cbiAqL1xubGV0IGNvbW1hbmRzID0ge1xuICAnb24nOiBmdW5jdGlvbiBjb21tYW5kT24gKCkge1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoJ09uIHJhbi4nKVxuICB9LFxuICAnb2ZmJzogZnVuY3Rpb24gY29tbWFuZE9mZiAoKSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgnT2ZmIHJhbi4nKVxuICB9LFxuICAnbGV2ZWwnOiBmdW5jdGlvbiBjb21tYW5kTGV2ZWwgKCkge1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoJ2xldmVsIHJhbicpXG4gIH1cbn1cbnZhciByZXF1ZXN0ID0gcmVxdWlyZSgnc3VwZXJ0ZXN0JykoYXBwKGNvbW1hbmRzKSlcblxuZGVzY3JpYmUoJ1BPU1QgL2VwaGVtZXJhbCcsIGZ1bmN0aW9uICgpIHtcbiAgYmVmb3JlKGZ1bmN0aW9uICgpIHtcbiAgICAvLyBub2NrLnJlY29yZGVyLnJlYygpXG4gICAgbm9jay5lbmFibGVOZXRDb25uZWN0KC9eLioxMjdcXC4wXFwuMFxcLjEuKiQvKVxuXG4gIH0pXG5cbiAgYWZ0ZXIoZnVuY3Rpb24gKCkge1xuICAgIC8vIG5vY2sucmVjb3JkZXIucGxheSgpXG4gICAgbm9jay5kaXNhYmxlTmV0Q29ubmVjdCgvXi4qMTI3XFwuMFxcLjBcXC4xLiokLylcbiAgfSlcblxuICBhZnRlckVhY2goZnVuY3Rpb24gKCkge1xuICAgIG5vY2suY2xlYW5BbGwoKVxuICB9KVxuXG4gIGl0KCdzaG91bGQgcmVzcG9uZCAyMDAgdG8gc3VwcG9ydGVkIGNvbW1hbmRzJywgZnVuY3Rpb24gKGRvbmUpIHtcbiAgICB2YXIgYm9keSA9IGBjb21tYW5kPS9lcGhlbWVyYWwmdGV4dD1vbmBcbiAgICByZXF1ZXN0XG4gICAgICAucG9zdCgnL2VwaGVtZXJhbCcpXG4gICAgICAuc2VuZChib2R5KVxuICAgICAgLmV4cGVjdCgyMDAsIGRvbmUpXG4gIH0pXG5cbiAgaXQoJ3Nob3VsZCByZXNwb25kIDQwMCB0byB1bnN1cHBvcnRlZCBjb21tYW5kcycsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgdmFyIGJvZHkgPSBgY29tbWFuZD0vZXBoZW1lcmFsJnRleHQ9YnV0dHNgXG4gICAgcmVxdWVzdFxuICAgICAgLnBvc3QoJy9lcGhlbWVyYWwnKVxuICAgICAgLnNlbmQoYm9keSlcbiAgICAgIC5leHBlY3QoNDAwLCBkb25lKVxuICB9KVxufSlcbiJdfQ==",
    "map": {
      "version": 3,
      "sources": [
        "/usr/src/app/test/spec/endpoints.test.js"
      ],
      "names": [],
      "mappings": ";;;;AAEA,IAAI,GAAG,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAA;AAC3B,IAAI,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAA;;;;;AAK1B,IAAI,QAAQ,GAAG;AACb,MAAM,SAAS,SAAS,GAAI;AAC1B,WAAO,OAAO,CAAC,OAAO,CAAC,SAAS,CAAC,CAAA;GAClC;AACD,OAAO,SAAS,UAAU,GAAI;AAC5B,WAAO,OAAO,CAAC,OAAO,CAAC,UAAU,CAAC,CAAA;GACnC;AACD,SAAS,SAAS,YAAY,GAAI;AAChC,WAAO,OAAO,CAAC,OAAO,CAAC,WAAW,CAAC,CAAA;GACpC;CACF,CAAA;AACD,IAAI,OAAO,GAAG,OAAO,CAAC,WAAW,CAAC,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAA;;AAEjD,QAAQ,CAAC,iBAAiB,EAAE,YAAY;AACtC,QAAM,CAAC,YAAY;;AAEjB,QAAI,CAAC,gBAAgB,CAAC,oBAAoB,CAAC,CAAA;GAE5C,CAAC,CAAA;;AAEF,OAAK,CAAC,YAAY;;AAEhB,QAAI,CAAC,iBAAiB,CAAC,oBAAoB,CAAC,CAAA;GAC7C,CAAC,CAAA;;AAEF,WAAS,CAAC,YAAY;AACpB,QAAI,CAAC,QAAQ,EAAE,CAAA;GAChB,CAAC,CAAA;;AAEF,IAAE,CAAC,0CAA0C,EAAE,UAAU,IAAI,EAAE;AAC7D,QAAI,IAAI,+BAA+B,CAAA;AACvC,WAAO,CACJ,IAAI,CAAC,YAAY,CAAC,CAClB,IAAI,CAAC,IAAI,CAAC,CACV,MAAM,CAAC,GAAG,EAAE,IAAI,CAAC,CAAA;GACrB,CAAC,CAAA;;AAEF,IAAE,CAAC,4CAA4C,EAAE,UAAU,IAAI,EAAE;AAC/D,QAAI,IAAI,kCAAkC,CAAA;AAC1C,WAAO,CACJ,IAAI,CAAC,YAAY,CAAC,CAClB,IAAI,CAAC,IAAI,CAAC,CACV,MAAM,CAAC,GAAG,EAAE,IAAI,CAAC,CAAA;GACrB,CAAC,CAAA;CACH,CAAC,CAAA",
      "file": "/usr/src/app/test/spec/endpoints.test.js",
      "sourcesContent": [
        "/* global describe it before after afterEach */\n\nvar app = require('../../')\nvar nock = require('nock')\n\n/**\n * Mock the commands because all we are testing is that they get run.\n */\nlet commands = {\n  'on': function commandOn () {\n    return Promise.resolve('On ran.')\n  },\n  'off': function commandOff () {\n    return Promise.resolve('Off ran.')\n  },\n  'level': function commandLevel () {\n    return Promise.resolve('level ran')\n  }\n}\nvar request = require('supertest')(app(commands))\n\ndescribe('POST /ephemeral', function () {\n  before(function () {\n    // nock.recorder.rec()\n    nock.enableNetConnect(/^.*127\\.0\\.0\\.1.*$/)\n\n  })\n\n  after(function () {\n    // nock.recorder.play()\n    nock.disableNetConnect(/^.*127\\.0\\.0\\.1.*$/)\n  })\n\n  afterEach(function () {\n    nock.cleanAll()\n  })\n\n  it('should respond 200 to supported commands', function (done) {\n    var body = `command=/ephemeral&text=on`\n    request\n      .post('/ephemeral')\n      .send(body)\n      .expect(200, done)\n  })\n\n  it('should respond 400 to unsupported commands', function (done) {\n    var body = `command=/ephemeral&text=butts`\n    request\n      .post('/ephemeral')\n      .send(body)\n      .expect(400, done)\n  })\n})\n"
      ]
    },
    "ast": null,
    "mtime": 1429488306194
  },
  "/usr/src/app/index.js:{}:4.7.16": {
    "code": "\"use strict\";\n\nvar _interopRequire = function (obj) { return obj && obj.__esModule ? obj[\"default\"] : obj; };\n\nvar http = _interopRequire(require(\"http\"));\n\nvar finalhandler = _interopRequire(require(\"finalhandler\"));\n\nvar Router = _interopRequire(require(\"router\"));\n\nvar _ = _interopRequire(require(\"lodash-fp\"));\n\nvar body = _interopRequire(require(\"body/form\"));\n\nvar debug = _interopRequire(require(\"debug\"));\n\nvar error = debug(\"ephembot:index\");\nvar log = debug(\"ephembot:index\");\n// Make logs go to stdout instead of stderr\nlog.log = console.log.bind(console);\n\nfunction parseBody(req, res, next) {\n  body(req, function (err, body) {\n    if (err) {\n      error(\"err:\", err);\n      req.body = null;\n      return next();\n    }\n    req.body = body;\n    next();\n  });\n}\n\n// Injected dependencies\nexports = module.exports = function (commands) {\n  var router = Router();\n\n  /**\n   * This route should be given to slack as the endpoint to which to send\n   * `/ephemeral` data.\n   */\n  router.post(\"/ephemeral\", parseBody, function (req, res) {\n    log(\"POST /ephemeral\");\n\n    // grab the payload.\n    var payload = req.body || { text: \"\" };\n    log(\"body\", payload);\n\n    /**\n     * grab the command function from the commands object\n     */\n    var run = commands[payload.text.split(\" \")[0]];\n\n    /**\n     * If the command doesn't exist bail and let the client know\n     */\n    if (!run) {\n      res.statusCode = 400;\n      return res.end(\"That command is not implemented\");\n    }\n\n    /**\n     * run the command function passing in the payload from slack\n     */\n    run(payload).then(function (resp) {\n      res.statusCode = 200;\n      res.end(resp);\n    })[\"catch\"](function (e) {\n      res.statusCode = 500;\n      res.end(\"\" + e.message + \"\\n\" + e.stack);\n    });\n  });\n\n  /**\n   * All other routes respond with a message to the user to use `/ephemeral`\n   */\n  router.all(\"*\", function (req, res) {\n    log(req.method);\n    res.end(\"Send POST requests to /ephemeral please and thanks\");\n  });\n\n  /**\n   * Create the server and pass the req and res through the router\n   */\n  var app = http.createServer(function (req, res) {\n    router(req, res, finalhandler(req, res));\n  });\n\n  return app;\n};\nexports[\"@require\"] = [\"commands\"];\n//# sourceMappingURL=data:application/json;base64,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QUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUE7R0FDekMsQ0FBQyxDQUFBOztBQUVGLFNBQU8sR0FBRyxDQUFBO0NBQ1gsQ0FBQTtBQUNELE9BQU8sQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFFLFVBQVUsQ0FBRSxDQUFBIiwiZmlsZSI6Ii91c3Ivc3JjL2FwcC9pbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBodHRwIGZyb20gJ2h0dHAnXG5pbXBvcnQgZmluYWxoYW5kbGVyIGZyb20gJ2ZpbmFsaGFuZGxlcidcbmltcG9ydCBSb3V0ZXIgZnJvbSAncm91dGVyJ1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoLWZwJ1xuaW1wb3J0IGJvZHkgZnJvbSAnYm9keS9mb3JtJ1xuaW1wb3J0IGRlYnVnIGZyb20gJ2RlYnVnJ1xuXG52YXIgZXJyb3IgPSBkZWJ1ZygnZXBoZW1ib3Q6aW5kZXgnKVxudmFyIGxvZyA9IGRlYnVnKCdlcGhlbWJvdDppbmRleCcpXG4vLyBNYWtlIGxvZ3MgZ28gdG8gc3Rkb3V0IGluc3RlYWQgb2Ygc3RkZXJyXG5sb2cubG9nID0gY29uc29sZS5sb2cuYmluZChjb25zb2xlKVxuXG5mdW5jdGlvbiBwYXJzZUJvZHkgKHJlcSwgcmVzLCBuZXh0KSB7XG4gIGJvZHkocmVxLCBmdW5jdGlvbiAoZXJyLCBib2R5KSB7XG4gICAgaWYgKGVycikge1xuICAgICAgZXJyb3IoJ2VycjonLCBlcnIpXG4gICAgICByZXEuYm9keSA9IG51bGxcbiAgICAgIHJldHVybiBuZXh0KClcbiAgICB9XG4gICAgcmVxLmJvZHkgPSBib2R5XG4gICAgbmV4dCgpXG4gIH0pXG59XG5cbi8vIEluamVjdGVkIGRlcGVuZGVuY2llc1xuZXhwb3J0cyA9IG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGNvbW1hbmRzKSB7XG4gIHZhciByb3V0ZXIgPSBSb3V0ZXIoKVxuXG4gIC8qKlxuICAgKiBUaGlzIHJvdXRlIHNob3VsZCBiZSBnaXZlbiB0byBzbGFjayBhcyB0aGUgZW5kcG9pbnQgdG8gd2hpY2ggdG8gc2VuZFxuICAgKiBgL2VwaGVtZXJhbGAgZGF0YS5cbiAgICovXG4gIHJvdXRlci5wb3N0KCcvZXBoZW1lcmFsJywgcGFyc2VCb2R5LCBmdW5jdGlvbiAocmVxLCByZXMpIHtcbiAgICBsb2coJ1BPU1QgL2VwaGVtZXJhbCcpXG5cbiAgICAvLyBncmFiIHRoZSBwYXlsb2FkLlxuICAgIGxldCBwYXlsb2FkID0gcmVxLmJvZHkgfHwgeyB0ZXh0OiAnJyB9XG4gICAgbG9nKCdib2R5JywgcGF5bG9hZClcblxuICAgIC8qKlxuICAgICAqIGdyYWIgdGhlIGNvbW1hbmQgZnVuY3Rpb24gZnJvbSB0aGUgY29tbWFuZHMgb2JqZWN0XG4gICAgICovXG4gICAgdmFyIHJ1biA9IGNvbW1hbmRzW3BheWxvYWQudGV4dC5zcGxpdCgnICcpWzBdXVxuXG4gICAgLyoqXG4gICAgICogSWYgdGhlIGNvbW1hbmQgZG9lc24ndCBleGlzdCBiYWlsIGFuZCBsZXQgdGhlIGNsaWVudCBrbm93XG4gICAgICovXG4gICAgaWYgKCFydW4pIHtcbiAgICAgIHJlcy5zdGF0dXNDb2RlID0gNDAwXG4gICAgICByZXR1cm4gcmVzLmVuZCgnVGhhdCBjb21tYW5kIGlzIG5vdCBpbXBsZW1lbnRlZCcpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogcnVuIHRoZSBjb21tYW5kIGZ1bmN0aW9uIHBhc3NpbmcgaW4gdGhlIHBheWxvYWQgZnJvbSBzbGFja1xuICAgICAqL1xuICAgIHJ1bihwYXlsb2FkKVxuICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcbiAgICAgICAgcmVzLnN0YXR1c0NvZGUgPSAyMDBcbiAgICAgICAgcmVzLmVuZChyZXNwKVxuICAgICAgfSlcbiAgICAgIC5jYXRjaChmdW5jdGlvbiAoZSkge1xuICAgICAgICByZXMuc3RhdHVzQ29kZSA9IDUwMFxuICAgICAgICByZXMuZW5kKGAke2UubWVzc2FnZX1cXG4ke2Uuc3RhY2t9YClcbiAgICAgIH0pXG5cbiAgfSlcblxuICAvKipcbiAgICogQWxsIG90aGVyIHJvdXRlcyByZXNwb25kIHdpdGggYSBtZXNzYWdlIHRvIHRoZSB1c2VyIHRvIHVzZSBgL2VwaGVtZXJhbGBcbiAgICovXG4gIHJvdXRlci5hbGwoJyonLCBmdW5jdGlvbiAocmVxLCByZXMpIHtcbiAgICBsb2cocmVxLm1ldGhvZClcbiAgICByZXMuZW5kKCdTZW5kIFBPU1QgcmVxdWVzdHMgdG8gL2VwaGVtZXJhbCBwbGVhc2UgYW5kIHRoYW5rcycpXG4gIH0pXG5cbiAgLyoqXG4gICAqIENyZWF0ZSB0aGUgc2VydmVyIGFuZCBwYXNzIHRoZSByZXEgYW5kIHJlcyB0aHJvdWdoIHRoZSByb3V0ZXJcbiAgICovXG4gIHZhciBhcHAgPSBodHRwLmNyZWF0ZVNlcnZlcihmdW5jdGlvbiAocmVxLCByZXMpIHtcbiAgICByb3V0ZXIocmVxLCByZXMsIGZpbmFsaGFuZGxlcihyZXEsIHJlcykpXG4gIH0pXG5cbiAgcmV0dXJuIGFwcFxufVxuZXhwb3J0c1snQHJlcXVpcmUnXSA9IFsgJ2NvbW1hbmRzJyBdXG4iXX0=",
    "map": {
      "version": 3,
      "sources": [
        "/usr/src/app/index.js"
      ],
      "names": [],
      "mappings": ";;;;IAAO,IAAI,2BAAM,MAAM;;IAChB,YAAY,2BAAM,cAAc;;IAChC,MAAM,2BAAM,QAAQ;;IACpB,CAAC,2BAAM,WAAW;;IAClB,IAAI,2BAAM,WAAW;;IACrB,KAAK,2BAAM,OAAO;;AAEzB,IAAI,KAAK,GAAG,KAAK,CAAC,gBAAgB,CAAC,CAAA;AACnC,IAAI,GAAG,GAAG,KAAK,CAAC,gBAAgB,CAAC,CAAA;;AAEjC,GAAG,CAAC,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;;AAEnC,SAAS,SAAS,CAAE,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE;AAClC,MAAI,CAAC,GAAG,EAAE,UAAU,GAAG,EAAE,IAAI,EAAE;AAC7B,QAAI,GAAG,EAAE;AACP,WAAK,CAAC,MAAM,EAAE,GAAG,CAAC,CAAA;AAClB,SAAG,CAAC,IAAI,GAAG,IAAI,CAAA;AACf,aAAO,IAAI,EAAE,CAAA;KACd;AACD,OAAG,CAAC,IAAI,GAAG,IAAI,CAAA;AACf,QAAI,EAAE,CAAA;GACP,CAAC,CAAA;CACH;;;AAGD,OAAO,GAAG,MAAM,CAAC,OAAO,GAAG,UAAU,QAAQ,EAAE;AAC7C,MAAI,MAAM,GAAG,MAAM,EAAE,CAAA;;;;;;AAMrB,QAAM,CAAC,IAAI,CAAC,YAAY,EAAE,SAAS,EAAE,UAAU,GAAG,EAAE,GAAG,EAAE;AACvD,OAAG,CAAC,iBAAiB,CAAC,CAAA;;;AAGtB,QAAI,OAAO,GAAG,GAAG,CAAC,IAAI,IAAI,EAAE,IAAI,EAAE,EAAE,EAAE,CAAA;AACtC,OAAG,CAAC,MAAM,EAAE,OAAO,CAAC,CAAA;;;;;AAKpB,QAAI,GAAG,GAAG,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAA;;;;;AAK9C,QAAI,CAAC,GAAG,EAAE;AACR,SAAG,CAAC,UAAU,GAAG,GAAG,CAAA;AACpB,aAAO,GAAG,CAAC,GAAG,CAAC,iCAAiC,CAAC,CAAA;KAClD;;;;;AAKD,OAAG,CAAC,OAAO,CAAC,CACT,IAAI,CAAC,UAAU,IAAI,EAAE;AACpB,SAAG,CAAC,UAAU,GAAG,GAAG,CAAA;AACpB,SAAG,CAAC,GAAG,CAAC,IAAI,CAAC,CAAA;KACd,CAAC,SACI,CAAC,UAAU,CAAC,EAAE;AAClB,SAAG,CAAC,UAAU,GAAG,GAAG,CAAA;AACpB,SAAG,CAAC,GAAG,MAAI,CAAC,CAAC,OAAO,UAAK,CAAC,CAAC,KAAK,CAAG,CAAA;KACpC,CAAC,CAAA;GAEL,CAAC,CAAA;;;;;AAKF,QAAM,CAAC,GAAG,CAAC,GAAG,EAAE,UAAU,GAAG,EAAE,GAAG,EAAE;AAClC,OAAG,CAAC,GAAG,CAAC,MAAM,CAAC,CAAA;AACf,OAAG,CAAC,GAAG,CAAC,oDAAoD,CAAC,CAAA;GAC9D,CAAC,CAAA;;;;;AAKF,MAAI,GAAG,GAAG,IAAI,CAAC,YAAY,CAAC,UAAU,GAAG,EAAE,GAAG,EAAE;AAC9C,UAAM,CAAC,GAAG,EAAE,GAAG,EAAE,YAAY,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC,CAAA;GACzC,CAAC,CAAA;;AAEF,SAAO,GAAG,CAAA;CACX,CAAA;AACD,OAAO,CAAC,UAAU,CAAC,GAAG,CAAE,UAAU,CAAE,CAAA",
      "file": "/usr/src/app/index.js",
      "sourcesContent": [
        "import http from 'http'\nimport finalhandler from 'finalhandler'\nimport Router from 'router'\nimport _ from 'lodash-fp'\nimport body from 'body/form'\nimport debug from 'debug'\n\nvar error = debug('ephembot:index')\nvar log = debug('ephembot:index')\n// Make logs go to stdout instead of stderr\nlog.log = console.log.bind(console)\n\nfunction parseBody (req, res, next) {\n  body(req, function (err, body) {\n    if (err) {\n      error('err:', err)\n      req.body = null\n      return next()\n    }\n    req.body = body\n    next()\n  })\n}\n\n// Injected dependencies\nexports = module.exports = function (commands) {\n  var router = Router()\n\n  /**\n   * This route should be given to slack as the endpoint to which to send\n   * `/ephemeral` data.\n   */\n  router.post('/ephemeral', parseBody, function (req, res) {\n    log('POST /ephemeral')\n\n    // grab the payload.\n    let payload = req.body || { text: '' }\n    log('body', payload)\n\n    /**\n     * grab the command function from the commands object\n     */\n    var run = commands[payload.text.split(' ')[0]]\n\n    /**\n     * If the command doesn't exist bail and let the client know\n     */\n    if (!run) {\n      res.statusCode = 400\n      return res.end('That command is not implemented')\n    }\n\n    /**\n     * run the command function passing in the payload from slack\n     */\n    run(payload)\n      .then(function (resp) {\n        res.statusCode = 200\n        res.end(resp)\n      })\n      .catch(function (e) {\n        res.statusCode = 500\n        res.end(`${e.message}\\n${e.stack}`)\n      })\n\n  })\n\n  /**\n   * All other routes respond with a message to the user to use `/ephemeral`\n   */\n  router.all('*', function (req, res) {\n    log(req.method)\n    res.end('Send POST requests to /ephemeral please and thanks')\n  })\n\n  /**\n   * Create the server and pass the req and res through the router\n   */\n  var app = http.createServer(function (req, res) {\n    router(req, res, finalhandler(req, res))\n  })\n\n  return app\n}\nexports['@require'] = [ 'commands' ]\n"
      ]
    },
    "ast": null,
    "mtime": 1430415210976
  },
  "/usr/src/app/test/spec/get_history.test.js:{}:4.7.16": {
    "code": "\"use strict\";\n\nvar _interopRequire = function (obj) { return obj && obj.__esModule ? obj[\"default\"] : obj; };\n\n/* global describe it beforeEach afterEach */\n\nvar _ = _interopRequire(require(\"lodash-fp\"));\n\nvar expect = require(\"chai\").expect;\n\nvar nock = _interopRequire(require(\"nock\"));\n\nvar fixture = _interopRequire(require(\"../fixture/get_history.fixture\"));\n\nvar get = _interopRequire(require(\"../../src/get_history\"));\n\nvar opts = {\n  token: \"foo\",\n  channel: \"bar\",\n  count: 10,\n  latest: \"now\"\n};\n\nvar first = \"/api/channels.history?token=foo&channel=bar&count=10&latest=now\";\nvar firstRes = fixture[0];\n\nvar second = \"/api/channels.history?token=foo&channel=bar&count=10&latest=1358546515.000011\";\nvar secondRes = fixture[1];\n\ndescribe(\"get_history\", function () {\n  beforeEach(function () {\n    nock(\"https://slack.com\").get(first).times(1).reply(200, firstRes);\n    nock(\"https://slack.com\").get(second).times(1).reply(200, secondRes);\n  });\n\n  afterEach(function () {\n    nock.cleanAll();\n  });\n\n  it(\"should return a promise\", function (done) {\n    var got = get(opts);\n\n    expect(got instanceof Promise).to.be.equal(true);\n\n    got.then(function (res) {\n      return done();\n    });\n  });\n\n  it(\"should unwrap into an array\", function (done) {\n    var got = get(opts);\n\n    got.then(function (res) {\n      expect(res instanceof Array).to.be.equal(true);\n      done();\n    });\n  });\n\n  it(\"should chain promises until end condition is met\", function (done) {\n    var got = get(opts);\n\n    got.then(function (res) {\n      expect(res.length).to.be.equal(20);\n      done();\n    });\n  });\n});\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi91c3Ivc3JjL2FwcC90ZXN0L3NwZWMvZ2V0X2hpc3RvcnkudGVzdC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7SUFFTyxDQUFDLDJCQUFNLFdBQVc7O0lBQ2pCLE1BQU0sV0FBTyxNQUFNLEVBQW5CLE1BQU07O0lBQ1AsSUFBSSwyQkFBTSxNQUFNOztJQUVoQixPQUFPLDJCQUFNLGdDQUFnQzs7SUFDN0MsR0FBRywyQkFBTSx1QkFBdUI7O0FBRXZDLElBQU0sSUFBSSxHQUFHO0FBQ1gsT0FBSyxFQUFFLEtBQUs7QUFDWixTQUFPLEVBQUUsS0FBSztBQUNkLE9BQUssRUFBRSxFQUFFO0FBQ1QsUUFBTSxFQUFFLEtBQUs7Q0FDZCxDQUFBOztBQUVELElBQU0sS0FBSyxHQUFHLGlFQUFpRSxDQUFBO0FBQy9FLElBQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQTs7QUFFM0IsSUFBTSxNQUFNLEdBQUcsK0VBQStFLENBQUE7QUFDOUYsSUFBTSxTQUFTLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFBOztBQUU1QixRQUFRLENBQUMsYUFBYSxFQUFFLFlBQVk7QUFDbEMsWUFBVSxDQUFDLFlBQVk7QUFDckIsUUFBSSxDQUFDLG1CQUFtQixDQUFDLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFLFFBQVEsQ0FBQyxDQUFBO0FBQ2xFLFFBQUksQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxTQUFTLENBQUMsQ0FBQTtHQUNyRSxDQUFDLENBQUE7O0FBRUYsV0FBUyxDQUFDLFlBQVk7QUFDcEIsUUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFBO0dBQ2hCLENBQUMsQ0FBQTs7QUFFRixJQUFFLENBQUMseUJBQXlCLEVBQUUsVUFBVSxJQUFJLEVBQUU7QUFDNUMsUUFBSSxHQUFHLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFBOztBQUVuQixVQUFNLENBQUMsR0FBRyxZQUFZLE9BQU8sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFBOztBQUVoRCxPQUFHLENBQUMsSUFBSSxDQUFDLFVBQUMsR0FBRzthQUFLLElBQUksRUFBRTtLQUFBLENBQUMsQ0FBQTtHQUMxQixDQUFDLENBQUE7O0FBRUYsSUFBRSxDQUFDLDZCQUE2QixFQUFFLFVBQVUsSUFBSSxFQUFFO0FBQ2hELFFBQUksR0FBRyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQTs7QUFFbkIsT0FBRyxDQUFDLElBQUksQ0FBQyxVQUFVLEdBQUcsRUFBRTtBQUN0QixZQUFNLENBQUMsR0FBRyxZQUFZLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFBO0FBQzlDLFVBQUksRUFBRSxDQUFBO0tBQ1AsQ0FBQyxDQUFBO0dBQ0gsQ0FBQyxDQUFBOztBQUVGLElBQUUsQ0FBQyxrREFBa0QsRUFBRSxVQUFVLElBQUksRUFBRTtBQUNyRSxRQUFJLEdBQUcsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUE7O0FBRW5CLE9BQUcsQ0FBQyxJQUFJLENBQUMsVUFBVSxHQUFHLEVBQUU7QUFDdEIsWUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQTtBQUNsQyxVQUFJLEVBQUUsQ0FBQTtLQUNQLENBQUMsQ0FBQTtHQUNILENBQUMsQ0FBQTtDQUNILENBQUMsQ0FBQSIsImZpbGUiOiIvdXNyL3NyYy9hcHAvdGVzdC9zcGVjL2dldF9oaXN0b3J5LnRlc3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgZGVzY3JpYmUgaXQgYmVmb3JlRWFjaCBhZnRlckVhY2ggKi9cblxuaW1wb3J0IF8gZnJvbSAnbG9kYXNoLWZwJ1xuaW1wb3J0IHtleHBlY3R9IGZyb20gJ2NoYWknXG5pbXBvcnQgbm9jayBmcm9tICdub2NrJ1xuXG5pbXBvcnQgZml4dHVyZSBmcm9tICcuLi9maXh0dXJlL2dldF9oaXN0b3J5LmZpeHR1cmUnXG5pbXBvcnQgZ2V0IGZyb20gJy4uLy4uL3NyYy9nZXRfaGlzdG9yeSdcblxuY29uc3Qgb3B0cyA9IHtcbiAgdG9rZW46ICdmb28nLFxuICBjaGFubmVsOiAnYmFyJyxcbiAgY291bnQ6IDEwLFxuICBsYXRlc3Q6ICdub3cnXG59XG5cbmNvbnN0IGZpcnN0ID0gJy9hcGkvY2hhbm5lbHMuaGlzdG9yeT90b2tlbj1mb28mY2hhbm5lbD1iYXImY291bnQ9MTAmbGF0ZXN0PW5vdydcbmNvbnN0IGZpcnN0UmVzID0gZml4dHVyZVswXVxuXG5jb25zdCBzZWNvbmQgPSAnL2FwaS9jaGFubmVscy5oaXN0b3J5P3Rva2VuPWZvbyZjaGFubmVsPWJhciZjb3VudD0xMCZsYXRlc3Q9MTM1ODU0NjUxNS4wMDAwMTEnXG5jb25zdCBzZWNvbmRSZXMgPSBmaXh0dXJlWzFdXG5cbmRlc2NyaWJlKCdnZXRfaGlzdG9yeScsIGZ1bmN0aW9uICgpIHtcbiAgYmVmb3JlRWFjaChmdW5jdGlvbiAoKSB7XG4gICAgbm9jaygnaHR0cHM6Ly9zbGFjay5jb20nKS5nZXQoZmlyc3QpLnRpbWVzKDEpLnJlcGx5KDIwMCwgZmlyc3RSZXMpXG4gICAgbm9jaygnaHR0cHM6Ly9zbGFjay5jb20nKS5nZXQoc2Vjb25kKS50aW1lcygxKS5yZXBseSgyMDAsIHNlY29uZFJlcylcbiAgfSlcblxuICBhZnRlckVhY2goZnVuY3Rpb24gKCkge1xuICAgIG5vY2suY2xlYW5BbGwoKVxuICB9KVxuXG4gIGl0KCdzaG91bGQgcmV0dXJuIGEgcHJvbWlzZScsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgbGV0IGdvdCA9IGdldChvcHRzKVxuXG4gICAgZXhwZWN0KGdvdCBpbnN0YW5jZW9mIFByb21pc2UpLnRvLmJlLmVxdWFsKHRydWUpXG5cbiAgICBnb3QudGhlbigocmVzKSA9PiBkb25lKCkpXG4gIH0pXG5cbiAgaXQoJ3Nob3VsZCB1bndyYXAgaW50byBhbiBhcnJheScsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgbGV0IGdvdCA9IGdldChvcHRzKVxuXG4gICAgZ290LnRoZW4oZnVuY3Rpb24gKHJlcykge1xuICAgICAgZXhwZWN0KHJlcyBpbnN0YW5jZW9mIEFycmF5KS50by5iZS5lcXVhbCh0cnVlKVxuICAgICAgZG9uZSgpXG4gICAgfSlcbiAgfSlcblxuICBpdCgnc2hvdWxkIGNoYWluIHByb21pc2VzIHVudGlsIGVuZCBjb25kaXRpb24gaXMgbWV0JywgZnVuY3Rpb24gKGRvbmUpIHtcbiAgICBsZXQgZ290ID0gZ2V0KG9wdHMpXG5cbiAgICBnb3QudGhlbihmdW5jdGlvbiAocmVzKSB7XG4gICAgICBleHBlY3QocmVzLmxlbmd0aCkudG8uYmUuZXF1YWwoMjApXG4gICAgICBkb25lKClcbiAgICB9KVxuICB9KVxufSlcbiJdfQ==",
    "map": {
      "version": 3,
      "sources": [
        "/usr/src/app/test/spec/get_history.test.js"
      ],
      "names": [],
      "mappings": ";;;;;;IAEO,CAAC,2BAAM,WAAW;;IACjB,MAAM,WAAO,MAAM,EAAnB,MAAM;;IACP,IAAI,2BAAM,MAAM;;IAEhB,OAAO,2BAAM,gCAAgC;;IAC7C,GAAG,2BAAM,uBAAuB;;AAEvC,IAAM,IAAI,GAAG;AACX,OAAK,EAAE,KAAK;AACZ,SAAO,EAAE,KAAK;AACd,OAAK,EAAE,EAAE;AACT,QAAM,EAAE,KAAK;CACd,CAAA;;AAED,IAAM,KAAK,GAAG,iEAAiE,CAAA;AAC/E,IAAM,QAAQ,GAAG,OAAO,CAAC,CAAC,CAAC,CAAA;;AAE3B,IAAM,MAAM,GAAG,+EAA+E,CAAA;AAC9F,IAAM,SAAS,GAAG,OAAO,CAAC,CAAC,CAAC,CAAA;;AAE5B,QAAQ,CAAC,aAAa,EAAE,YAAY;AAClC,YAAU,CAAC,YAAY;AACrB,QAAI,CAAC,mBAAmB,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,EAAE,QAAQ,CAAC,CAAA;AAClE,QAAI,CAAC,mBAAmB,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,EAAE,SAAS,CAAC,CAAA;GACrE,CAAC,CAAA;;AAEF,WAAS,CAAC,YAAY;AACpB,QAAI,CAAC,QAAQ,EAAE,CAAA;GAChB,CAAC,CAAA;;AAEF,IAAE,CAAC,yBAAyB,EAAE,UAAU,IAAI,EAAE;AAC5C,QAAI,GAAG,GAAG,GAAG,CAAC,IAAI,CAAC,CAAA;;AAEnB,UAAM,CAAC,GAAG,YAAY,OAAO,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,CAAA;;AAEhD,OAAG,CAAC,IAAI,CAAC,UAAC,GAAG;aAAK,IAAI,EAAE;KAAA,CAAC,CAAA;GAC1B,CAAC,CAAA;;AAEF,IAAE,CAAC,6BAA6B,EAAE,UAAU,IAAI,EAAE;AAChD,QAAI,GAAG,GAAG,GAAG,CAAC,IAAI,CAAC,CAAA;;AAEnB,OAAG,CAAC,IAAI,CAAC,UAAU,GAAG,EAAE;AACtB,YAAM,CAAC,GAAG,YAAY,KAAK,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,CAAA;AAC9C,UAAI,EAAE,CAAA;KACP,CAAC,CAAA;GACH,CAAC,CAAA;;AAEF,IAAE,CAAC,kDAAkD,EAAE,UAAU,IAAI,EAAE;AACrE,QAAI,GAAG,GAAG,GAAG,CAAC,IAAI,CAAC,CAAA;;AAEnB,OAAG,CAAC,IAAI,CAAC,UAAU,GAAG,EAAE;AACtB,YAAM,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,CAAA;AAClC,UAAI,EAAE,CAAA;KACP,CAAC,CAAA;GACH,CAAC,CAAA;CACH,CAAC,CAAA",
      "file": "/usr/src/app/test/spec/get_history.test.js",
      "sourcesContent": [
        "/* global describe it beforeEach afterEach */\n\nimport _ from 'lodash-fp'\nimport {expect} from 'chai'\nimport nock from 'nock'\n\nimport fixture from '../fixture/get_history.fixture'\nimport get from '../../src/get_history'\n\nconst opts = {\n  token: 'foo',\n  channel: 'bar',\n  count: 10,\n  latest: 'now'\n}\n\nconst first = '/api/channels.history?token=foo&channel=bar&count=10&latest=now'\nconst firstRes = fixture[0]\n\nconst second = '/api/channels.history?token=foo&channel=bar&count=10&latest=1358546515.000011'\nconst secondRes = fixture[1]\n\ndescribe('get_history', function () {\n  beforeEach(function () {\n    nock('https://slack.com').get(first).times(1).reply(200, firstRes)\n    nock('https://slack.com').get(second).times(1).reply(200, secondRes)\n  })\n\n  afterEach(function () {\n    nock.cleanAll()\n  })\n\n  it('should return a promise', function (done) {\n    let got = get(opts)\n\n    expect(got instanceof Promise).to.be.equal(true)\n\n    got.then((res) => done())\n  })\n\n  it('should unwrap into an array', function (done) {\n    let got = get(opts)\n\n    got.then(function (res) {\n      expect(res instanceof Array).to.be.equal(true)\n      done()\n    })\n  })\n\n  it('should chain promises until end condition is met', function (done) {\n    let got = get(opts)\n\n    got.then(function (res) {\n      expect(res.length).to.be.equal(20)\n      done()\n    })\n  })\n})\n"
      ]
    },
    "ast": null,
    "mtime": 1429488306194
  },
  "/usr/src/app/src/get_history.js:{}:4.7.16": {
    "code": "\"use strict\";\n\nvar _interopRequire = function (obj) { return obj && obj.__esModule ? obj[\"default\"] : obj; };\n\nvar _toConsumableArray = function (arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) arr2[i] = arr[i]; return arr2; } else { return Array.from(arr); } };\n\nvar _ = _interopRequire(require(\"lodash-fp\"));\n\nvar https = _interopRequire(require(\"https\"));\n\nvar querystring = _interopRequire(require(\"querystring\"));\n\nvar debug = _interopRequire(require(\"debug\"));\n\nvar log = debug(\"get_history\");\nlog.log = console.log.bind(console);\n\nvar getHistory = function getHistory(opts) {\n  log(\"initialized: \" + opts);\n\n  return request(opts, []).then(_.partialRight(handleSucc, opts))[\"catch\"](handleFail);\n};\n\nvar request = function request(opts, prev) {\n  var path = createParams(opts);\n\n  log(\"requested: \" + path);\n\n  return new Promise(function (resolve, reject) {\n    var cat = function cat(res) {\n      var acc = \"\";\n\n      res.on(\"data\", function (data) {\n        return acc += data;\n      });\n      res.on(\"error\", function (e) {\n        return reject(e);\n      });\n      res.on(\"end\", function () {\n        var msg = JSON.parse(acc);\n        msg.prev = prev;\n\n        if (msg.ok === true) {\n          resolve(msg);\n        } else {\n          reject(msg);\n        }\n      });\n    };\n\n    https.get({ host: \"slack.com\", path: path }, cat);\n  });\n};\n\n// handle\n// ---------------------------------------------------------------------------\n\nvar handleSucc = (function (_handleSucc) {\n  var _handleSuccWrapper = function handleSucc(_x, _x2) {\n    return _handleSucc.apply(this, arguments);\n  };\n\n  _handleSuccWrapper.toString = function () {\n    return _handleSucc.toString();\n  };\n\n  return _handleSuccWrapper;\n})(function (payload, opts) {\n  var hasMore = payload.has_more;\n  var nextOpts = _.clone(opts);\n\n  var messages = [].concat(_toConsumableArray(payload.messages));\n  var prev = payload.prev;\n  var acc = prev.concat(messages);\n\n  nextOpts.latest = _.last(messages).ts;\n\n  if (hasMore === true) {\n    return request(nextOpts, acc).then(_.partialRight(handleSucc, nextOpts));\n  } else {\n    return acc // all done!\n    ;\n  }\n});\n\nvar handleFail = function handleFail(err) {\n  var log = debug(\"get_history\");\n\n  log(\"rejected: \" + err);\n};\n\n// util\n// ---------------------------------------------------------------------------\n\nvar createParams = function createParams(opts) {\n  return \"/api/channels.history?\" + querystring.stringify(opts);\n};\n\n// export\n// ---------------------------------------------------------------------------\n\nexports = module.exports = function () {\n  return getHistory;\n};\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi91c3Ivc3JjL2FwcC9zcmMvZ2V0X2hpc3RvcnkuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0lBQU8sQ0FBQywyQkFBTSxXQUFXOztJQUNsQixLQUFLLDJCQUFNLE9BQU87O0lBQ2xCLFdBQVcsMkJBQU0sYUFBYTs7SUFDOUIsS0FBSywyQkFBTSxPQUFPOztBQUV6QixJQUFNLEdBQUcsR0FBRyxLQUFLLENBQUMsYUFBYSxDQUFDLENBQUE7QUFDaEMsR0FBRyxDQUFDLEdBQUcsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQTs7QUFFbkMsSUFBTSxVQUFVLEdBQUcsb0JBQVUsSUFBSSxFQUFFO0FBQ2pDLEtBQUcsQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLENBQUE7O0FBRTNCLFNBQU8sT0FBTyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLENBQUMsU0FBTSxDQUFDLFVBQVUsQ0FBQyxDQUFBO0NBQ2xGLENBQUE7O0FBRUQsSUFBTSxPQUFPLEdBQUcsaUJBQVUsSUFBSSxFQUFFLElBQUksRUFBRTtBQUNwQyxNQUFJLElBQUksR0FBRyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUE7O0FBRTdCLEtBQUcsQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLENBQUE7O0FBRXpCLFNBQU8sSUFBSSxPQUFPLENBQUMsVUFBVSxPQUFPLEVBQUUsTUFBTSxFQUFFO0FBQzVDLFFBQUksR0FBRyxHQUFHLGFBQVUsR0FBRyxFQUFFO0FBQ3ZCLFVBQUksR0FBRyxHQUFHLEVBQUUsQ0FBQTs7QUFFWixTQUFHLENBQUMsRUFBRSxDQUFDLE1BQU0sRUFBRSxVQUFBLElBQUk7ZUFBSSxHQUFHLElBQUksSUFBSTtPQUFBLENBQUMsQ0FBQTtBQUNuQyxTQUFHLENBQUMsRUFBRSxDQUFDLE9BQU8sRUFBRSxVQUFBLENBQUM7ZUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDO09BQUEsQ0FBQyxDQUFBO0FBQy9CLFNBQUcsQ0FBQyxFQUFFLENBQUMsS0FBSyxFQUFFLFlBQVk7QUFDeEIsWUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQTtBQUN6QixXQUFHLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQTs7QUFFZixZQUFJLEdBQUcsQ0FBQyxFQUFFLEtBQUssSUFBSSxFQUFFO0FBQ25CLGlCQUFPLENBQUMsR0FBRyxDQUFDLENBQUE7U0FDYixNQUFNO0FBQ0wsZ0JBQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQTtTQUNaO09BQ0YsQ0FBQyxDQUFBO0tBQ0gsQ0FBQTs7QUFFRCxTQUFLLENBQUMsR0FBRyxDQUFDLEVBQUMsSUFBSSxFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFDLEVBQUUsR0FBRyxDQUFDLENBQUE7R0FDaEQsQ0FBQyxDQUFBO0NBQ0gsQ0FBQTs7Ozs7QUFLRCxJQUFNLFVBQVU7Ozs7Ozs7Ozs7R0FBRyxVQUFVLE9BQU8sRUFBRSxJQUFJLEVBQUU7QUFDMUMsTUFBSSxPQUFPLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQTtBQUM5QixNQUFJLFFBQVEsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFBOztBQUU1QixNQUFJLFFBQVEsZ0NBQU8sT0FBTyxDQUFDLFFBQVEsRUFBQyxDQUFBO0FBQ3BDLE1BQUksSUFBSSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUE7QUFDdkIsTUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQTs7QUFFL0IsVUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsQ0FBQTs7QUFFckMsTUFBSSxPQUFPLEtBQUssSUFBSSxFQUFFO0FBQ3BCLFdBQU8sT0FBTyxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxVQUFVLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQTtHQUN6RSxNQUFNO0FBQ0wsV0FBTyxHQUFHO0tBQUE7R0FDWDtDQUNGLENBQUEsQ0FBQTs7QUFFRCxJQUFNLFVBQVUsR0FBRyxvQkFBVSxHQUFHLEVBQUU7QUFDaEMsTUFBSSxHQUFHLEdBQUcsS0FBSyxDQUFDLGFBQWEsQ0FBQyxDQUFBOztBQUU5QixLQUFHLENBQUMsWUFBWSxHQUFHLEdBQUcsQ0FBQyxDQUFBO0NBQ3hCLENBQUE7Ozs7O0FBS0QsSUFBTSxZQUFZLEdBQUcsc0JBQVUsSUFBSSxFQUFFO0FBQ25DLG9DQUFnQyxXQUFXLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFFO0NBQzlELENBQUE7Ozs7O0FBS0QsT0FBTyxHQUFHLE1BQU0sQ0FBQyxPQUFPLEdBQUcsWUFBWTtBQUFFLFNBQU8sVUFBVSxDQUFBO0NBQUUsQ0FBQSIsImZpbGUiOiIvdXNyL3NyYy9hcHAvc3JjL2dldF9oaXN0b3J5LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoLWZwJ1xuaW1wb3J0IGh0dHBzIGZyb20gJ2h0dHBzJ1xuaW1wb3J0IHF1ZXJ5c3RyaW5nIGZyb20gJ3F1ZXJ5c3RyaW5nJ1xuaW1wb3J0IGRlYnVnIGZyb20gJ2RlYnVnJ1xuXG5jb25zdCBsb2cgPSBkZWJ1ZygnZ2V0X2hpc3RvcnknKVxubG9nLmxvZyA9IGNvbnNvbGUubG9nLmJpbmQoY29uc29sZSlcblxuY29uc3QgZ2V0SGlzdG9yeSA9IGZ1bmN0aW9uIChvcHRzKSB7XG4gIGxvZygnaW5pdGlhbGl6ZWQ6ICcgKyBvcHRzKVxuXG4gIHJldHVybiByZXF1ZXN0KG9wdHMsIFtdKS50aGVuKF8ucGFydGlhbFJpZ2h0KGhhbmRsZVN1Y2MsIG9wdHMpKS5jYXRjaChoYW5kbGVGYWlsKVxufVxuXG5jb25zdCByZXF1ZXN0ID0gZnVuY3Rpb24gKG9wdHMsIHByZXYpIHtcbiAgbGV0IHBhdGggPSBjcmVhdGVQYXJhbXMob3B0cylcblxuICBsb2coJ3JlcXVlc3RlZDogJyArIHBhdGgpXG5cbiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICBsZXQgY2F0ID0gZnVuY3Rpb24gKHJlcykge1xuICAgICAgbGV0IGFjYyA9ICcnXG5cbiAgICAgIHJlcy5vbignZGF0YScsIGRhdGEgPT4gYWNjICs9IGRhdGEpXG4gICAgICByZXMub24oJ2Vycm9yJywgZSA9PiByZWplY3QoZSkpXG4gICAgICByZXMub24oJ2VuZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbGV0IG1zZyA9IEpTT04ucGFyc2UoYWNjKVxuICAgICAgICBtc2cucHJldiA9IHByZXZcblxuICAgICAgICBpZiAobXNnLm9rID09PSB0cnVlKSB7XG4gICAgICAgICAgcmVzb2x2ZShtc2cpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVqZWN0KG1zZylcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9XG5cbiAgICBodHRwcy5nZXQoe2hvc3Q6ICdzbGFjay5jb20nLCBwYXRoOiBwYXRofSwgY2F0KVxuICB9KVxufVxuXG4vLyBoYW5kbGVcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5jb25zdCBoYW5kbGVTdWNjID0gZnVuY3Rpb24gKHBheWxvYWQsIG9wdHMpIHtcbiAgbGV0IGhhc01vcmUgPSBwYXlsb2FkLmhhc19tb3JlXG4gIGxldCBuZXh0T3B0cyA9IF8uY2xvbmUob3B0cylcblxuICBsZXQgbWVzc2FnZXMgPSBbLi4ucGF5bG9hZC5tZXNzYWdlc11cbiAgbGV0IHByZXYgPSBwYXlsb2FkLnByZXZcbiAgbGV0IGFjYyA9IHByZXYuY29uY2F0KG1lc3NhZ2VzKVxuXG4gIG5leHRPcHRzLmxhdGVzdCA9IF8ubGFzdChtZXNzYWdlcykudHNcblxuICBpZiAoaGFzTW9yZSA9PT0gdHJ1ZSkge1xuICAgIHJldHVybiByZXF1ZXN0KG5leHRPcHRzLCBhY2MpLnRoZW4oXy5wYXJ0aWFsUmlnaHQoaGFuZGxlU3VjYywgbmV4dE9wdHMpKVxuICB9IGVsc2Uge1xuICAgIHJldHVybiBhY2MgLy8gYWxsIGRvbmUhXG4gIH1cbn1cblxuY29uc3QgaGFuZGxlRmFpbCA9IGZ1bmN0aW9uIChlcnIpIHtcbiAgbGV0IGxvZyA9IGRlYnVnKCdnZXRfaGlzdG9yeScpXG5cbiAgbG9nKCdyZWplY3RlZDogJyArIGVycilcbn1cblxuLy8gdXRpbFxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbmNvbnN0IGNyZWF0ZVBhcmFtcyA9IGZ1bmN0aW9uIChvcHRzKSB7XG4gIHJldHVybiBgL2FwaS9jaGFubmVscy5oaXN0b3J5PyR7cXVlcnlzdHJpbmcuc3RyaW5naWZ5KG9wdHMpfWBcbn1cblxuLy8gZXhwb3J0XG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuZXhwb3J0cyA9IG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gZ2V0SGlzdG9yeSB9XG4iXX0=",
    "map": {
      "version": 3,
      "sources": [
        "/usr/src/app/src/get_history.js"
      ],
      "names": [],
      "mappings": "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",
      "file": "/usr/src/app/src/get_history.js",
      "sourcesContent": [
        "import _ from 'lodash-fp'\nimport https from 'https'\nimport querystring from 'querystring'\nimport debug from 'debug'\n\nconst log = debug('get_history')\nlog.log = console.log.bind(console)\n\nconst getHistory = function (opts) {\n  log('initialized: ' + opts)\n\n  return request(opts, []).then(_.partialRight(handleSucc, opts)).catch(handleFail)\n}\n\nconst request = function (opts, prev) {\n  let path = createParams(opts)\n\n  log('requested: ' + path)\n\n  return new Promise(function (resolve, reject) {\n    let cat = function (res) {\n      let acc = ''\n\n      res.on('data', data => acc += data)\n      res.on('error', e => reject(e))\n      res.on('end', function () {\n        let msg = JSON.parse(acc)\n        msg.prev = prev\n\n        if (msg.ok === true) {\n          resolve(msg)\n        } else {\n          reject(msg)\n        }\n      })\n    }\n\n    https.get({host: 'slack.com', path: path}, cat)\n  })\n}\n\n// handle\n// ---------------------------------------------------------------------------\n\nconst handleSucc = function (payload, opts) {\n  let hasMore = payload.has_more\n  let nextOpts = _.clone(opts)\n\n  let messages = [...payload.messages]\n  let prev = payload.prev\n  let acc = prev.concat(messages)\n\n  nextOpts.latest = _.last(messages).ts\n\n  if (hasMore === true) {\n    return request(nextOpts, acc).then(_.partialRight(handleSucc, nextOpts))\n  } else {\n    return acc // all done!\n  }\n}\n\nconst handleFail = function (err) {\n  let log = debug('get_history')\n\n  log('rejected: ' + err)\n}\n\n// util\n// ---------------------------------------------------------------------------\n\nconst createParams = function (opts) {\n  return `/api/channels.history?${querystring.stringify(opts)}`\n}\n\n// export\n// ---------------------------------------------------------------------------\n\nexports = module.exports = function () { return getHistory }\n"
      ]
    },
    "ast": null,
    "mtime": 1430415703623
  },
  "/usr/src/app/test/spec/remove.test.js:{}:4.7.16": {
    "code": "\"use strict\";\n\nvar _interopRequire = function (obj) { return obj && obj.__esModule ? obj[\"default\"] : obj; };\n\n/* global describe it beforeEach afterEach */\n\nvar _ = _interopRequire(require(\"lodash-fp\"));\n\nvar expect = require(\"chai\").expect;\n\nvar nock = _interopRequire(require(\"nock\"));\n\nvar messages = _interopRequire(require(\"../fixture/remove.fixture\"));\n\nvar remove = _interopRequire(require(\"../../src/remove\"));\n\nvar token = \"foo\";\nvar channel = \"bar\";\n\nvar res = {\n  ok: true,\n  channel: channel,\n  ts: \"stub\"\n};\n\nvar rej = {\n  ok: false\n};\n\ndescribe(\"remove\", function () {\n  beforeEach(function () {\n    nock(\"https://slack.com\").post(\"/api/chat.delete\").times(40).reply(200, res);\n  });\n\n  afterEach(function () {\n    nock.cleanAll();\n  });\n\n  it(\"should return a partially applied function\", function () {\n    expect(remove(token, channel) instanceof Function).to.be.equal(true);\n  });\n\n  it(\"should return a promises when applied\", function (done) {\n    var removed = remove(token, channel)(messages);\n\n    expect(removed instanceof Promise).to.be.equal(true);\n    done();\n  });\n\n  it(\"should return a promise that, when fmapped, contain an array\", function (done) {\n    var removed = remove(token, channel)(messages);\n\n    removed.then(function (messages) {\n      expect(messages instanceof Array).to.be.equal(true);\n      expect(messages.length).to.be.equal(10);\n    });\n\n    done();\n  });\n});\n\ndescribe(\"/remove catch\", function () {\n  beforeEach(function () {\n    nock(\"https://slack.com\").post(\"/api/chat.delete\").times(40).reply(200, rej);\n  });\n\n  afterEach(function () {\n    nock.cleanAll();\n  });\n\n  it(\"should return a promise that catches\", function (done) {\n    var removed = remove(token, channel)(messages);\n\n    removed.then(function () {\n      return console.log(\"fail: this should'nt be reachable\");\n    })[\"catch\"](function () {\n      return done();\n    });\n  });\n});\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi91c3Ivc3JjL2FwcC90ZXN0L3NwZWMvcmVtb3ZlLnRlc3QuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0lBRU8sQ0FBQywyQkFBTSxXQUFXOztJQUNqQixNQUFNLFdBQU8sTUFBTSxFQUFuQixNQUFNOztJQUNQLElBQUksMkJBQU0sTUFBTTs7SUFFaEIsUUFBUSwyQkFBTSwyQkFBMkI7O0lBQ3pDLE1BQU0sMkJBQU0sa0JBQWtCOztBQUVyQyxJQUFNLEtBQUssR0FBRyxLQUFLLENBQUE7QUFDbkIsSUFBTSxPQUFPLEdBQUcsS0FBSyxDQUFBOztBQUVyQixJQUFNLEdBQUcsR0FBRztBQUNWLE1BQU0sSUFBSTtBQUNWLFdBQVcsT0FBTztBQUNsQixNQUFNLE1BQU07Q0FDYixDQUFBOztBQUVELElBQU0sR0FBRyxHQUFHO0FBQ1YsTUFBTSxLQUFLO0NBQ1osQ0FBQTs7QUFFRCxRQUFRLENBQUMsUUFBUSxFQUFFLFlBQVk7QUFDN0IsWUFBVSxDQUFDLFlBQVk7QUFDckIsUUFBSSxDQUFDLG1CQUFtQixDQUFDLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUE7R0FDN0UsQ0FBQyxDQUFBOztBQUVGLFdBQVMsQ0FBQyxZQUFZO0FBQ3BCLFFBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQTtHQUNoQixDQUFDLENBQUE7O0FBRUYsSUFBRSxDQUFDLDRDQUE0QyxFQUFFLFlBQVk7QUFDM0QsVUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLFlBQVksUUFBUSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUE7R0FDckUsQ0FBQyxDQUFBOztBQUVGLElBQUUsQ0FBQyx1Q0FBdUMsRUFBRSxVQUFVLElBQUksRUFBRTtBQUMxRCxRQUFJLE9BQU8sR0FBRyxNQUFNLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFBOztBQUU5QyxVQUFNLENBQUMsT0FBTyxZQUFZLE9BQU8sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFBO0FBQ3BELFFBQUksRUFBRSxDQUFBO0dBQ1AsQ0FBQyxDQUFBOztBQUVGLElBQUUsQ0FBQyw4REFBOEQsRUFBRSxVQUFVLElBQUksRUFBRTtBQUNqRixRQUFJLE9BQU8sR0FBRyxNQUFNLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFBOztBQUU5QyxXQUFPLENBQUMsSUFBSSxDQUFDLFVBQVUsUUFBUSxFQUFFO0FBQy9CLFlBQU0sQ0FBQyxRQUFRLFlBQVksS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUE7QUFDbkQsWUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQTtLQUN4QyxDQUFDLENBQUE7O0FBRUYsUUFBSSxFQUFFLENBQUE7R0FDUCxDQUFDLENBQUE7Q0FDSCxDQUFDLENBQUE7O0FBRUYsUUFBUSxDQUFDLGVBQWUsRUFBRSxZQUFZO0FBQ3BDLFlBQVUsQ0FBQyxZQUFZO0FBQ3JCLFFBQUksQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFBO0dBQzdFLENBQUMsQ0FBQTs7QUFFRixXQUFTLENBQUMsWUFBWTtBQUNwQixRQUFJLENBQUMsUUFBUSxFQUFFLENBQUE7R0FDaEIsQ0FBQyxDQUFBOztBQUVGLElBQUUsQ0FBQyxzQ0FBc0MsRUFBRSxVQUFVLElBQUksRUFBRTtBQUN6RCxRQUFJLE9BQU8sR0FBRyxNQUFNLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFBOztBQUU5QyxXQUFPLENBQ0osSUFBSSxDQUFDO2FBQU0sT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQ0FBb0MsQ0FBQztLQUFBLENBQUMsU0FDeEQsQ0FBQzthQUFNLElBQUksRUFBRTtLQUFBLENBQUMsQ0FBQTtHQUN2QixDQUFDLENBQUE7Q0FDSCxDQUFDLENBQUEiLCJmaWxlIjoiL3Vzci9zcmMvYXBwL3Rlc3Qvc3BlYy9yZW1vdmUudGVzdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGdsb2JhbCBkZXNjcmliZSBpdCBiZWZvcmVFYWNoIGFmdGVyRWFjaCAqL1xuXG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gtZnAnXG5pbXBvcnQge2V4cGVjdH0gZnJvbSAnY2hhaSdcbmltcG9ydCBub2NrIGZyb20gJ25vY2snXG5cbmltcG9ydCBtZXNzYWdlcyBmcm9tICcuLi9maXh0dXJlL3JlbW92ZS5maXh0dXJlJ1xuaW1wb3J0IHJlbW92ZSBmcm9tICcuLi8uLi9zcmMvcmVtb3ZlJ1xuXG5jb25zdCB0b2tlbiA9ICdmb28nXG5jb25zdCBjaGFubmVsID0gJ2JhcidcblxuY29uc3QgcmVzID0ge1xuICAnb2snOiB0cnVlLFxuICAnY2hhbm5lbCc6IGNoYW5uZWwsXG4gICd0cyc6ICdzdHViJ1xufVxuXG5jb25zdCByZWogPSB7XG4gICdvayc6IGZhbHNlXG59XG5cbmRlc2NyaWJlKCdyZW1vdmUnLCBmdW5jdGlvbiAoKSB7XG4gIGJlZm9yZUVhY2goZnVuY3Rpb24gKCkge1xuICAgIG5vY2soJ2h0dHBzOi8vc2xhY2suY29tJykucG9zdCgnL2FwaS9jaGF0LmRlbGV0ZScpLnRpbWVzKDQwKS5yZXBseSgyMDAsIHJlcylcbiAgfSlcblxuICBhZnRlckVhY2goZnVuY3Rpb24gKCkge1xuICAgIG5vY2suY2xlYW5BbGwoKVxuICB9KVxuXG4gIGl0KCdzaG91bGQgcmV0dXJuIGEgcGFydGlhbGx5IGFwcGxpZWQgZnVuY3Rpb24nLCBmdW5jdGlvbiAoKSB7XG4gICAgZXhwZWN0KHJlbW92ZSh0b2tlbiwgY2hhbm5lbCkgaW5zdGFuY2VvZiBGdW5jdGlvbikudG8uYmUuZXF1YWwodHJ1ZSlcbiAgfSlcblxuICBpdCgnc2hvdWxkIHJldHVybiBhIHByb21pc2VzIHdoZW4gYXBwbGllZCcsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgbGV0IHJlbW92ZWQgPSByZW1vdmUodG9rZW4sIGNoYW5uZWwpKG1lc3NhZ2VzKVxuXG4gICAgZXhwZWN0KHJlbW92ZWQgaW5zdGFuY2VvZiBQcm9taXNlKS50by5iZS5lcXVhbCh0cnVlKVxuICAgIGRvbmUoKVxuICB9KVxuXG4gIGl0KCdzaG91bGQgcmV0dXJuIGEgcHJvbWlzZSB0aGF0LCB3aGVuIGZtYXBwZWQsIGNvbnRhaW4gYW4gYXJyYXknLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgIGxldCByZW1vdmVkID0gcmVtb3ZlKHRva2VuLCBjaGFubmVsKShtZXNzYWdlcylcblxuICAgIHJlbW92ZWQudGhlbihmdW5jdGlvbiAobWVzc2FnZXMpIHtcbiAgICAgIGV4cGVjdChtZXNzYWdlcyBpbnN0YW5jZW9mIEFycmF5KS50by5iZS5lcXVhbCh0cnVlKVxuICAgICAgZXhwZWN0KG1lc3NhZ2VzLmxlbmd0aCkudG8uYmUuZXF1YWwoMTApXG4gICAgfSlcblxuICAgIGRvbmUoKVxuICB9KVxufSlcblxuZGVzY3JpYmUoJy9yZW1vdmUgY2F0Y2gnLCBmdW5jdGlvbiAoKSB7XG4gIGJlZm9yZUVhY2goZnVuY3Rpb24gKCkge1xuICAgIG5vY2soJ2h0dHBzOi8vc2xhY2suY29tJykucG9zdCgnL2FwaS9jaGF0LmRlbGV0ZScpLnRpbWVzKDQwKS5yZXBseSgyMDAsIHJlailcbiAgfSlcblxuICBhZnRlckVhY2goZnVuY3Rpb24gKCkge1xuICAgIG5vY2suY2xlYW5BbGwoKVxuICB9KVxuXG4gIGl0KCdzaG91bGQgcmV0dXJuIGEgcHJvbWlzZSB0aGF0IGNhdGNoZXMnLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgIGxldCByZW1vdmVkID0gcmVtb3ZlKHRva2VuLCBjaGFubmVsKShtZXNzYWdlcylcblxuICAgIHJlbW92ZWRcbiAgICAgIC50aGVuKCgpID0+IGNvbnNvbGUubG9nKCdmYWlsOiB0aGlzIHNob3VsZFxcJ250IGJlIHJlYWNoYWJsZScpKVxuICAgICAgLmNhdGNoKCgpID0+IGRvbmUoKSlcbiAgfSlcbn0pXG4iXX0=",
    "map": {
      "version": 3,
      "sources": [
        "/usr/src/app/test/spec/remove.test.js"
      ],
      "names": [],
      "mappings": ";;;;;;IAEO,CAAC,2BAAM,WAAW;;IACjB,MAAM,WAAO,MAAM,EAAnB,MAAM;;IACP,IAAI,2BAAM,MAAM;;IAEhB,QAAQ,2BAAM,2BAA2B;;IACzC,MAAM,2BAAM,kBAAkB;;AAErC,IAAM,KAAK,GAAG,KAAK,CAAA;AACnB,IAAM,OAAO,GAAG,KAAK,CAAA;;AAErB,IAAM,GAAG,GAAG;AACV,MAAM,IAAI;AACV,WAAW,OAAO;AAClB,MAAM,MAAM;CACb,CAAA;;AAED,IAAM,GAAG,GAAG;AACV,MAAM,KAAK;CACZ,CAAA;;AAED,QAAQ,CAAC,QAAQ,EAAE,YAAY;AAC7B,YAAU,CAAC,YAAY;AACrB,QAAI,CAAC,mBAAmB,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC,GAAG,EAAE,GAAG,CAAC,CAAA;GAC7E,CAAC,CAAA;;AAEF,WAAS,CAAC,YAAY;AACpB,QAAI,CAAC,QAAQ,EAAE,CAAA;GAChB,CAAC,CAAA;;AAEF,IAAE,CAAC,4CAA4C,EAAE,YAAY;AAC3D,UAAM,CAAC,MAAM,CAAC,KAAK,EAAE,OAAO,CAAC,YAAY,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,CAAA;GACrE,CAAC,CAAA;;AAEF,IAAE,CAAC,uCAAuC,EAAE,UAAU,IAAI,EAAE;AAC1D,QAAI,OAAO,GAAG,MAAM,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC,QAAQ,CAAC,CAAA;;AAE9C,UAAM,CAAC,OAAO,YAAY,OAAO,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,CAAA;AACpD,QAAI,EAAE,CAAA;GACP,CAAC,CAAA;;AAEF,IAAE,CAAC,8DAA8D,EAAE,UAAU,IAAI,EAAE;AACjF,QAAI,OAAO,GAAG,MAAM,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC,QAAQ,CAAC,CAAA;;AAE9C,WAAO,CAAC,IAAI,CAAC,UAAU,QAAQ,EAAE;AAC/B,YAAM,CAAC,QAAQ,YAAY,KAAK,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,CAAA;AACnD,YAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,CAAA;KACxC,CAAC,CAAA;;AAEF,QAAI,EAAE,CAAA;GACP,CAAC,CAAA;CACH,CAAC,CAAA;;AAEF,QAAQ,CAAC,eAAe,EAAE,YAAY;AACpC,YAAU,CAAC,YAAY;AACrB,QAAI,CAAC,mBAAmB,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC,GAAG,EAAE,GAAG,CAAC,CAAA;GAC7E,CAAC,CAAA;;AAEF,WAAS,CAAC,YAAY;AACpB,QAAI,CAAC,QAAQ,EAAE,CAAA;GAChB,CAAC,CAAA;;AAEF,IAAE,CAAC,sCAAsC,EAAE,UAAU,IAAI,EAAE;AACzD,QAAI,OAAO,GAAG,MAAM,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC,QAAQ,CAAC,CAAA;;AAE9C,WAAO,CACJ,IAAI,CAAC;aAAM,OAAO,CAAC,GAAG,CAAC,mCAAoC,CAAC;KAAA,CAAC,SACxD,CAAC;aAAM,IAAI,EAAE;KAAA,CAAC,CAAA;GACvB,CAAC,CAAA;CACH,CAAC,CAAA",
      "file": "/usr/src/app/test/spec/remove.test.js",
      "sourcesContent": [
        "/* global describe it beforeEach afterEach */\n\nimport _ from 'lodash-fp'\nimport {expect} from 'chai'\nimport nock from 'nock'\n\nimport messages from '../fixture/remove.fixture'\nimport remove from '../../src/remove'\n\nconst token = 'foo'\nconst channel = 'bar'\n\nconst res = {\n  'ok': true,\n  'channel': channel,\n  'ts': 'stub'\n}\n\nconst rej = {\n  'ok': false\n}\n\ndescribe('remove', function () {\n  beforeEach(function () {\n    nock('https://slack.com').post('/api/chat.delete').times(40).reply(200, res)\n  })\n\n  afterEach(function () {\n    nock.cleanAll()\n  })\n\n  it('should return a partially applied function', function () {\n    expect(remove(token, channel) instanceof Function).to.be.equal(true)\n  })\n\n  it('should return a promises when applied', function (done) {\n    let removed = remove(token, channel)(messages)\n\n    expect(removed instanceof Promise).to.be.equal(true)\n    done()\n  })\n\n  it('should return a promise that, when fmapped, contain an array', function (done) {\n    let removed = remove(token, channel)(messages)\n\n    removed.then(function (messages) {\n      expect(messages instanceof Array).to.be.equal(true)\n      expect(messages.length).to.be.equal(10)\n    })\n\n    done()\n  })\n})\n\ndescribe('/remove catch', function () {\n  beforeEach(function () {\n    nock('https://slack.com').post('/api/chat.delete').times(40).reply(200, rej)\n  })\n\n  afterEach(function () {\n    nock.cleanAll()\n  })\n\n  it('should return a promise that catches', function (done) {\n    let removed = remove(token, channel)(messages)\n\n    removed\n      .then(() => console.log('fail: this should\\'nt be reachable'))\n      .catch(() => done())\n  })\n})\n"
      ]
    },
    "ast": null,
    "mtime": 1429488306194
  },
  "/usr/src/app/test/fixture/remove.fixture.js:{}:4.7.16": {
    "code": "\"use strict\";\n\nvar fixture = [{\n  type: \"message\",\n  ts: \"1358546515.000020\",\n  user: \"U2147483896\",\n  text: \"Hello\"\n}, {\n  type: \"message\",\n  ts: \"1358546515.000019\",\n  user: \"U2147483896\",\n  text: \"Hello\"\n}, {\n  type: \"message\",\n  ts: \"1358546515.000018\",\n  user: \"U2147483896\",\n  text: \"Hello\"\n}, {\n  type: \"message\",\n  ts: \"1358546515.000017\",\n  user: \"U2147483896\",\n  text: \"Hello\"\n}, {\n  type: \"message\",\n  ts: \"1358546515.000016\",\n  user: \"U2147483896\",\n  text: \"Hello\"\n}, {\n  type: \"message\",\n  ts: \"1358546515.000015\",\n  user: \"U2147483896\",\n  text: \"Hello\"\n}, {\n  type: \"message\",\n  ts: \"1358546515.000014\",\n  user: \"U2147483896\",\n  text: \"Hello\"\n}, {\n  type: \"message\",\n  ts: \"1358546515.000013\",\n  user: \"U2147483896\",\n  text: \"Hello\"\n}, {\n  type: \"message\",\n  ts: \"1358546515.000012\",\n  user: \"U2147483896\",\n  text: \"Hello\"\n}, {\n  type: \"message\",\n  ts: \"1358546515.000011\",\n  user: \"U2147483896\",\n  text: \"Hello\"\n}];\n\nvar thePromise = new Promise(function (resolve) {\n  resolve(fixture);\n});\n\nmodule.exports = thePromise;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi91c3Ivc3JjL2FwcC90ZXN0L2ZpeHR1cmUvcmVtb3ZlLmZpeHR1cmUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFNLE9BQU8sR0FBRyxDQUNkO0FBQ0UsTUFBSSxFQUFFLFNBQVM7QUFDZixJQUFFLEVBQUUsbUJBQW1CO0FBQ3ZCLE1BQUksRUFBRSxhQUFhO0FBQ25CLE1BQUksRUFBRSxPQUFPO0NBQ2QsRUFDRDtBQUNFLE1BQUksRUFBRSxTQUFTO0FBQ2YsSUFBRSxFQUFFLG1CQUFtQjtBQUN2QixNQUFJLEVBQUUsYUFBYTtBQUNuQixNQUFJLEVBQUUsT0FBTztDQUNkLEVBQ0Q7QUFDRSxNQUFJLEVBQUUsU0FBUztBQUNmLElBQUUsRUFBRSxtQkFBbUI7QUFDdkIsTUFBSSxFQUFFLGFBQWE7QUFDbkIsTUFBSSxFQUFFLE9BQU87Q0FDZCxFQUNEO0FBQ0UsTUFBSSxFQUFFLFNBQVM7QUFDZixJQUFFLEVBQUUsbUJBQW1CO0FBQ3ZCLE1BQUksRUFBRSxhQUFhO0FBQ25CLE1BQUksRUFBRSxPQUFPO0NBQ2QsRUFDRDtBQUNFLE1BQUksRUFBRSxTQUFTO0FBQ2YsSUFBRSxFQUFFLG1CQUFtQjtBQUN2QixNQUFJLEVBQUUsYUFBYTtBQUNuQixNQUFJLEVBQUUsT0FBTztDQUNkLEVBQ0Q7QUFDRSxNQUFJLEVBQUUsU0FBUztBQUNmLElBQUUsRUFBRSxtQkFBbUI7QUFDdkIsTUFBSSxFQUFFLGFBQWE7QUFDbkIsTUFBSSxFQUFFLE9BQU87Q0FDZCxFQUNEO0FBQ0UsTUFBSSxFQUFFLFNBQVM7QUFDZixJQUFFLEVBQUUsbUJBQW1CO0FBQ3ZCLE1BQUksRUFBRSxhQUFhO0FBQ25CLE1BQUksRUFBRSxPQUFPO0NBQ2QsRUFDRDtBQUNFLE1BQUksRUFBRSxTQUFTO0FBQ2YsSUFBRSxFQUFFLG1CQUFtQjtBQUN2QixNQUFJLEVBQUUsYUFBYTtBQUNuQixNQUFJLEVBQUUsT0FBTztDQUNkLEVBQ0Q7QUFDRSxNQUFJLEVBQUUsU0FBUztBQUNmLElBQUUsRUFBRSxtQkFBbUI7QUFDdkIsTUFBSSxFQUFFLGFBQWE7QUFDbkIsTUFBSSxFQUFFLE9BQU87Q0FDZCxFQUNEO0FBQ0UsTUFBSSxFQUFFLFNBQVM7QUFDZixJQUFFLEVBQUUsbUJBQW1CO0FBQ3ZCLE1BQUksRUFBRSxhQUFhO0FBQ25CLE1BQUksRUFBRSxPQUFPO0NBQ2QsQ0FDRixDQUFBOztBQUVELElBQU0sVUFBVSxHQUFHLElBQUksT0FBTyxDQUFDLFVBQVUsT0FBTyxFQUFFO0FBQ2hELFNBQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQTtDQUNqQixDQUFDLENBQUE7O2lCQUVhLFVBQVUiLCJmaWxlIjoiL3Vzci9zcmMvYXBwL3Rlc3QvZml4dHVyZS9yZW1vdmUuZml4dHVyZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGZpeHR1cmUgPSBbXG4gIHtcbiAgICB0eXBlOiAnbWVzc2FnZScsXG4gICAgdHM6ICcxMzU4NTQ2NTE1LjAwMDAyMCcsXG4gICAgdXNlcjogJ1UyMTQ3NDgzODk2JyxcbiAgICB0ZXh0OiAnSGVsbG8nXG4gIH0sXG4gIHtcbiAgICB0eXBlOiAnbWVzc2FnZScsXG4gICAgdHM6ICcxMzU4NTQ2NTE1LjAwMDAxOScsXG4gICAgdXNlcjogJ1UyMTQ3NDgzODk2JyxcbiAgICB0ZXh0OiAnSGVsbG8nXG4gIH0sXG4gIHtcbiAgICB0eXBlOiAnbWVzc2FnZScsXG4gICAgdHM6ICcxMzU4NTQ2NTE1LjAwMDAxOCcsXG4gICAgdXNlcjogJ1UyMTQ3NDgzODk2JyxcbiAgICB0ZXh0OiAnSGVsbG8nXG4gIH0sXG4gIHtcbiAgICB0eXBlOiAnbWVzc2FnZScsXG4gICAgdHM6ICcxMzU4NTQ2NTE1LjAwMDAxNycsXG4gICAgdXNlcjogJ1UyMTQ3NDgzODk2JyxcbiAgICB0ZXh0OiAnSGVsbG8nXG4gIH0sXG4gIHtcbiAgICB0eXBlOiAnbWVzc2FnZScsXG4gICAgdHM6ICcxMzU4NTQ2NTE1LjAwMDAxNicsXG4gICAgdXNlcjogJ1UyMTQ3NDgzODk2JyxcbiAgICB0ZXh0OiAnSGVsbG8nXG4gIH0sXG4gIHtcbiAgICB0eXBlOiAnbWVzc2FnZScsXG4gICAgdHM6ICcxMzU4NTQ2NTE1LjAwMDAxNScsXG4gICAgdXNlcjogJ1UyMTQ3NDgzODk2JyxcbiAgICB0ZXh0OiAnSGVsbG8nXG4gIH0sXG4gIHtcbiAgICB0eXBlOiAnbWVzc2FnZScsXG4gICAgdHM6ICcxMzU4NTQ2NTE1LjAwMDAxNCcsXG4gICAgdXNlcjogJ1UyMTQ3NDgzODk2JyxcbiAgICB0ZXh0OiAnSGVsbG8nXG4gIH0sXG4gIHtcbiAgICB0eXBlOiAnbWVzc2FnZScsXG4gICAgdHM6ICcxMzU4NTQ2NTE1LjAwMDAxMycsXG4gICAgdXNlcjogJ1UyMTQ3NDgzODk2JyxcbiAgICB0ZXh0OiAnSGVsbG8nXG4gIH0sXG4gIHtcbiAgICB0eXBlOiAnbWVzc2FnZScsXG4gICAgdHM6ICcxMzU4NTQ2NTE1LjAwMDAxMicsXG4gICAgdXNlcjogJ1UyMTQ3NDgzODk2JyxcbiAgICB0ZXh0OiAnSGVsbG8nXG4gIH0sXG4gIHtcbiAgICB0eXBlOiAnbWVzc2FnZScsXG4gICAgdHM6ICcxMzU4NTQ2NTE1LjAwMDAxMScsXG4gICAgdXNlcjogJ1UyMTQ3NDgzODk2JyxcbiAgICB0ZXh0OiAnSGVsbG8nXG4gIH1cbl1cblxuY29uc3QgdGhlUHJvbWlzZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7XG4gIHJlc29sdmUoZml4dHVyZSlcbn0pXG5cbmV4cG9ydCBkZWZhdWx0IHRoZVByb21pc2VcbiJdfQ==",
    "map": {
      "version": 3,
      "sources": [
        "/usr/src/app/test/fixture/remove.fixture.js"
      ],
      "names": [],
      "mappings": ";;AAAA,IAAM,OAAO,GAAG,CACd;AACE,MAAI,EAAE,SAAS;AACf,IAAE,EAAE,mBAAmB;AACvB,MAAI,EAAE,aAAa;AACnB,MAAI,EAAE,OAAO;CACd,EACD;AACE,MAAI,EAAE,SAAS;AACf,IAAE,EAAE,mBAAmB;AACvB,MAAI,EAAE,aAAa;AACnB,MAAI,EAAE,OAAO;CACd,EACD;AACE,MAAI,EAAE,SAAS;AACf,IAAE,EAAE,mBAAmB;AACvB,MAAI,EAAE,aAAa;AACnB,MAAI,EAAE,OAAO;CACd,EACD;AACE,MAAI,EAAE,SAAS;AACf,IAAE,EAAE,mBAAmB;AACvB,MAAI,EAAE,aAAa;AACnB,MAAI,EAAE,OAAO;CACd,EACD;AACE,MAAI,EAAE,SAAS;AACf,IAAE,EAAE,mBAAmB;AACvB,MAAI,EAAE,aAAa;AACnB,MAAI,EAAE,OAAO;CACd,EACD;AACE,MAAI,EAAE,SAAS;AACf,IAAE,EAAE,mBAAmB;AACvB,MAAI,EAAE,aAAa;AACnB,MAAI,EAAE,OAAO;CACd,EACD;AACE,MAAI,EAAE,SAAS;AACf,IAAE,EAAE,mBAAmB;AACvB,MAAI,EAAE,aAAa;AACnB,MAAI,EAAE,OAAO;CACd,EACD;AACE,MAAI,EAAE,SAAS;AACf,IAAE,EAAE,mBAAmB;AACvB,MAAI,EAAE,aAAa;AACnB,MAAI,EAAE,OAAO;CACd,EACD;AACE,MAAI,EAAE,SAAS;AACf,IAAE,EAAE,mBAAmB;AACvB,MAAI,EAAE,aAAa;AACnB,MAAI,EAAE,OAAO;CACd,EACD;AACE,MAAI,EAAE,SAAS;AACf,IAAE,EAAE,mBAAmB;AACvB,MAAI,EAAE,aAAa;AACnB,MAAI,EAAE,OAAO;CACd,CACF,CAAA;;AAED,IAAM,UAAU,GAAG,IAAI,OAAO,CAAC,UAAU,OAAO,EAAE;AAChD,SAAO,CAAC,OAAO,CAAC,CAAA;CACjB,CAAC,CAAA;;iBAEa,UAAU",
      "file": "/usr/src/app/test/fixture/remove.fixture.js",
      "sourcesContent": [
        "const fixture = [\n  {\n    type: 'message',\n    ts: '1358546515.000020',\n    user: 'U2147483896',\n    text: 'Hello'\n  },\n  {\n    type: 'message',\n    ts: '1358546515.000019',\n    user: 'U2147483896',\n    text: 'Hello'\n  },\n  {\n    type: 'message',\n    ts: '1358546515.000018',\n    user: 'U2147483896',\n    text: 'Hello'\n  },\n  {\n    type: 'message',\n    ts: '1358546515.000017',\n    user: 'U2147483896',\n    text: 'Hello'\n  },\n  {\n    type: 'message',\n    ts: '1358546515.000016',\n    user: 'U2147483896',\n    text: 'Hello'\n  },\n  {\n    type: 'message',\n    ts: '1358546515.000015',\n    user: 'U2147483896',\n    text: 'Hello'\n  },\n  {\n    type: 'message',\n    ts: '1358546515.000014',\n    user: 'U2147483896',\n    text: 'Hello'\n  },\n  {\n    type: 'message',\n    ts: '1358546515.000013',\n    user: 'U2147483896',\n    text: 'Hello'\n  },\n  {\n    type: 'message',\n    ts: '1358546515.000012',\n    user: 'U2147483896',\n    text: 'Hello'\n  },\n  {\n    type: 'message',\n    ts: '1358546515.000011',\n    user: 'U2147483896',\n    text: 'Hello'\n  }\n]\n\nconst thePromise = new Promise(function (resolve) {\n  resolve(fixture)\n})\n\nexport default thePromise\n"
      ]
    },
    "ast": null,
    "mtime": 1429488306194
  },
  "/usr/src/app/src/remove.js:{}:4.7.16": {
    "code": "\"use strict\";\n\nvar _interopRequire = function (obj) { return obj && obj.__esModule ? obj[\"default\"] : obj; };\n\nvar _ = _interopRequire(require(\"lodash-fp\"));\n\nvar querystring = _interopRequire(require(\"querystring\"));\n\nvar https = _interopRequire(require(\"https\"));\n\nvar debug = _interopRequire(require(\"debug\"));\n\nvar log = debug(\"ephembot:remove\");\nlog.log = console.log.bind(console);\n\nvar postList = _.curry(function (token, channel, history) {\n  log(\"initialized: \" + history);\n\n  return history.then(function (messages) {\n    var removed = _.map(function (message) {\n      return deleteMessage(token, channel, message);\n    }, messages);\n\n    return Promise.all(removed);\n  });\n});\n\nvar deleteMessage = function deleteMessage(token, channel, message) {\n  log(\"deleted: \" + JSON.stringify(message));\n\n  var opts = { token: token, channel: channel };\n  opts.ts = message.ts;\n\n  var data = querystring.stringify(opts);\n\n  var reqOpts = {\n    host: \"slack.com\",\n    method: \"POST\",\n    path: \"/api/chat.delete\",\n    headers: {\n      \"Content-Type\": \"application/x-www-form-urlencoded\",\n      \"Content-Length\": Buffer.byteLength(data)\n    }\n  };\n\n  return new Promise(function (resolve, reject) {\n    var cat = function cat(res) {\n      var acc = \"\";\n\n      res.setEncoding(\"utf8\");\n      res.on(\"data\", function (data) {\n        return acc += data;\n      });\n      res.on(\"error\", function (e) {\n        return reject(e);\n      });\n      res.on(\"end\", function () {\n        var msg = JSON.parse(acc);\n\n        if (msg.ok === true) {\n          resolve(msg);\n        } else {\n          reject(msg);\n        }\n      });\n    };\n\n    var req = https.request(reqOpts, cat);\n    req.write(data);\n    req.end();\n  });\n};\n\n// export\n// ---------------------------------------------------------------------------\n\nexports = module.exports = function () {\n  return postList;\n};\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi91c3Ivc3JjL2FwcC9zcmMvcmVtb3ZlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7SUFBTyxDQUFDLDJCQUFNLFdBQVc7O0lBQ2xCLFdBQVcsMkJBQU0sYUFBYTs7SUFDOUIsS0FBSywyQkFBTSxPQUFPOztJQUNsQixLQUFLLDJCQUFNLE9BQU87O0FBRXpCLElBQU0sR0FBRyxHQUFHLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxDQUFBO0FBQ3BDLEdBQUcsQ0FBQyxHQUFHLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUE7O0FBRW5DLElBQU0sUUFBUSxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBVSxLQUFLLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRTtBQUMxRCxLQUFHLENBQUMsZUFBZSxHQUFHLE9BQU8sQ0FBQyxDQUFBOztBQUU5QixTQUFPLE9BQU8sQ0FBQyxJQUFJLENBQUMsVUFBVSxRQUFRLEVBQUU7QUFDdEMsUUFBSSxPQUFPLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFBLE9BQU87YUFBSSxhQUFhLENBQUMsS0FBSyxFQUFFLE9BQU8sRUFBRSxPQUFPLENBQUM7S0FBQSxFQUFFLFFBQVEsQ0FBQyxDQUFBOztBQUVoRixXQUFPLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUE7R0FDNUIsQ0FBQyxDQUFBO0NBQ0gsQ0FBQyxDQUFBOztBQUVGLElBQU0sYUFBYSxHQUFHLHVCQUFVLEtBQUssRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFO0FBQ3ZELEtBQUcsQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFBOztBQUUxQyxNQUFJLElBQUksR0FBRyxFQUFDLEtBQUssRUFBTCxLQUFLLEVBQUUsT0FBTyxFQUFQLE9BQU8sRUFBQyxDQUFBO0FBQzNCLE1BQUksQ0FBQyxFQUFFLEdBQUcsT0FBTyxDQUFDLEVBQUUsQ0FBQTs7QUFFcEIsTUFBSSxJQUFJLEdBQUcsV0FBVyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQTs7QUFFdEMsTUFBSSxPQUFPLEdBQUc7QUFDWixRQUFJLEVBQUUsV0FBVztBQUNqQixVQUFNLEVBQUUsTUFBTTtBQUNkLFFBQUksRUFBRSxrQkFBa0I7QUFDeEIsV0FBTyxFQUFFO0FBQ1Asb0JBQWMsRUFBRSxtQ0FBbUM7QUFDbkQsc0JBQWdCLEVBQUUsTUFBTSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUM7S0FDMUM7R0FDRixDQUFBOztBQUVELFNBQU8sSUFBSSxPQUFPLENBQUMsVUFBVSxPQUFPLEVBQUUsTUFBTSxFQUFFO0FBQzVDLFFBQUksR0FBRyxHQUFHLGFBQVUsR0FBRyxFQUFFO0FBQ3ZCLFVBQUksR0FBRyxHQUFHLEVBQUUsQ0FBQTs7QUFFWixTQUFHLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFBO0FBQ3ZCLFNBQUcsQ0FBQyxFQUFFLENBQUMsTUFBTSxFQUFFLFVBQUEsSUFBSTtlQUFJLEdBQUcsSUFBSSxJQUFJO09BQUEsQ0FBQyxDQUFBO0FBQ25DLFNBQUcsQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLFVBQUEsQ0FBQztlQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUM7T0FBQSxDQUFDLENBQUE7QUFDL0IsU0FBRyxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsWUFBWTtBQUN4QixZQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFBOztBQUV6QixZQUFJLEdBQUcsQ0FBQyxFQUFFLEtBQUssSUFBSSxFQUFFO0FBQ25CLGlCQUFPLENBQUMsR0FBRyxDQUFDLENBQUE7U0FDYixNQUFNO0FBQ0wsZ0JBQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQTtTQUNaO09BQ0YsQ0FBQyxDQUFBO0tBQ0gsQ0FBQTs7QUFFRCxRQUFJLEdBQUcsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxHQUFHLENBQUMsQ0FBQTtBQUNyQyxPQUFHLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFBO0FBQ2YsT0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFBO0dBQ1YsQ0FBQyxDQUFBO0NBQ0gsQ0FBQTs7Ozs7QUFLRCxPQUFPLEdBQUcsTUFBTSxDQUFDLE9BQU8sR0FBRyxZQUFZO0FBQUUsU0FBTyxRQUFRLENBQUE7Q0FBRSxDQUFBIiwiZmlsZSI6Ii91c3Ivc3JjL2FwcC9zcmMvcmVtb3ZlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoLWZwJ1xuaW1wb3J0IHF1ZXJ5c3RyaW5nIGZyb20gJ3F1ZXJ5c3RyaW5nJ1xuaW1wb3J0IGh0dHBzIGZyb20gJ2h0dHBzJ1xuaW1wb3J0IGRlYnVnIGZyb20gJ2RlYnVnJ1xuXG5jb25zdCBsb2cgPSBkZWJ1ZygnZXBoZW1ib3Q6cmVtb3ZlJylcbmxvZy5sb2cgPSBjb25zb2xlLmxvZy5iaW5kKGNvbnNvbGUpXG5cbmNvbnN0IHBvc3RMaXN0ID0gXy5jdXJyeShmdW5jdGlvbiAodG9rZW4sIGNoYW5uZWwsIGhpc3RvcnkpIHtcbiAgbG9nKCdpbml0aWFsaXplZDogJyArIGhpc3RvcnkpXG5cbiAgcmV0dXJuIGhpc3RvcnkudGhlbihmdW5jdGlvbiAobWVzc2FnZXMpIHtcbiAgICBsZXQgcmVtb3ZlZCA9IF8ubWFwKG1lc3NhZ2UgPT4gZGVsZXRlTWVzc2FnZSh0b2tlbiwgY2hhbm5lbCwgbWVzc2FnZSksIG1lc3NhZ2VzKVxuXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKHJlbW92ZWQpXG4gIH0pXG59KVxuXG5jb25zdCBkZWxldGVNZXNzYWdlID0gZnVuY3Rpb24gKHRva2VuLCBjaGFubmVsLCBtZXNzYWdlKSB7XG4gIGxvZygnZGVsZXRlZDogJyArIEpTT04uc3RyaW5naWZ5KG1lc3NhZ2UpKVxuXG4gIGxldCBvcHRzID0ge3Rva2VuLCBjaGFubmVsfVxuICBvcHRzLnRzID0gbWVzc2FnZS50c1xuXG4gIGxldCBkYXRhID0gcXVlcnlzdHJpbmcuc3RyaW5naWZ5KG9wdHMpXG5cbiAgbGV0IHJlcU9wdHMgPSB7XG4gICAgaG9zdDogJ3NsYWNrLmNvbScsXG4gICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgcGF0aDogJy9hcGkvY2hhdC5kZWxldGUnLFxuICAgIGhlYWRlcnM6IHtcbiAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJyxcbiAgICAgICdDb250ZW50LUxlbmd0aCc6IEJ1ZmZlci5ieXRlTGVuZ3RoKGRhdGEpXG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICBsZXQgY2F0ID0gZnVuY3Rpb24gKHJlcykge1xuICAgICAgbGV0IGFjYyA9ICcnXG5cbiAgICAgIHJlcy5zZXRFbmNvZGluZygndXRmOCcpXG4gICAgICByZXMub24oJ2RhdGEnLCBkYXRhID0+IGFjYyArPSBkYXRhKVxuICAgICAgcmVzLm9uKCdlcnJvcicsIGUgPT4gcmVqZWN0KGUpKVxuICAgICAgcmVzLm9uKCdlbmQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxldCBtc2cgPSBKU09OLnBhcnNlKGFjYylcblxuICAgICAgICBpZiAobXNnLm9rID09PSB0cnVlKSB7XG4gICAgICAgICAgcmVzb2x2ZShtc2cpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVqZWN0KG1zZylcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9XG5cbiAgICBsZXQgcmVxID0gaHR0cHMucmVxdWVzdChyZXFPcHRzLCBjYXQpXG4gICAgcmVxLndyaXRlKGRhdGEpXG4gICAgcmVxLmVuZCgpXG4gIH0pXG59XG5cbi8vIGV4cG9ydFxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbmV4cG9ydHMgPSBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHBvc3RMaXN0IH1cbiJdfQ==",
    "map": {
      "version": 3,
      "sources": [
        "/usr/src/app/src/remove.js"
      ],
      "names": [],
      "mappings": ";;;;IAAO,CAAC,2BAAM,WAAW;;IAClB,WAAW,2BAAM,aAAa;;IAC9B,KAAK,2BAAM,OAAO;;IAClB,KAAK,2BAAM,OAAO;;AAEzB,IAAM,GAAG,GAAG,KAAK,CAAC,iBAAiB,CAAC,CAAA;AACpC,GAAG,CAAC,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;;AAEnC,IAAM,QAAQ,GAAG,CAAC,CAAC,KAAK,CAAC,UAAU,KAAK,EAAE,OAAO,EAAE,OAAO,EAAE;AAC1D,KAAG,CAAC,eAAe,GAAG,OAAO,CAAC,CAAA;;AAE9B,SAAO,OAAO,CAAC,IAAI,CAAC,UAAU,QAAQ,EAAE;AACtC,QAAI,OAAO,GAAG,CAAC,CAAC,GAAG,CAAC,UAAA,OAAO;aAAI,aAAa,CAAC,KAAK,EAAE,OAAO,EAAE,OAAO,CAAC;KAAA,EAAE,QAAQ,CAAC,CAAA;;AAEhF,WAAO,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAA;GAC5B,CAAC,CAAA;CACH,CAAC,CAAA;;AAEF,IAAM,aAAa,GAAG,uBAAU,KAAK,EAAE,OAAO,EAAE,OAAO,EAAE;AACvD,KAAG,CAAC,WAAW,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAA;;AAE1C,MAAI,IAAI,GAAG,EAAC,KAAK,EAAL,KAAK,EAAE,OAAO,EAAP,OAAO,EAAC,CAAA;AAC3B,MAAI,CAAC,EAAE,GAAG,OAAO,CAAC,EAAE,CAAA;;AAEpB,MAAI,IAAI,GAAG,WAAW,CAAC,SAAS,CAAC,IAAI,CAAC,CAAA;;AAEtC,MAAI,OAAO,GAAG;AACZ,QAAI,EAAE,WAAW;AACjB,UAAM,EAAE,MAAM;AACd,QAAI,EAAE,kBAAkB;AACxB,WAAO,EAAE;AACP,oBAAc,EAAE,mCAAmC;AACnD,sBAAgB,EAAE,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC;KAC1C;GACF,CAAA;;AAED,SAAO,IAAI,OAAO,CAAC,UAAU,OAAO,EAAE,MAAM,EAAE;AAC5C,QAAI,GAAG,GAAG,aAAU,GAAG,EAAE;AACvB,UAAI,GAAG,GAAG,EAAE,CAAA;;AAEZ,SAAG,CAAC,WAAW,CAAC,MAAM,CAAC,CAAA;AACvB,SAAG,CAAC,EAAE,CAAC,MAAM,EAAE,UAAA,IAAI;eAAI,GAAG,IAAI,IAAI;OAAA,CAAC,CAAA;AACnC,SAAG,CAAC,EAAE,CAAC,OAAO,EAAE,UAAA,CAAC;eAAI,MAAM,CAAC,CAAC,CAAC;OAAA,CAAC,CAAA;AAC/B,SAAG,CAAC,EAAE,CAAC,KAAK,EAAE,YAAY;AACxB,YAAI,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAA;;AAEzB,YAAI,GAAG,CAAC,EAAE,KAAK,IAAI,EAAE;AACnB,iBAAO,CAAC,GAAG,CAAC,CAAA;SACb,MAAM;AACL,gBAAM,CAAC,GAAG,CAAC,CAAA;SACZ;OACF,CAAC,CAAA;KACH,CAAA;;AAED,QAAI,GAAG,GAAG,KAAK,CAAC,OAAO,CAAC,OAAO,EAAE,GAAG,CAAC,CAAA;AACrC,OAAG,CAAC,KAAK,CAAC,IAAI,CAAC,CAAA;AACf,OAAG,CAAC,GAAG,EAAE,CAAA;GACV,CAAC,CAAA;CACH,CAAA;;;;;AAKD,OAAO,GAAG,MAAM,CAAC,OAAO,GAAG,YAAY;AAAE,SAAO,QAAQ,CAAA;CAAE,CAAA",
      "file": "/usr/src/app/src/remove.js",
      "sourcesContent": [
        "import _ from 'lodash-fp'\nimport querystring from 'querystring'\nimport https from 'https'\nimport debug from 'debug'\n\nconst log = debug('ephembot:remove')\nlog.log = console.log.bind(console)\n\nconst postList = _.curry(function (token, channel, history) {\n  log('initialized: ' + history)\n\n  return history.then(function (messages) {\n    let removed = _.map(message => deleteMessage(token, channel, message), messages)\n\n    return Promise.all(removed)\n  })\n})\n\nconst deleteMessage = function (token, channel, message) {\n  log('deleted: ' + JSON.stringify(message))\n\n  let opts = {token, channel}\n  opts.ts = message.ts\n\n  let data = querystring.stringify(opts)\n\n  let reqOpts = {\n    host: 'slack.com',\n    method: 'POST',\n    path: '/api/chat.delete',\n    headers: {\n      'Content-Type': 'application/x-www-form-urlencoded',\n      'Content-Length': Buffer.byteLength(data)\n    }\n  }\n\n  return new Promise(function (resolve, reject) {\n    let cat = function (res) {\n      let acc = ''\n\n      res.setEncoding('utf8')\n      res.on('data', data => acc += data)\n      res.on('error', e => reject(e))\n      res.on('end', function () {\n        let msg = JSON.parse(acc)\n\n        if (msg.ok === true) {\n          resolve(msg)\n        } else {\n          reject(msg)\n        }\n      })\n    }\n\n    let req = https.request(reqOpts, cat)\n    req.write(data)\n    req.end()\n  })\n}\n\n// export\n// ---------------------------------------------------------------------------\n\nexports = module.exports = function () { return postList }\n"
      ]
    },
    "ast": null,
    "mtime": 1430415589030
  },
  "/usr/src/app/test/spec/database.test.js:{}:4.7.16": {
    "code": "\"use strict\";\n\nvar _interopRequire = function (obj) { return obj && obj.__esModule ? obj[\"default\"] : obj; };\n\n/* global before describe it */\n\nvar expect = require(\"chai\").expect;\n\nvar database = _interopRequire(require(\"../../src/database\"));\n\nbefore(function () {\n  this.data = {\n    _id: \"butts\",\n    talon: \"is cool\"\n  };\n  this.db = database();\n});\n\ndescribe(\"database\", function () {\n  describe(\"#put\", function () {\n    it(\"should put an object\", function (done) {\n      var _this = this;\n\n      var result = this.db.put(this.data);\n      expect(result instanceof Promise, \"db.put should return a promise\");\n      result.then(function (x) {\n        expect(x).to.be.deep.equal(_this.data);\n        done();\n      })[\"catch\"](done);\n    });\n  });\n\n  describe(\"#findOne\", function () {\n    it(\"should find an object by id\", function (done) {\n      var _this = this;\n\n      var result = this.db.findOne(\"butts\");\n      result.then(function (x) {\n        expect(x).to.be.deep.equal(_this.data);\n        done();\n      })[\"catch\"](done);\n    });\n  });\n});\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi91c3Ivc3JjL2FwcC90ZXN0L3NwZWMvZGF0YWJhc2UudGVzdC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7SUFDUSxNQUFNLFdBQU8sTUFBTSxFQUFuQixNQUFNOztJQUNQLFFBQVEsMkJBQU0sb0JBQW9COztBQUV6QyxNQUFNLENBQUMsWUFBWTtBQUNqQixNQUFJLENBQUMsSUFBSSxHQUFHO0FBQ1YsT0FBRyxFQUFFLE9BQU87QUFDWixTQUFLLEVBQUUsU0FBUztHQUNqQixDQUFBO0FBQ0QsTUFBSSxDQUFDLEVBQUUsR0FBRyxRQUFRLEVBQUUsQ0FBQTtDQUNyQixDQUFDLENBQUE7O0FBRUYsUUFBUSxDQUFDLFVBQVUsRUFBRSxZQUFZO0FBQy9CLFVBQVEsQ0FBQyxNQUFNLEVBQUUsWUFBWTtBQUMzQixNQUFFLENBQUMsc0JBQXNCLEVBQUUsVUFBVSxJQUFJLEVBQUU7OztBQUN6QyxVQUFJLE1BQU0sR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUE7QUFDbkMsWUFBTSxDQUFDLE1BQU0sWUFBWSxPQUFPLEVBQUUsZ0NBQWdDLENBQUMsQ0FBQTtBQUNuRSxZQUFNLENBQ0gsSUFBSSxDQUFDLFVBQUMsQ0FBQyxFQUFLO0FBQ1gsY0FBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFLLElBQUksQ0FBQyxDQUFBO0FBQ3JDLFlBQUksRUFBRSxDQUFBO09BQ1AsQ0FBQyxTQUNJLENBQUMsSUFBSSxDQUFDLENBQUE7S0FDZixDQUFDLENBQUE7R0FDSCxDQUFDLENBQUE7O0FBRUYsVUFBUSxDQUFDLFVBQVUsRUFBRSxZQUFZO0FBQy9CLE1BQUUsQ0FBQyw2QkFBNkIsRUFBRSxVQUFVLElBQUksRUFBRTs7O0FBQ2hELFVBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFBO0FBQ3JDLFlBQU0sQ0FDSCxJQUFJLENBQUMsVUFBQyxDQUFDLEVBQUs7QUFDWCxjQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQUssSUFBSSxDQUFDLENBQUE7QUFDckMsWUFBSSxFQUFFLENBQUE7T0FDUCxDQUFDLFNBQ0ksQ0FBQyxJQUFJLENBQUMsQ0FBQTtLQUNmLENBQUMsQ0FBQTtHQUVILENBQUMsQ0FBQTtDQUNILENBQUMsQ0FBQSIsImZpbGUiOiIvdXNyL3NyYy9hcHAvdGVzdC9zcGVjL2RhdGFiYXNlLnRlc3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgYmVmb3JlIGRlc2NyaWJlIGl0ICovXG5pbXBvcnQge2V4cGVjdH0gZnJvbSAnY2hhaSdcbmltcG9ydCBkYXRhYmFzZSBmcm9tICcuLi8uLi9zcmMvZGF0YWJhc2UnXG5cbmJlZm9yZShmdW5jdGlvbiAoKSB7XG4gIHRoaXMuZGF0YSA9IHtcbiAgICBfaWQ6ICdidXR0cycsXG4gICAgdGFsb246ICdpcyBjb29sJ1xuICB9XG4gIHRoaXMuZGIgPSBkYXRhYmFzZSgpXG59KVxuXG5kZXNjcmliZSgnZGF0YWJhc2UnLCBmdW5jdGlvbiAoKSB7XG4gIGRlc2NyaWJlKCcjcHV0JywgZnVuY3Rpb24gKCkge1xuICAgIGl0KCdzaG91bGQgcHV0IGFuIG9iamVjdCcsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgICB2YXIgcmVzdWx0ID0gdGhpcy5kYi5wdXQodGhpcy5kYXRhKVxuICAgICAgZXhwZWN0KHJlc3VsdCBpbnN0YW5jZW9mIFByb21pc2UsICdkYi5wdXQgc2hvdWxkIHJldHVybiBhIHByb21pc2UnKVxuICAgICAgcmVzdWx0XG4gICAgICAgIC50aGVuKCh4KSA9PiB7XG4gICAgICAgICAgZXhwZWN0KHgpLnRvLmJlLmRlZXAuZXF1YWwodGhpcy5kYXRhKVxuICAgICAgICAgIGRvbmUoKVxuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZG9uZSlcbiAgICB9KVxuICB9KVxuXG4gIGRlc2NyaWJlKCcjZmluZE9uZScsIGZ1bmN0aW9uICgpIHtcbiAgICBpdCgnc2hvdWxkIGZpbmQgYW4gb2JqZWN0IGJ5IGlkJywgZnVuY3Rpb24gKGRvbmUpIHtcbiAgICAgIHZhciByZXN1bHQgPSB0aGlzLmRiLmZpbmRPbmUoJ2J1dHRzJylcbiAgICAgIHJlc3VsdFxuICAgICAgICAudGhlbigoeCkgPT4ge1xuICAgICAgICAgIGV4cGVjdCh4KS50by5iZS5kZWVwLmVxdWFsKHRoaXMuZGF0YSlcbiAgICAgICAgICBkb25lKClcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKGRvbmUpXG4gICAgfSlcblxuICB9KVxufSlcbiJdfQ==",
    "map": {
      "version": 3,
      "sources": [
        "/usr/src/app/test/spec/database.test.js"
      ],
      "names": [],
      "mappings": ";;;;;;IACQ,MAAM,WAAO,MAAM,EAAnB,MAAM;;IACP,QAAQ,2BAAM,oBAAoB;;AAEzC,MAAM,CAAC,YAAY;AACjB,MAAI,CAAC,IAAI,GAAG;AACV,OAAG,EAAE,OAAO;AACZ,SAAK,EAAE,SAAS;GACjB,CAAA;AACD,MAAI,CAAC,EAAE,GAAG,QAAQ,EAAE,CAAA;CACrB,CAAC,CAAA;;AAEF,QAAQ,CAAC,UAAU,EAAE,YAAY;AAC/B,UAAQ,CAAC,MAAM,EAAE,YAAY;AAC3B,MAAE,CAAC,sBAAsB,EAAE,UAAU,IAAI,EAAE;;;AACzC,UAAI,MAAM,GAAG,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;AACnC,YAAM,CAAC,MAAM,YAAY,OAAO,EAAE,gCAAgC,CAAC,CAAA;AACnE,YAAM,CACH,IAAI,CAAC,UAAC,CAAC,EAAK;AACX,cAAM,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,MAAK,IAAI,CAAC,CAAA;AACrC,YAAI,EAAE,CAAA;OACP,CAAC,SACI,CAAC,IAAI,CAAC,CAAA;KACf,CAAC,CAAA;GACH,CAAC,CAAA;;AAEF,UAAQ,CAAC,UAAU,EAAE,YAAY;AAC/B,MAAE,CAAC,6BAA6B,EAAE,UAAU,IAAI,EAAE;;;AAChD,UAAI,MAAM,GAAG,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,CAAA;AACrC,YAAM,CACH,IAAI,CAAC,UAAC,CAAC,EAAK;AACX,cAAM,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,MAAK,IAAI,CAAC,CAAA;AACrC,YAAI,EAAE,CAAA;OACP,CAAC,SACI,CAAC,IAAI,CAAC,CAAA;KACf,CAAC,CAAA;GAEH,CAAC,CAAA;CACH,CAAC,CAAA",
      "file": "/usr/src/app/test/spec/database.test.js",
      "sourcesContent": [
        "/* global before describe it */\nimport {expect} from 'chai'\nimport database from '../../src/database'\n\nbefore(function () {\n  this.data = {\n    _id: 'butts',\n    talon: 'is cool'\n  }\n  this.db = database()\n})\n\ndescribe('database', function () {\n  describe('#put', function () {\n    it('should put an object', function (done) {\n      var result = this.db.put(this.data)\n      expect(result instanceof Promise, 'db.put should return a promise')\n      result\n        .then((x) => {\n          expect(x).to.be.deep.equal(this.data)\n          done()\n        })\n        .catch(done)\n    })\n  })\n\n  describe('#findOne', function () {\n    it('should find an object by id', function (done) {\n      var result = this.db.findOne('butts')\n      result\n        .then((x) => {\n          expect(x).to.be.deep.equal(this.data)\n          done()\n        })\n        .catch(done)\n    })\n\n  })\n})\n"
      ]
    },
    "ast": null,
    "mtime": 1429488306194
  },
  "/usr/src/app/src/database.js:{}:4.7.16": {
    "code": "\"use strict\";\n\nvar _interopRequire = function (obj) { return obj && obj.__esModule ? obj[\"default\"] : obj; };\n\nvar _ = _interopRequire(require(\"lodash-fp\"));\n\nexports = module.exports = function database() {\n  /**\n   *\n   */\n  var store = {};\n\n  return {\n    /**\n     * Finds an item in the database by id\n     *\n     * @param {string} - the id of the desired object\n     * @return {object|null} - the found object, or null\n     */\n    findOne: function findOne(id) {\n      var data = _.clone(store[id], true);\n      if (!data) {\n        return null;\n      }data._id = id;\n      return Promise.resolve(data);\n    },\n\n    /**\n     * Puts an item in the database. The put item MUST have an _id field\n     *\n     * @param {object} - the id of the desired object\n     * @return {object} - the found object, or null\n     */\n    put: function put(x) {\n      var data = _.clone(x, true);\n      var id = data._id;\n      delete data._id;\n\n      if (!id) {\n        return Promise.reject(\"database.put requires _id field\");\n      }store[id] = data;\n      return Promise.resolve(x);\n    }\n  };\n};\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi91c3Ivc3JjL2FwcC9zcmMvZGF0YWJhc2UuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztJQUFPLENBQUMsMkJBQU0sV0FBVzs7QUFFekIsT0FBTyxHQUFHLE1BQU0sQ0FBQyxPQUFPLEdBQUcsU0FBUyxRQUFRLEdBQUk7Ozs7QUFJOUMsTUFBSSxLQUFLLEdBQUcsRUFBRSxDQUFBOztBQUVkLFNBQU87Ozs7Ozs7QUFPTCxXQUFPLEVBQUMsaUJBQUMsRUFBRSxFQUFFO0FBQ1gsVUFBSSxJQUFJLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUE7QUFDbkMsVUFBSSxDQUFDLElBQUk7QUFBRSxlQUFPLElBQUksQ0FBQTtPQUFBLEFBQ3RCLElBQUksQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFBO0FBQ2IsYUFBTyxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFBO0tBQzdCOzs7Ozs7OztBQVFELE9BQUcsRUFBQyxhQUFDLENBQUMsRUFBRTtBQUNOLFVBQUksSUFBSSxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFBO0FBQzNCLFVBQUksRUFBRSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUE7QUFDakIsYUFBTyxJQUFJLENBQUMsR0FBRyxDQUFBOztBQUVmLFVBQUksQ0FBQyxFQUFFO0FBQUUsZUFBTyxPQUFPLENBQUMsTUFBTSxDQUFDLGlDQUFpQyxDQUFDLENBQUE7T0FBQSxBQUVqRSxLQUFLLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFBO0FBQ2hCLGFBQU8sT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQTtLQUMxQjtHQUNGLENBQUE7Q0FDRixDQUFBIiwiZmlsZSI6Ii91c3Ivc3JjL2FwcC9zcmMvZGF0YWJhc2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gtZnAnXG5cbmV4cG9ydHMgPSBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGRhdGFiYXNlICgpIHtcbiAgLyoqXG4gICAqXG4gICAqL1xuICBsZXQgc3RvcmUgPSB7fVxuXG4gIHJldHVybiB7XG4gICAgLyoqXG4gICAgICogRmluZHMgYW4gaXRlbSBpbiB0aGUgZGF0YWJhc2UgYnkgaWRcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSAtIHRoZSBpZCBvZiB0aGUgZGVzaXJlZCBvYmplY3RcbiAgICAgKiBAcmV0dXJuIHtvYmplY3R8bnVsbH0gLSB0aGUgZm91bmQgb2JqZWN0LCBvciBudWxsXG4gICAgICovXG4gICAgZmluZE9uZSAoaWQpIHtcbiAgICAgIGxldCBkYXRhID0gXy5jbG9uZShzdG9yZVtpZF0sIHRydWUpXG4gICAgICBpZiAoIWRhdGEpIHJldHVybiBudWxsXG4gICAgICBkYXRhLl9pZCA9IGlkXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGRhdGEpXG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFB1dHMgYW4gaXRlbSBpbiB0aGUgZGF0YWJhc2UuIFRoZSBwdXQgaXRlbSBNVVNUIGhhdmUgYW4gX2lkIGZpZWxkXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gLSB0aGUgaWQgb2YgdGhlIGRlc2lyZWQgb2JqZWN0XG4gICAgICogQHJldHVybiB7b2JqZWN0fSAtIHRoZSBmb3VuZCBvYmplY3QsIG9yIG51bGxcbiAgICAgKi9cbiAgICBwdXQgKHgpIHtcbiAgICAgIGxldCBkYXRhID0gXy5jbG9uZSh4LCB0cnVlKVxuICAgICAgbGV0IGlkID0gZGF0YS5faWRcbiAgICAgIGRlbGV0ZSBkYXRhLl9pZFxuXG4gICAgICBpZiAoIWlkKSByZXR1cm4gUHJvbWlzZS5yZWplY3QoJ2RhdGFiYXNlLnB1dCByZXF1aXJlcyBfaWQgZmllbGQnKVxuXG4gICAgICBzdG9yZVtpZF0gPSBkYXRhXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHgpXG4gICAgfVxuICB9XG59XG4iXX0=",
    "map": {
      "version": 3,
      "sources": [
        "/usr/src/app/src/database.js"
      ],
      "names": [],
      "mappings": ";;;;IAAO,CAAC,2BAAM,WAAW;;AAEzB,OAAO,GAAG,MAAM,CAAC,OAAO,GAAG,SAAS,QAAQ,GAAI;;;;AAI9C,MAAI,KAAK,GAAG,EAAE,CAAA;;AAEd,SAAO;;;;;;;AAOL,WAAO,EAAC,iBAAC,EAAE,EAAE;AACX,UAAI,IAAI,GAAG,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,CAAA;AACnC,UAAI,CAAC,IAAI;AAAE,eAAO,IAAI,CAAA;OAAA,AACtB,IAAI,CAAC,GAAG,GAAG,EAAE,CAAA;AACb,aAAO,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,CAAA;KAC7B;;;;;;;;AAQD,OAAG,EAAC,aAAC,CAAC,EAAE;AACN,UAAI,IAAI,GAAG,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE,IAAI,CAAC,CAAA;AAC3B,UAAI,EAAE,GAAG,IAAI,CAAC,GAAG,CAAA;AACjB,aAAO,IAAI,CAAC,GAAG,CAAA;;AAEf,UAAI,CAAC,EAAE;AAAE,eAAO,OAAO,CAAC,MAAM,CAAC,iCAAiC,CAAC,CAAA;OAAA,AAEjE,KAAK,CAAC,EAAE,CAAC,GAAG,IAAI,CAAA;AAChB,aAAO,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,CAAA;KAC1B;GACF,CAAA;CACF,CAAA",
      "file": "/usr/src/app/src/database.js",
      "sourcesContent": [
        "import _ from 'lodash-fp'\n\nexports = module.exports = function database () {\n  /**\n   *\n   */\n  let store = {}\n\n  return {\n    /**\n     * Finds an item in the database by id\n     *\n     * @param {string} - the id of the desired object\n     * @return {object|null} - the found object, or null\n     */\n    findOne (id) {\n      let data = _.clone(store[id], true)\n      if (!data) return null\n      data._id = id\n      return Promise.resolve(data)\n    },\n\n    /**\n     * Puts an item in the database. The put item MUST have an _id field\n     *\n     * @param {object} - the id of the desired object\n     * @return {object} - the found object, or null\n     */\n    put (x) {\n      let data = _.clone(x, true)\n      let id = data._id\n      delete data._id\n\n      if (!id) return Promise.reject('database.put requires _id field')\n\n      store[id] = data\n      return Promise.resolve(x)\n    }\n  }\n}\n"
      ]
    },
    "ast": null,
    "mtime": 1430414034726
  },
  "/usr/src/app/test/spec/start.test.js:{}:4.7.16": {
    "code": "\"use strict\";\n\nvar _interopRequire = function (obj) { return obj && obj.__esModule ? obj[\"default\"] : obj; };\n\n/* global describe it before */\n\nvar expect = require(\"chai\").expect;\n\nvar st = _interopRequire(require(\"../../src/start\"));\n\nvar database = _interopRequire(require(\"../../src/database\"));\n\nbefore(function () {\n  var get = function get() {\n    return Promise.resolve({ ok: true });\n  };\n  var remove = function remove() {\n    return function () {\n      return Promise.resolve({ ok: true });\n    };\n  };\n  this.db = database();\n  this.start = st(this.db, get, remove);\n});\n\ndescribe(\"start\", function () {\n  it(\"should start ephembot\", function (done) {\n    var _this = this;\n\n    var level = { num: 2, unit: \"minutes\" };\n    var id = \"sup\";\n    this.start(id, level).then(function (data) {\n      expect(data.ok, \"Start should have triggered get and remove\").to.be.ok;\n    }).then(function () {\n      return _this.db.findOne(id);\n    }).then(function (data) {\n      expect(data._id, \"The _id should have been saved\").to.be.equal(id);\n      expect(data.level, \"The level should have been saved\").to.be.deep.equal(level);\n      expect(data.proc, \"A timeout should have been saved\").to.be.an(\"object\");\n      done();\n    })[\"catch\"](done);\n  });\n\n  it(\"should fail on invalid levels\", function (done) {\n    var level = { num: 2, unit: \"butts\" };\n    var id = \"sup\";\n    this.start(id, level).then(function (data) {\n      done(new Error(\"then should not be called\"));\n    })[\"catch\"](function (e) {\n      expect(e instanceof Error).to.be.ok;\n      done();\n    });\n  });\n});\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi91c3Ivc3JjL2FwcC90ZXN0L3NwZWMvc3RhcnQudGVzdC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7SUFDUSxNQUFNLFdBQU8sTUFBTSxFQUFuQixNQUFNOztJQUNQLEVBQUUsMkJBQU0saUJBQWlCOztJQUN6QixRQUFRLDJCQUFNLG9CQUFvQjs7QUFFekMsTUFBTSxDQUFDLFlBQVk7QUFDakIsTUFBSSxHQUFHLEdBQUcsZUFBWTtBQUNwQixXQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBQyxFQUFFLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQTtHQUNuQyxDQUFBO0FBQ0QsTUFBSSxNQUFNLEdBQUcsa0JBQVk7QUFDdkIsV0FBTyxZQUFZO0FBQ2pCLGFBQU8sT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFBO0tBQ25DLENBQUE7R0FDRixDQUFBO0FBQ0QsTUFBSSxDQUFDLEVBQUUsR0FBRyxRQUFRLEVBQUUsQ0FBQTtBQUNwQixNQUFJLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLEdBQUcsRUFBRSxNQUFNLENBQUMsQ0FBQTtDQUN0QyxDQUFDLENBQUE7O0FBRUYsUUFBUSxDQUFDLE9BQU8sRUFBRSxZQUFZO0FBQzVCLElBQUUsQ0FBQyx1QkFBdUIsRUFBRSxVQUFVLElBQUksRUFBRTs7O0FBQzFDLFFBQUksS0FBSyxHQUFHLEVBQUMsR0FBRyxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFDLENBQUE7QUFDckMsUUFBSSxFQUFFLEdBQUcsS0FBSyxDQUFBO0FBQ2QsUUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQ2xCLElBQUksQ0FBQyxVQUFVLElBQUksRUFBRTtBQUNwQixZQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSw0Q0FBNEMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFBO0tBQ3ZFLENBQUMsQ0FDRCxJQUFJLENBQUMsWUFBTTtBQUNWLGFBQU8sTUFBSyxFQUFFLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFBO0tBQzNCLENBQUMsQ0FDRCxJQUFJLENBQUMsVUFBVSxJQUFJLEVBQUU7QUFDcEIsWUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsZ0NBQWdDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQTtBQUNsRSxZQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxrQ0FBa0MsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQTtBQUM5RSxZQUFNLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxrQ0FBa0MsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFBO0FBQ3hFLFVBQUksRUFBRSxDQUFBO0tBQ1AsQ0FBQyxTQUNJLENBQUMsSUFBSSxDQUFDLENBQUE7R0FDZixDQUFDLENBQUE7O0FBRUYsSUFBRSxDQUFDLCtCQUErQixFQUFFLFVBQVUsSUFBSSxFQUFFO0FBQ2xELFFBQUksS0FBSyxHQUFHLEVBQUMsR0FBRyxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFDLENBQUE7QUFDbkMsUUFBSSxFQUFFLEdBQUcsS0FBSyxDQUFBO0FBQ2QsUUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQ2xCLElBQUksQ0FBQyxVQUFVLElBQUksRUFBRTtBQUNwQixVQUFJLENBQUMsSUFBSSxLQUFLLENBQUMsMkJBQTJCLENBQUMsQ0FBQyxDQUFBO0tBQzdDLENBQUMsU0FDSSxDQUFDLFVBQVUsQ0FBQyxFQUFFO0FBQ2xCLFlBQU0sQ0FBQyxDQUFDLFlBQVksS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUE7QUFDbkMsVUFBSSxFQUFFLENBQUE7S0FDUCxDQUFDLENBQUE7R0FDTCxDQUFDLENBQUE7Q0FDSCxDQUFDLENBQUEiLCJmaWxlIjoiL3Vzci9zcmMvYXBwL3Rlc3Qvc3BlYy9zdGFydC50ZXN0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZ2xvYmFsIGRlc2NyaWJlIGl0IGJlZm9yZSAqL1xuaW1wb3J0IHtleHBlY3R9IGZyb20gJ2NoYWknXG5pbXBvcnQgc3QgZnJvbSAnLi4vLi4vc3JjL3N0YXJ0J1xuaW1wb3J0IGRhdGFiYXNlIGZyb20gJy4uLy4uL3NyYy9kYXRhYmFzZSdcblxuYmVmb3JlKGZ1bmN0aW9uICgpIHtcbiAgbGV0IGdldCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHtvazogdHJ1ZX0pXG4gIH1cbiAgbGV0IHJlbW92ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7b2s6IHRydWV9KVxuICAgIH1cbiAgfVxuICB0aGlzLmRiID0gZGF0YWJhc2UoKVxuICB0aGlzLnN0YXJ0ID0gc3QodGhpcy5kYiwgZ2V0LCByZW1vdmUpXG59KVxuXG5kZXNjcmliZSgnc3RhcnQnLCBmdW5jdGlvbiAoKSB7XG4gIGl0KCdzaG91bGQgc3RhcnQgZXBoZW1ib3QnLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgIGxldCBsZXZlbCA9IHtudW06IDIsIHVuaXQ6ICdtaW51dGVzJ31cbiAgICBsZXQgaWQgPSAnc3VwJ1xuICAgIHRoaXMuc3RhcnQoaWQsIGxldmVsKVxuICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgZXhwZWN0KGRhdGEub2ssICdTdGFydCBzaG91bGQgaGF2ZSB0cmlnZ2VyZWQgZ2V0IGFuZCByZW1vdmUnKS50by5iZS5va1xuICAgICAgfSlcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGIuZmluZE9uZShpZClcbiAgICAgIH0pXG4gICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICBleHBlY3QoZGF0YS5faWQsICdUaGUgX2lkIHNob3VsZCBoYXZlIGJlZW4gc2F2ZWQnKS50by5iZS5lcXVhbChpZClcbiAgICAgICAgZXhwZWN0KGRhdGEubGV2ZWwsICdUaGUgbGV2ZWwgc2hvdWxkIGhhdmUgYmVlbiBzYXZlZCcpLnRvLmJlLmRlZXAuZXF1YWwobGV2ZWwpXG4gICAgICAgIGV4cGVjdChkYXRhLnByb2MsICdBIHRpbWVvdXQgc2hvdWxkIGhhdmUgYmVlbiBzYXZlZCcpLnRvLmJlLmFuKCdvYmplY3QnKVxuICAgICAgICBkb25lKClcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goZG9uZSlcbiAgfSlcblxuICBpdCgnc2hvdWxkIGZhaWwgb24gaW52YWxpZCBsZXZlbHMnLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgIGxldCBsZXZlbCA9IHtudW06IDIsIHVuaXQ6ICdidXR0cyd9XG4gICAgbGV0IGlkID0gJ3N1cCdcbiAgICB0aGlzLnN0YXJ0KGlkLCBsZXZlbClcbiAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIGRvbmUobmV3IEVycm9yKCd0aGVuIHNob3VsZCBub3QgYmUgY2FsbGVkJykpXG4gICAgICB9KVxuICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGV4cGVjdChlIGluc3RhbmNlb2YgRXJyb3IpLnRvLmJlLm9rXG4gICAgICAgIGRvbmUoKVxuICAgICAgfSlcbiAgfSlcbn0pXG4iXX0=",
    "map": {
      "version": 3,
      "sources": [
        "/usr/src/app/test/spec/start.test.js"
      ],
      "names": [],
      "mappings": ";;;;;;IACQ,MAAM,WAAO,MAAM,EAAnB,MAAM;;IACP,EAAE,2BAAM,iBAAiB;;IACzB,QAAQ,2BAAM,oBAAoB;;AAEzC,MAAM,CAAC,YAAY;AACjB,MAAI,GAAG,GAAG,eAAY;AACpB,WAAO,OAAO,CAAC,OAAO,CAAC,EAAC,EAAE,EAAE,IAAI,EAAC,CAAC,CAAA;GACnC,CAAA;AACD,MAAI,MAAM,GAAG,kBAAY;AACvB,WAAO,YAAY;AACjB,aAAO,OAAO,CAAC,OAAO,CAAC,EAAC,EAAE,EAAE,IAAI,EAAC,CAAC,CAAA;KACnC,CAAA;GACF,CAAA;AACD,MAAI,CAAC,EAAE,GAAG,QAAQ,EAAE,CAAA;AACpB,MAAI,CAAC,KAAK,GAAG,EAAE,CAAC,IAAI,CAAC,EAAE,EAAE,GAAG,EAAE,MAAM,CAAC,CAAA;CACtC,CAAC,CAAA;;AAEF,QAAQ,CAAC,OAAO,EAAE,YAAY;AAC5B,IAAE,CAAC,uBAAuB,EAAE,UAAU,IAAI,EAAE;;;AAC1C,QAAI,KAAK,GAAG,EAAC,GAAG,EAAE,CAAC,EAAE,IAAI,EAAE,SAAS,EAAC,CAAA;AACrC,QAAI,EAAE,GAAG,KAAK,CAAA;AACd,QAAI,CAAC,KAAK,CAAC,EAAE,EAAE,KAAK,CAAC,CAClB,IAAI,CAAC,UAAU,IAAI,EAAE;AACpB,YAAM,CAAC,IAAI,CAAC,EAAE,EAAE,4CAA4C,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAA;KACvE,CAAC,CACD,IAAI,CAAC,YAAM;AACV,aAAO,MAAK,EAAE,CAAC,OAAO,CAAC,EAAE,CAAC,CAAA;KAC3B,CAAC,CACD,IAAI,CAAC,UAAU,IAAI,EAAE;AACpB,YAAM,CAAC,IAAI,CAAC,GAAG,EAAE,gCAAgC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,CAAA;AAClE,YAAM,CAAC,IAAI,CAAC,KAAK,EAAE,kCAAkC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAA;AAC9E,YAAM,CAAC,IAAI,CAAC,IAAI,EAAE,kCAAkC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,QAAQ,CAAC,CAAA;AACxE,UAAI,EAAE,CAAA;KACP,CAAC,SACI,CAAC,IAAI,CAAC,CAAA;GACf,CAAC,CAAA;;AAEF,IAAE,CAAC,+BAA+B,EAAE,UAAU,IAAI,EAAE;AAClD,QAAI,KAAK,GAAG,EAAC,GAAG,EAAE,CAAC,EAAE,IAAI,EAAE,OAAO,EAAC,CAAA;AACnC,QAAI,EAAE,GAAG,KAAK,CAAA;AACd,QAAI,CAAC,KAAK,CAAC,EAAE,EAAE,KAAK,CAAC,CAClB,IAAI,CAAC,UAAU,IAAI,EAAE;AACpB,UAAI,CAAC,IAAI,KAAK,CAAC,2BAA2B,CAAC,CAAC,CAAA;KAC7C,CAAC,SACI,CAAC,UAAU,CAAC,EAAE;AAClB,YAAM,CAAC,CAAC,YAAY,KAAK,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAA;AACnC,UAAI,EAAE,CAAA;KACP,CAAC,CAAA;GACL,CAAC,CAAA;CACH,CAAC,CAAA",
      "file": "/usr/src/app/test/spec/start.test.js",
      "sourcesContent": [
        "/* global describe it before */\nimport {expect} from 'chai'\nimport st from '../../src/start'\nimport database from '../../src/database'\n\nbefore(function () {\n  let get = function () {\n    return Promise.resolve({ok: true})\n  }\n  let remove = function () {\n    return function () {\n      return Promise.resolve({ok: true})\n    }\n  }\n  this.db = database()\n  this.start = st(this.db, get, remove)\n})\n\ndescribe('start', function () {\n  it('should start ephembot', function (done) {\n    let level = {num: 2, unit: 'minutes'}\n    let id = 'sup'\n    this.start(id, level)\n      .then(function (data) {\n        expect(data.ok, 'Start should have triggered get and remove').to.be.ok\n      })\n      .then(() => {\n        return this.db.findOne(id)\n      })\n      .then(function (data) {\n        expect(data._id, 'The _id should have been saved').to.be.equal(id)\n        expect(data.level, 'The level should have been saved').to.be.deep.equal(level)\n        expect(data.proc, 'A timeout should have been saved').to.be.an('object')\n        done()\n      })\n      .catch(done)\n  })\n\n  it('should fail on invalid levels', function (done) {\n    let level = {num: 2, unit: 'butts'}\n    let id = 'sup'\n    this.start(id, level)\n      .then(function (data) {\n        done(new Error('then should not be called'))\n      })\n      .catch(function (e) {\n        expect(e instanceof Error).to.be.ok\n        done()\n      })\n  })\n})\n"
      ]
    },
    "ast": null,
    "mtime": 1430410950166
  },
  "/usr/src/app/src/start.js:{}:4.7.16": {
    "code": "\"use strict\";\n\nvar _interopRequire = function (obj) { return obj && obj.__esModule ? obj[\"default\"] : obj; };\n\nvar config = _interopRequire(require(\"config\"));\n\nvar moment = _interopRequire(require(\"moment\"));\n\nvar debug = _interopRequire(require(\"debug\"));\n\nvar error = debug(\"ephembot:start\");\nvar log = debug(\"ephembot:start\");\n// Make logs go to stdout instead of stderr\nlog.log = console.log.bind(console);\n\n// Injected dependencies\nexports = module.exports = function start(db, get, remove) {\n  /**\n   * starts ephembot\n   *\n   * @param {string} - slack channel id\n   * @param {object} - `level`\n   * @return {promise}\n   */\n  return function start(chan, level) {\n    var interv = moment.duration(level.num, level.unit).asMilliseconds();\n    if (interv <= 0) {\n      return Promise.reject(new Error(\"\\n        Invalid level.\\n\\n        Please provide a number and unit that follows the `moment` API.\\n      \"));\n    }\n    /**\n     * Composes `get_history` and `remove` to remove the messages that\n     * are older than `level`\n     *\n     * @return {promise}\n     */\n    var go = function go() {\n      return get({\n        token: config.get(\"slack_token\"),\n        channel: chan,\n        latest: moment().subtract(level.num, level.unit).unix()\n      }).then(remove(config.get(\"slack_token\"))(chan))[\"catch\"](error);\n    };\n\n    /**\n     * Save the interval id (`proc`) and `level`\n     */\n    return db.put({\n      _id: chan,\n      level: level,\n      proc: setInterval(go, interv) // Execute `go` every `interv`\n    }).then(go) // After db operations are successful `go` right now.\n    ;\n  };\n};\nexports[\"@require\"] = [\"database\", \"get_history\", \"remove\"];\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi91c3Ivc3JjL2FwcC9zcmMvc3RhcnQuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztJQUFPLE1BQU0sMkJBQU0sUUFBUTs7SUFDcEIsTUFBTSwyQkFBTSxRQUFROztJQUVwQixLQUFLLDJCQUFNLE9BQU87O0FBQ3pCLElBQUksS0FBSyxHQUFHLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFBO0FBQ25DLElBQUksR0FBRyxHQUFHLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFBOztBQUVqQyxHQUFHLENBQUMsR0FBRyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFBOzs7QUFHbkMsT0FBTyxHQUFHLE1BQU0sQ0FBQyxPQUFPLEdBQUcsU0FBUyxLQUFLLENBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUU7Ozs7Ozs7O0FBUTFELFNBQU8sU0FBUyxLQUFLLENBQUUsSUFBSSxFQUFFLEtBQUssRUFBRTtBQUNsQyxRQUFJLE1BQU0sR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUNoRCxjQUFjLEVBQUUsQ0FBQTtBQUNuQixRQUFJLE1BQU0sSUFBSSxDQUFDLEVBQUU7QUFDZixhQUFPLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxLQUFLLCtHQUc3QixDQUFDLENBQUE7S0FDSjs7Ozs7OztBQU9ELFFBQUksRUFBRSxHQUFHLGNBQVk7QUFDbkIsYUFBTyxHQUFHLENBQUM7QUFDVCxhQUFLLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUM7QUFDaEMsZUFBTyxFQUFFLElBQUk7QUFDYixjQUFNLEVBQUUsTUFBTSxFQUFFLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksRUFBRTtPQUN4RCxDQUFDLENBQ0MsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsU0FDeEMsQ0FBQyxLQUFLLENBQUMsQ0FBQTtLQUNoQixDQUFBOzs7OztBQUtELFdBQU8sRUFBRSxDQUFDLEdBQUcsQ0FBQztBQUNaLFNBQUcsRUFBRSxJQUFJO0FBQ1QsV0FBSyxFQUFFLEtBQUs7QUFDWixVQUFJLEVBQUUsV0FBVyxDQUFDLEVBQUUsRUFBRSxNQUFNLENBQUM7QUFBQSxLQUM5QixDQUFDLENBQ0QsSUFBSSxDQUFDLEVBQUUsQ0FBQztLQUFBO0dBQ1YsQ0FBQTtDQUNGLENBQUE7QUFDRCxPQUFPLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBRSxVQUFVLEVBQUUsYUFBYSxFQUFFLFFBQVEsQ0FBRSxDQUFBIiwiZmlsZSI6Ii91c3Ivc3JjL2FwcC9zcmMvc3RhcnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY29uZmlnIGZyb20gJ2NvbmZpZydcbmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50J1xuXG5pbXBvcnQgZGVidWcgZnJvbSAnZGVidWcnXG5sZXQgZXJyb3IgPSBkZWJ1ZygnZXBoZW1ib3Q6c3RhcnQnKVxubGV0IGxvZyA9IGRlYnVnKCdlcGhlbWJvdDpzdGFydCcpXG4vLyBNYWtlIGxvZ3MgZ28gdG8gc3Rkb3V0IGluc3RlYWQgb2Ygc3RkZXJyXG5sb2cubG9nID0gY29uc29sZS5sb2cuYmluZChjb25zb2xlKVxuXG4vLyBJbmplY3RlZCBkZXBlbmRlbmNpZXNcbmV4cG9ydHMgPSBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIHN0YXJ0IChkYiwgZ2V0LCByZW1vdmUpIHtcbiAgLyoqXG4gICAqIHN0YXJ0cyBlcGhlbWJvdFxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gLSBzbGFjayBjaGFubmVsIGlkXG4gICAqIEBwYXJhbSB7b2JqZWN0fSAtIGBsZXZlbGBcbiAgICogQHJldHVybiB7cHJvbWlzZX1cbiAgICovXG4gIHJldHVybiBmdW5jdGlvbiBzdGFydCAoY2hhbiwgbGV2ZWwpIHtcbiAgICBsZXQgaW50ZXJ2ID0gbW9tZW50LmR1cmF0aW9uKGxldmVsLm51bSwgbGV2ZWwudW5pdClcbiAgICAgIC5hc01pbGxpc2Vjb25kcygpXG4gICAgaWYgKGludGVydiA8PSAwKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKGBcbiAgICAgICAgSW52YWxpZCBsZXZlbC5cXG5cbiAgICAgICAgUGxlYXNlIHByb3ZpZGUgYSBudW1iZXIgYW5kIHVuaXQgdGhhdCBmb2xsb3dzIHRoZSBcXGBtb21lbnRcXGAgQVBJLlxuICAgICAgYCkpXG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbXBvc2VzIGBnZXRfaGlzdG9yeWAgYW5kIGByZW1vdmVgIHRvIHJlbW92ZSB0aGUgbWVzc2FnZXMgdGhhdFxuICAgICAqIGFyZSBvbGRlciB0aGFuIGBsZXZlbGBcbiAgICAgKlxuICAgICAqIEByZXR1cm4ge3Byb21pc2V9XG4gICAgICovXG4gICAgbGV0IGdvID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIGdldCh7XG4gICAgICAgIHRva2VuOiBjb25maWcuZ2V0KCdzbGFja190b2tlbicpLFxuICAgICAgICBjaGFubmVsOiBjaGFuLFxuICAgICAgICBsYXRlc3Q6IG1vbWVudCgpLnN1YnRyYWN0KGxldmVsLm51bSwgbGV2ZWwudW5pdCkudW5peCgpXG4gICAgICB9KVxuICAgICAgICAudGhlbihyZW1vdmUoY29uZmlnLmdldCgnc2xhY2tfdG9rZW4nKSkoY2hhbikpXG4gICAgICAgIC5jYXRjaChlcnJvcilcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTYXZlIHRoZSBpbnRlcnZhbCBpZCAoYHByb2NgKSBhbmQgYGxldmVsYFxuICAgICAqL1xuICAgIHJldHVybiBkYi5wdXQoe1xuICAgICAgX2lkOiBjaGFuLFxuICAgICAgbGV2ZWw6IGxldmVsLFxuICAgICAgcHJvYzogc2V0SW50ZXJ2YWwoZ28sIGludGVydikgLy8gRXhlY3V0ZSBgZ29gIGV2ZXJ5IGBpbnRlcnZgXG4gICAgfSlcbiAgICAudGhlbihnbykgLy8gQWZ0ZXIgZGIgb3BlcmF0aW9ucyBhcmUgc3VjY2Vzc2Z1bCBgZ29gIHJpZ2h0IG5vdy5cbiAgfVxufVxuZXhwb3J0c1snQHJlcXVpcmUnXSA9IFsgJ2RhdGFiYXNlJywgJ2dldF9oaXN0b3J5JywgJ3JlbW92ZScgXVxuIl19",
    "map": {
      "version": 3,
      "sources": [
        "/usr/src/app/src/start.js"
      ],
      "names": [],
      "mappings": ";;;;IAAO,MAAM,2BAAM,QAAQ;;IACpB,MAAM,2BAAM,QAAQ;;IAEpB,KAAK,2BAAM,OAAO;;AACzB,IAAI,KAAK,GAAG,KAAK,CAAC,gBAAgB,CAAC,CAAA;AACnC,IAAI,GAAG,GAAG,KAAK,CAAC,gBAAgB,CAAC,CAAA;;AAEjC,GAAG,CAAC,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;;;AAGnC,OAAO,GAAG,MAAM,CAAC,OAAO,GAAG,SAAS,KAAK,CAAE,EAAE,EAAE,GAAG,EAAE,MAAM,EAAE;;;;;;;;AAQ1D,SAAO,SAAS,KAAK,CAAE,IAAI,EAAE,KAAK,EAAE;AAClC,QAAI,MAAM,GAAG,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,EAAE,KAAK,CAAC,IAAI,CAAC,CAChD,cAAc,EAAE,CAAA;AACnB,QAAI,MAAM,IAAI,CAAC,EAAE;AACf,aAAO,OAAO,CAAC,MAAM,CAAC,IAAI,KAAK,+GAG7B,CAAC,CAAA;KACJ;;;;;;;AAOD,QAAI,EAAE,GAAG,cAAY;AACnB,aAAO,GAAG,CAAC;AACT,aAAK,EAAE,MAAM,CAAC,GAAG,CAAC,aAAa,CAAC;AAChC,eAAO,EAAE,IAAI;AACb,cAAM,EAAE,MAAM,EAAE,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC,IAAI,EAAE;OACxD,CAAC,CACC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,SACxC,CAAC,KAAK,CAAC,CAAA;KAChB,CAAA;;;;;AAKD,WAAO,EAAE,CAAC,GAAG,CAAC;AACZ,SAAG,EAAE,IAAI;AACT,WAAK,EAAE,KAAK;AACZ,UAAI,EAAE,WAAW,CAAC,EAAE,EAAE,MAAM,CAAC;AAAA,KAC9B,CAAC,CACD,IAAI,CAAC,EAAE,CAAC;KAAA;GACV,CAAA;CACF,CAAA;AACD,OAAO,CAAC,UAAU,CAAC,GAAG,CAAE,UAAU,EAAE,aAAa,EAAE,QAAQ,CAAE,CAAA",
      "file": "/usr/src/app/src/start.js",
      "sourcesContent": [
        "import config from 'config'\nimport moment from 'moment'\n\nimport debug from 'debug'\nlet error = debug('ephembot:start')\nlet log = debug('ephembot:start')\n// Make logs go to stdout instead of stderr\nlog.log = console.log.bind(console)\n\n// Injected dependencies\nexports = module.exports = function start (db, get, remove) {\n  /**\n   * starts ephembot\n   *\n   * @param {string} - slack channel id\n   * @param {object} - `level`\n   * @return {promise}\n   */\n  return function start (chan, level) {\n    let interv = moment.duration(level.num, level.unit)\n      .asMilliseconds()\n    if (interv <= 0) {\n      return Promise.reject(new Error(`\n        Invalid level.\\n\n        Please provide a number and unit that follows the \\`moment\\` API.\n      `))\n    }\n    /**\n     * Composes `get_history` and `remove` to remove the messages that\n     * are older than `level`\n     *\n     * @return {promise}\n     */\n    let go = function () {\n      return get({\n        token: config.get('slack_token'),\n        channel: chan,\n        latest: moment().subtract(level.num, level.unit).unix()\n      })\n        .then(remove(config.get('slack_token'))(chan))\n        .catch(error)\n    }\n\n    /**\n     * Save the interval id (`proc`) and `level`\n     */\n    return db.put({\n      _id: chan,\n      level: level,\n      proc: setInterval(go, interv) // Execute `go` every `interv`\n    })\n    .then(go) // After db operations are successful `go` right now.\n  }\n}\nexports['@require'] = [ 'database', 'get_history', 'remove' ]\n"
      ]
    },
    "ast": null,
    "mtime": 1430415464646
  },
  "/usr/src/app/test/spec/stop.test.js:{}:4.7.16": {
    "code": "\"use strict\";\n\nvar _interopRequire = function (obj) { return obj && obj.__esModule ? obj[\"default\"] : obj; };\n\n/* global describe it before */\n\nvar expect = require(\"chai\").expect;\n\nvar sto = _interopRequire(require(\"../../src/stop\"));\n\nvar st = _interopRequire(require(\"../../src/start\"));\n\nvar database = _interopRequire(require(\"../../src/database\"));\n\nbefore(function () {\n  var get = function get() {\n    return Promise.resolve({ ok: true });\n  };\n  var remove = function remove() {\n    return function () {\n      return Promise.resolve({ ok: true });\n    };\n  };\n  var level = { num: 2, unit: \"minutes\" };\n  this.id = \"sup\";\n  this.db = database();\n\n  var start = st(this.db, get, remove, level);\n\n  start(this.id, level);\n\n  this.stop = sto(this.db);\n});\n\ndescribe(\"stop\", function () {\n  it(\"should stop ephembot\", function (done) {\n    var _this = this;\n\n    this.stop(this.id).then(function (data) {\n      expect(data.proc.ontimeout).to.be.not.ok;\n      expect(data._id).to.be.equal(_this.id);\n      done();\n    })[\"catch\"](done);\n  });\n});\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi91c3Ivc3JjL2FwcC90ZXN0L3NwZWMvc3RvcC50ZXN0LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztJQUNRLE1BQU0sV0FBTyxNQUFNLEVBQW5CLE1BQU07O0lBQ1AsR0FBRywyQkFBTSxnQkFBZ0I7O0lBQ3pCLEVBQUUsMkJBQU0saUJBQWlCOztJQUN6QixRQUFRLDJCQUFNLG9CQUFvQjs7QUFFekMsTUFBTSxDQUFDLFlBQVk7QUFDakIsTUFBSSxHQUFHLEdBQUcsZUFBWTtBQUNwQixXQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBQyxFQUFFLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQTtHQUNuQyxDQUFBO0FBQ0QsTUFBSSxNQUFNLEdBQUcsa0JBQVk7QUFDdkIsV0FBTyxZQUFZO0FBQ2pCLGFBQU8sT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFBO0tBQ25DLENBQUE7R0FDRixDQUFBO0FBQ0QsTUFBSSxLQUFLLEdBQUcsRUFBQyxHQUFHLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUMsQ0FBQTtBQUNyQyxNQUFJLENBQUMsRUFBRSxHQUFHLEtBQUssQ0FBQTtBQUNmLE1BQUksQ0FBQyxFQUFFLEdBQUcsUUFBUSxFQUFFLENBQUE7O0FBRXBCLE1BQUksS0FBSyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsS0FBSyxDQUFDLENBQUE7O0FBRTNDLE9BQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFBOztBQUVyQixNQUFJLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUE7Q0FDekIsQ0FBQyxDQUFBOztBQUVGLFFBQVEsQ0FBQyxNQUFNLEVBQUUsWUFBWTtBQUMzQixJQUFFLENBQUMsc0JBQXNCLEVBQUUsVUFBVSxJQUFJLEVBQUU7OztBQUN6QyxRQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FDZixJQUFJLENBQUMsVUFBQSxJQUFJLEVBQUk7QUFDWixZQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUE7QUFDeEMsWUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxNQUFLLEVBQUUsQ0FBQyxDQUFBO0FBQ3JDLFVBQUksRUFBRSxDQUFBO0tBQ1AsQ0FBQyxTQUNJLENBQUMsSUFBSSxDQUFDLENBQUE7R0FDZixDQUFDLENBQUE7Q0FDSCxDQUFDLENBQUEiLCJmaWxlIjoiL3Vzci9zcmMvYXBwL3Rlc3Qvc3BlYy9zdG9wLnRlc3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgZGVzY3JpYmUgaXQgYmVmb3JlICovXG5pbXBvcnQge2V4cGVjdH0gZnJvbSAnY2hhaSdcbmltcG9ydCBzdG8gZnJvbSAnLi4vLi4vc3JjL3N0b3AnXG5pbXBvcnQgc3QgZnJvbSAnLi4vLi4vc3JjL3N0YXJ0J1xuaW1wb3J0IGRhdGFiYXNlIGZyb20gJy4uLy4uL3NyYy9kYXRhYmFzZSdcblxuYmVmb3JlKGZ1bmN0aW9uICgpIHtcbiAgbGV0IGdldCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHtvazogdHJ1ZX0pXG4gIH1cbiAgbGV0IHJlbW92ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7b2s6IHRydWV9KVxuICAgIH1cbiAgfVxuICBsZXQgbGV2ZWwgPSB7bnVtOiAyLCB1bml0OiAnbWludXRlcyd9XG4gIHRoaXMuaWQgPSAnc3VwJ1xuICB0aGlzLmRiID0gZGF0YWJhc2UoKVxuXG4gIGxldCBzdGFydCA9IHN0KHRoaXMuZGIsIGdldCwgcmVtb3ZlLCBsZXZlbClcblxuICBzdGFydCh0aGlzLmlkLCBsZXZlbClcblxuICB0aGlzLnN0b3AgPSBzdG8odGhpcy5kYilcbn0pXG5cbmRlc2NyaWJlKCdzdG9wJywgZnVuY3Rpb24gKCkge1xuICBpdCgnc2hvdWxkIHN0b3AgZXBoZW1ib3QnLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgIHRoaXMuc3RvcCh0aGlzLmlkKVxuICAgICAgLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgIGV4cGVjdChkYXRhLnByb2Mub250aW1lb3V0KS50by5iZS5ub3Qub2tcbiAgICAgICAgZXhwZWN0KGRhdGEuX2lkKS50by5iZS5lcXVhbCh0aGlzLmlkKVxuICAgICAgICBkb25lKClcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goZG9uZSlcbiAgfSlcbn0pXG4iXX0=",
    "map": {
      "version": 3,
      "sources": [
        "/usr/src/app/test/spec/stop.test.js"
      ],
      "names": [],
      "mappings": ";;;;;;IACQ,MAAM,WAAO,MAAM,EAAnB,MAAM;;IACP,GAAG,2BAAM,gBAAgB;;IACzB,EAAE,2BAAM,iBAAiB;;IACzB,QAAQ,2BAAM,oBAAoB;;AAEzC,MAAM,CAAC,YAAY;AACjB,MAAI,GAAG,GAAG,eAAY;AACpB,WAAO,OAAO,CAAC,OAAO,CAAC,EAAC,EAAE,EAAE,IAAI,EAAC,CAAC,CAAA;GACnC,CAAA;AACD,MAAI,MAAM,GAAG,kBAAY;AACvB,WAAO,YAAY;AACjB,aAAO,OAAO,CAAC,OAAO,CAAC,EAAC,EAAE,EAAE,IAAI,EAAC,CAAC,CAAA;KACnC,CAAA;GACF,CAAA;AACD,MAAI,KAAK,GAAG,EAAC,GAAG,EAAE,CAAC,EAAE,IAAI,EAAE,SAAS,EAAC,CAAA;AACrC,MAAI,CAAC,EAAE,GAAG,KAAK,CAAA;AACf,MAAI,CAAC,EAAE,GAAG,QAAQ,EAAE,CAAA;;AAEpB,MAAI,KAAK,GAAG,EAAE,CAAC,IAAI,CAAC,EAAE,EAAE,GAAG,EAAE,MAAM,EAAE,KAAK,CAAC,CAAA;;AAE3C,OAAK,CAAC,IAAI,CAAC,EAAE,EAAE,KAAK,CAAC,CAAA;;AAErB,MAAI,CAAC,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,CAAA;CACzB,CAAC,CAAA;;AAEF,QAAQ,CAAC,MAAM,EAAE,YAAY;AAC3B,IAAE,CAAC,sBAAsB,EAAE,UAAU,IAAI,EAAE;;;AACzC,QAAI,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,CACf,IAAI,CAAC,UAAA,IAAI,EAAI;AACZ,YAAM,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAA;AACxC,YAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,MAAK,EAAE,CAAC,CAAA;AACrC,UAAI,EAAE,CAAA;KACP,CAAC,SACI,CAAC,IAAI,CAAC,CAAA;GACf,CAAC,CAAA;CACH,CAAC,CAAA",
      "file": "/usr/src/app/test/spec/stop.test.js",
      "sourcesContent": [
        "/* global describe it before */\nimport {expect} from 'chai'\nimport sto from '../../src/stop'\nimport st from '../../src/start'\nimport database from '../../src/database'\n\nbefore(function () {\n  let get = function () {\n    return Promise.resolve({ok: true})\n  }\n  let remove = function () {\n    return function () {\n      return Promise.resolve({ok: true})\n    }\n  }\n  let level = {num: 2, unit: 'minutes'}\n  this.id = 'sup'\n  this.db = database()\n\n  let start = st(this.db, get, remove, level)\n\n  start(this.id, level)\n\n  this.stop = sto(this.db)\n})\n\ndescribe('stop', function () {\n  it('should stop ephembot', function (done) {\n    this.stop(this.id)\n      .then(data => {\n        expect(data.proc.ontimeout).to.be.not.ok\n        expect(data._id).to.be.equal(this.id)\n        done()\n      })\n      .catch(done)\n  })\n})\n"
      ]
    },
    "ast": null,
    "mtime": 1429488306194
  },
  "/usr/src/app/src/stop.js:{}:4.7.16": {
    "code": "// Injected dependencies\n\"use strict\";\n\nexports = module.exports = function stop(db) {\n  /**\n   * Stops the interval set on a channel\n   *\n   * @param {string} - slack channel id\n   * @return {promise}\n   */\n  return function (channel) {\n    return db.findOne(channel).then(function (item) {\n      if (!item) return false;\n      clearInterval(item.proc);\n      return item;\n    });\n  };\n};\nexports[\"@require\"] = [\"database\"];\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi91c3Ivc3JjL2FwcC9zcmMvc3RvcC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFDQSxPQUFPLEdBQUcsTUFBTSxDQUFDLE9BQU8sR0FBRyxTQUFTLElBQUksQ0FBRSxFQUFFLEVBQUU7Ozs7Ozs7QUFPNUMsU0FBTyxVQUFVLE9BQU8sRUFBRTtBQUN4QixXQUFPLEVBQUUsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQ3ZCLElBQUksQ0FBQyxVQUFVLElBQUksRUFBRTtBQUNwQixVQUFJLENBQUMsSUFBSSxFQUFFLE9BQU8sS0FBSyxDQUFBO0FBQ3ZCLG1CQUFhLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBO0FBQ3hCLGFBQU8sSUFBSSxDQUFBO0tBQ1osQ0FBQyxDQUFBO0dBQ0wsQ0FBQTtDQUNGLENBQUE7QUFDRCxPQUFPLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBRSxVQUFVLENBQUUsQ0FBQSIsImZpbGUiOiIvdXNyL3NyYy9hcHAvc3JjL3N0b3AuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBJbmplY3RlZCBkZXBlbmRlbmNpZXNcbmV4cG9ydHMgPSBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIHN0b3AgKGRiKSB7XG4gIC8qKlxuICAgKiBTdG9wcyB0aGUgaW50ZXJ2YWwgc2V0IG9uIGEgY2hhbm5lbFxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gLSBzbGFjayBjaGFubmVsIGlkXG4gICAqIEByZXR1cm4ge3Byb21pc2V9XG4gICAqL1xuICByZXR1cm4gZnVuY3Rpb24gKGNoYW5uZWwpIHtcbiAgICByZXR1cm4gZGIuZmluZE9uZShjaGFubmVsKVxuICAgICAgLnRoZW4oZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgaWYgKCFpdGVtKSByZXR1cm4gZmFsc2VcbiAgICAgICAgY2xlYXJJbnRlcnZhbChpdGVtLnByb2MpXG4gICAgICAgIHJldHVybiBpdGVtXG4gICAgICB9KVxuICB9XG59XG5leHBvcnRzWydAcmVxdWlyZSddID0gWyAnZGF0YWJhc2UnIF1cbiJdfQ==",
    "map": {
      "version": 3,
      "sources": [
        "/usr/src/app/src/stop.js"
      ],
      "names": [],
      "mappings": ";;;AACA,OAAO,GAAG,MAAM,CAAC,OAAO,GAAG,SAAS,IAAI,CAAE,EAAE,EAAE;;;;;;;AAO5C,SAAO,UAAU,OAAO,EAAE;AACxB,WAAO,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,CACvB,IAAI,CAAC,UAAU,IAAI,EAAE;AACpB,UAAI,CAAC,IAAI,EAAE,OAAO,KAAK,CAAA;AACvB,mBAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;AACxB,aAAO,IAAI,CAAA;KACZ,CAAC,CAAA;GACL,CAAA;CACF,CAAA;AACD,OAAO,CAAC,UAAU,CAAC,GAAG,CAAE,UAAU,CAAE,CAAA",
      "file": "/usr/src/app/src/stop.js",
      "sourcesContent": [
        "// Injected dependencies\nexports = module.exports = function stop (db) {\n  /**\n   * Stops the interval set on a channel\n   *\n   * @param {string} - slack channel id\n   * @return {promise}\n   */\n  return function (channel) {\n    return db.findOne(channel)\n      .then(function (item) {\n        if (!item) return false\n        clearInterval(item.proc)\n        return item\n      })\n  }\n}\nexports['@require'] = [ 'database' ]\n"
      ]
    },
    "ast": null,
    "mtime": 1430414289603
  },
  "/usr/src/app/test/spec/stat.test.js:{}:4.7.16": {
    "code": "\"use strict\";\n\nvar _interopRequire = function (obj) { return obj && obj.__esModule ? obj[\"default\"] : obj; };\n\n/* global describe it before */\n\nvar expect = require(\"chai\").expect;\n\nvar st = _interopRequire(require(\"../../src/start\"));\n\nvar stat = _interopRequire(require(\"../../src/stat\"));\n\nvar database = _interopRequire(require(\"../../src/database\"));\n\nbefore(function () {\n  var get = function get() {\n    return Promise.resolve({ ok: true });\n  };\n  var remove = function remove() {\n    return function () {\n      return Promise.resolve({ ok: true });\n    };\n  };\n  this.level = { num: 2, unit: \"minutes\" };\n  this.id = \"sup\";\n  this.db = database();\n\n  var start = st(this.db, get, remove, this.level);\n\n  start(this.id, this.level);\n\n  this.stat = stat(this.db);\n});\n\ndescribe(\"stat\", function () {\n  it(\"should return the current level\", function (done) {\n    var _this = this;\n\n    this.stat(this.id).then(function (level) {\n      expect(level).to.be.equal(_this.level);\n      done();\n    })[\"catch\"](done);\n  });\n});\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi91c3Ivc3JjL2FwcC90ZXN0L3NwZWMvc3RhdC50ZXN0LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztJQUNRLE1BQU0sV0FBTyxNQUFNLEVBQW5CLE1BQU07O0lBQ1AsRUFBRSwyQkFBTSxpQkFBaUI7O0lBQ3pCLElBQUksMkJBQU0sZ0JBQWdCOztJQUMxQixRQUFRLDJCQUFNLG9CQUFvQjs7QUFFekMsTUFBTSxDQUFDLFlBQVk7QUFDakIsTUFBSSxHQUFHLEdBQUcsZUFBWTtBQUNwQixXQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBQyxFQUFFLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQTtHQUNuQyxDQUFBO0FBQ0QsTUFBSSxNQUFNLEdBQUcsa0JBQVk7QUFDdkIsV0FBTyxZQUFZO0FBQ2pCLGFBQU8sT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFBO0tBQ25DLENBQUE7R0FDRixDQUFBO0FBQ0QsTUFBSSxDQUFDLEtBQUssR0FBRyxFQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBQyxDQUFBO0FBQ3RDLE1BQUksQ0FBQyxFQUFFLEdBQUcsS0FBSyxDQUFBO0FBQ2YsTUFBSSxDQUFDLEVBQUUsR0FBRyxRQUFRLEVBQUUsQ0FBQTs7QUFFcEIsTUFBSSxLQUFLLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUE7O0FBRWhELE9BQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQTs7QUFFMUIsTUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFBO0NBQzFCLENBQUMsQ0FBQTs7QUFFRixRQUFRLENBQUMsTUFBTSxFQUFFLFlBQVk7QUFDM0IsSUFBRSxDQUFDLGlDQUFpQyxFQUFFLFVBQVUsSUFBSSxFQUFFOzs7QUFDcEQsUUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQ2YsSUFBSSxDQUFDLFVBQUEsS0FBSyxFQUFJO0FBQ2IsWUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLE1BQUssS0FBSyxDQUFDLENBQUE7QUFDckMsVUFBSSxFQUFFLENBQUE7S0FDUCxDQUFDLFNBQ0ksQ0FBQyxJQUFJLENBQUMsQ0FBQTtHQUNmLENBQUMsQ0FBQTtDQUNILENBQUMsQ0FBQSIsImZpbGUiOiIvdXNyL3NyYy9hcHAvdGVzdC9zcGVjL3N0YXQudGVzdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGdsb2JhbCBkZXNjcmliZSBpdCBiZWZvcmUgKi9cbmltcG9ydCB7ZXhwZWN0fSBmcm9tICdjaGFpJ1xuaW1wb3J0IHN0IGZyb20gJy4uLy4uL3NyYy9zdGFydCdcbmltcG9ydCBzdGF0IGZyb20gJy4uLy4uL3NyYy9zdGF0J1xuaW1wb3J0IGRhdGFiYXNlIGZyb20gJy4uLy4uL3NyYy9kYXRhYmFzZSdcblxuYmVmb3JlKGZ1bmN0aW9uICgpIHtcbiAgbGV0IGdldCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHtvazogdHJ1ZX0pXG4gIH1cbiAgbGV0IHJlbW92ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7b2s6IHRydWV9KVxuICAgIH1cbiAgfVxuICB0aGlzLmxldmVsID0ge251bTogMiwgdW5pdDogJ21pbnV0ZXMnfVxuICB0aGlzLmlkID0gJ3N1cCdcbiAgdGhpcy5kYiA9IGRhdGFiYXNlKClcblxuICBsZXQgc3RhcnQgPSBzdCh0aGlzLmRiLCBnZXQsIHJlbW92ZSwgdGhpcy5sZXZlbClcblxuICBzdGFydCh0aGlzLmlkLCB0aGlzLmxldmVsKVxuXG4gIHRoaXMuc3RhdCA9IHN0YXQodGhpcy5kYilcbn0pXG5cbmRlc2NyaWJlKCdzdGF0JywgZnVuY3Rpb24gKCkge1xuICBpdCgnc2hvdWxkIHJldHVybiB0aGUgY3VycmVudCBsZXZlbCcsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgdGhpcy5zdGF0KHRoaXMuaWQpXG4gICAgICAudGhlbihsZXZlbCA9PiB7XG4gICAgICAgIGV4cGVjdChsZXZlbCkudG8uYmUuZXF1YWwodGhpcy5sZXZlbClcbiAgICAgICAgZG9uZSgpXG4gICAgICB9KVxuICAgICAgLmNhdGNoKGRvbmUpXG4gIH0pXG59KVxuIl19",
    "map": {
      "version": 3,
      "sources": [
        "/usr/src/app/test/spec/stat.test.js"
      ],
      "names": [],
      "mappings": ";;;;;;IACQ,MAAM,WAAO,MAAM,EAAnB,MAAM;;IACP,EAAE,2BAAM,iBAAiB;;IACzB,IAAI,2BAAM,gBAAgB;;IAC1B,QAAQ,2BAAM,oBAAoB;;AAEzC,MAAM,CAAC,YAAY;AACjB,MAAI,GAAG,GAAG,eAAY;AACpB,WAAO,OAAO,CAAC,OAAO,CAAC,EAAC,EAAE,EAAE,IAAI,EAAC,CAAC,CAAA;GACnC,CAAA;AACD,MAAI,MAAM,GAAG,kBAAY;AACvB,WAAO,YAAY;AACjB,aAAO,OAAO,CAAC,OAAO,CAAC,EAAC,EAAE,EAAE,IAAI,EAAC,CAAC,CAAA;KACnC,CAAA;GACF,CAAA;AACD,MAAI,CAAC,KAAK,GAAG,EAAC,GAAG,EAAE,CAAC,EAAE,IAAI,EAAE,SAAS,EAAC,CAAA;AACtC,MAAI,CAAC,EAAE,GAAG,KAAK,CAAA;AACf,MAAI,CAAC,EAAE,GAAG,QAAQ,EAAE,CAAA;;AAEpB,MAAI,KAAK,GAAG,EAAE,CAAC,IAAI,CAAC,EAAE,EAAE,GAAG,EAAE,MAAM,EAAE,IAAI,CAAC,KAAK,CAAC,CAAA;;AAEhD,OAAK,CAAC,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,KAAK,CAAC,CAAA;;AAE1B,MAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,CAAA;CAC1B,CAAC,CAAA;;AAEF,QAAQ,CAAC,MAAM,EAAE,YAAY;AAC3B,IAAE,CAAC,iCAAiC,EAAE,UAAU,IAAI,EAAE;;;AACpD,QAAI,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,CACf,IAAI,CAAC,UAAA,KAAK,EAAI;AACb,YAAM,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,MAAK,KAAK,CAAC,CAAA;AACrC,UAAI,EAAE,CAAA;KACP,CAAC,SACI,CAAC,IAAI,CAAC,CAAA;GACf,CAAC,CAAA;CACH,CAAC,CAAA",
      "file": "/usr/src/app/test/spec/stat.test.js",
      "sourcesContent": [
        "/* global describe it before */\nimport {expect} from 'chai'\nimport st from '../../src/start'\nimport stat from '../../src/stat'\nimport database from '../../src/database'\n\nbefore(function () {\n  let get = function () {\n    return Promise.resolve({ok: true})\n  }\n  let remove = function () {\n    return function () {\n      return Promise.resolve({ok: true})\n    }\n  }\n  this.level = {num: 2, unit: 'minutes'}\n  this.id = 'sup'\n  this.db = database()\n\n  let start = st(this.db, get, remove, this.level)\n\n  start(this.id, this.level)\n\n  this.stat = stat(this.db)\n})\n\ndescribe('stat', function () {\n  it('should return the current level', function (done) {\n    this.stat(this.id)\n      .then(level => {\n        expect(level).to.be.equal(this.level)\n        done()\n      })\n      .catch(done)\n  })\n})\n"
      ]
    },
    "ast": null,
    "mtime": 1429488306194
  },
  "/usr/src/app/src/stat.js:{}:4.7.16": {
    "code": "// Injected dependencies\n\"use strict\";\n\nexports = module.exports = function start(db) {\n  /**\n   * Returns the given channels current level\n   *\n   * @param {string}\n   * @return {object}\n   */\n  return function (channel) {\n    return db.findOne(channel).then(function (item) {\n      if (!item) return null;\n      return item.level;\n    });\n  };\n};\nexports[\"@require\"] = [\"database\", \"get_history\", \"remove\"];\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi91c3Ivc3JjL2FwcC9zcmMvc3RhdC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFDQSxPQUFPLEdBQUcsTUFBTSxDQUFDLE9BQU8sR0FBRyxTQUFTLEtBQUssQ0FBRSxFQUFFLEVBQUU7Ozs7Ozs7QUFPN0MsU0FBTyxVQUFVLE9BQU8sRUFBRTtBQUN4QixXQUFPLEVBQUUsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQ3ZCLElBQUksQ0FBQyxVQUFVLElBQUksRUFBRTtBQUNwQixVQUFJLENBQUMsSUFBSSxFQUFFLE9BQU8sSUFBSSxDQUFBO0FBQ3RCLGFBQU8sSUFBSSxDQUFDLEtBQUssQ0FBQTtLQUNsQixDQUFDLENBQUE7R0FDTCxDQUFBO0NBQ0YsQ0FBQTtBQUNELE9BQU8sQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFFLFVBQVUsRUFBRSxhQUFhLEVBQUUsUUFBUSxDQUFFLENBQUEiLCJmaWxlIjoiL3Vzci9zcmMvYXBwL3NyYy9zdGF0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gSW5qZWN0ZWQgZGVwZW5kZW5jaWVzXG5leHBvcnRzID0gbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBzdGFydCAoZGIpIHtcbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGdpdmVuIGNoYW5uZWxzIGN1cnJlbnQgbGV2ZWxcbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9XG4gICAqIEByZXR1cm4ge29iamVjdH1cbiAgICovXG4gIHJldHVybiBmdW5jdGlvbiAoY2hhbm5lbCkge1xuICAgIHJldHVybiBkYi5maW5kT25lKGNoYW5uZWwpXG4gICAgICAudGhlbihmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICBpZiAoIWl0ZW0pIHJldHVybiBudWxsXG4gICAgICAgIHJldHVybiBpdGVtLmxldmVsXG4gICAgICB9KVxuICB9XG59XG5leHBvcnRzWydAcmVxdWlyZSddID0gWyAnZGF0YWJhc2UnLCAnZ2V0X2hpc3RvcnknLCAncmVtb3ZlJyBdXG4iXX0=",
    "map": {
      "version": 3,
      "sources": [
        "/usr/src/app/src/stat.js"
      ],
      "names": [],
      "mappings": ";;;AACA,OAAO,GAAG,MAAM,CAAC,OAAO,GAAG,SAAS,KAAK,CAAE,EAAE,EAAE;;;;;;;AAO7C,SAAO,UAAU,OAAO,EAAE;AACxB,WAAO,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,CACvB,IAAI,CAAC,UAAU,IAAI,EAAE;AACpB,UAAI,CAAC,IAAI,EAAE,OAAO,IAAI,CAAA;AACtB,aAAO,IAAI,CAAC,KAAK,CAAA;KAClB,CAAC,CAAA;GACL,CAAA;CACF,CAAA;AACD,OAAO,CAAC,UAAU,CAAC,GAAG,CAAE,UAAU,EAAE,aAAa,EAAE,QAAQ,CAAE,CAAA",
      "file": "/usr/src/app/src/stat.js",
      "sourcesContent": [
        "// Injected dependencies\nexports = module.exports = function start (db) {\n  /**\n   * Returns the given channels current level\n   *\n   * @param {string}\n   * @return {object}\n   */\n  return function (channel) {\n    return db.findOne(channel)\n      .then(function (item) {\n        if (!item) return null\n        return item.level\n      })\n  }\n}\nexports['@require'] = [ 'database', 'get_history', 'remove' ]\n"
      ]
    },
    "ast": null,
    "mtime": 1430414267533
  },
  "/usr/src/app/test/spec/commands.test.js:{}:4.7.16": {
    "code": "\"use strict\";\n\nvar _interopRequire = function (obj) { return obj && obj.__esModule ? obj[\"default\"] : obj; };\n\n/* global describe it before */\n\nvar expect = require(\"chai\").expect;\n\nvar commands = _interopRequire(require(\"../../src/commands\"));\n\nbefore(function () {\n  var start = function start(channel, level) {\n    expect(channel, \"Missing payload.channel_id\").to.be.ok;\n    expect(level, \"Missing payload.text\").to.be.ok;\n    return Promise.resolve({ ok: true });\n  };\n  var stop = function stop(channel) {\n    expect(channel, \"Missing payload.channel_id\").to.be.ok;\n    return Promise.resolve({ ok: true });\n  };\n  var stat = function stat(channel) {\n    expect(channel, \"Missing payload.channel_id\").to.be.ok;\n    return Promise.resolve({ ok: true });\n  };\n  this.cmds = commands(start, stop, stat);\n});\n\ndescribe(\"commands\", function () {\n  describe(\"on\", function () {\n    it(\"should return a promise\", function (done) {\n      var payload = {\n        channel_id: \"hello\",\n        text: \"1 minute\"\n      };\n      this.cmds.on(payload).then(function () {\n        return done();\n      })[\"catch\"](done);\n    });\n  });\n\n  describe(\"off\", function () {\n    it(\"should return a promise\", function (done) {\n      var payload = {\n        channel_id: \"hello\"\n      };\n      this.cmds.off(payload).then(function () {\n        return done();\n      })[\"catch\"](done);\n    });\n  });\n\n  describe(\"level\", function () {\n    it(\"should parse payload.text into a valid level\", function (done) {\n      var payload = {\n        channel_id: \"hello\",\n        text: \"level 1 hour\"\n      };\n      this.cmds.level(payload).then(function (msg) {\n        expect(msg).to.match(/1 hour/);\n        done();\n      })[\"catch\"](done);\n    });\n  });\n\n  describe(\"stat\", function () {\n    it(\"should return a promise\", function (done) {\n      var payload = {\n        channel_id: \"hello\"\n      };\n      this.cmds.status(payload).then(function () {\n        return done();\n      })[\"catch\"](done);\n    });\n  });\n});\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi91c3Ivc3JjL2FwcC90ZXN0L3NwZWMvY29tbWFuZHMudGVzdC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7SUFDUSxNQUFNLFdBQU8sTUFBTSxFQUFuQixNQUFNOztJQUNQLFFBQVEsMkJBQU0sb0JBQW9COztBQUV6QyxNQUFNLENBQUMsWUFBWTtBQUNqQixNQUFJLEtBQUssR0FBRyxlQUFVLE9BQU8sRUFBRSxLQUFLLEVBQUU7QUFDcEMsVUFBTSxDQUFDLE9BQU8sRUFBRSw0QkFBNEIsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFBO0FBQ3RELFVBQU0sQ0FBQyxLQUFLLEVBQUUsc0JBQXNCLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQTtBQUM5QyxXQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBQyxFQUFFLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQTtHQUNuQyxDQUFBO0FBQ0QsTUFBSSxJQUFJLEdBQUcsY0FBVSxPQUFPLEVBQUU7QUFDNUIsVUFBTSxDQUFDLE9BQU8sRUFBRSw0QkFBNEIsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFBO0FBQ3RELFdBQU8sT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFBO0dBQ25DLENBQUE7QUFDRCxNQUFJLElBQUksR0FBRyxjQUFVLE9BQU8sRUFBRTtBQUM1QixVQUFNLENBQUMsT0FBTyxFQUFFLDRCQUE0QixDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUE7QUFDdEQsV0FBTyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUMsRUFBRSxFQUFFLElBQUksRUFBQyxDQUFDLENBQUE7R0FDbkMsQ0FBQTtBQUNELE1BQUksQ0FBQyxJQUFJLEdBQUcsUUFBUSxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUE7Q0FDeEMsQ0FBQyxDQUFBOztBQUVGLFFBQVEsQ0FBQyxVQUFVLEVBQUUsWUFBWTtBQUMvQixVQUFRLENBQUMsSUFBSSxFQUFFLFlBQVk7QUFDekIsTUFBRSxDQUFDLHlCQUF5QixFQUFFLFVBQVUsSUFBSSxFQUFFO0FBQzVDLFVBQUksT0FBTyxHQUFHO0FBQ1osa0JBQVUsRUFBRSxPQUFPO0FBQ25CLFlBQUksRUFBRSxVQUFVO09BQ2pCLENBQUE7QUFDRCxVQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FDbEIsSUFBSSxDQUFDO2VBQU0sSUFBSSxFQUFFO09BQUEsQ0FBQyxTQUNiLENBQUMsSUFBSSxDQUFDLENBQUE7S0FDZixDQUFDLENBQUE7R0FDSCxDQUFDLENBQUE7O0FBRUYsVUFBUSxDQUFDLEtBQUssRUFBRSxZQUFZO0FBQzFCLE1BQUUsQ0FBQyx5QkFBeUIsRUFBRSxVQUFVLElBQUksRUFBRTtBQUM1QyxVQUFJLE9BQU8sR0FBRztBQUNaLGtCQUFVLEVBQUUsT0FBTztPQUNwQixDQUFBO0FBQ0QsVUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQ25CLElBQUksQ0FBQztlQUFNLElBQUksRUFBRTtPQUFBLENBQUMsU0FDYixDQUFDLElBQUksQ0FBQyxDQUFBO0tBQ2YsQ0FBQyxDQUFBO0dBQ0gsQ0FBQyxDQUFBOztBQUVGLFVBQVEsQ0FBQyxPQUFPLEVBQUUsWUFBWTtBQUM1QixNQUFFLENBQUMsOENBQThDLEVBQUUsVUFBVSxJQUFJLEVBQUU7QUFDakUsVUFBSSxPQUFPLEdBQUc7QUFDWixrQkFBVSxFQUFFLE9BQU87QUFDbkIsWUFBSSxFQUFFLGNBQWM7T0FDckIsQ0FBQTtBQUNELFVBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUNyQixJQUFJLENBQUMsVUFBQyxHQUFHLEVBQUs7QUFDYixjQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQTtBQUM5QixZQUFJLEVBQUUsQ0FBQTtPQUNQLENBQUMsU0FDSSxDQUFDLElBQUksQ0FBQyxDQUFBO0tBQ2YsQ0FBQyxDQUFBO0dBQ0gsQ0FBQyxDQUFBOztBQUVGLFVBQVEsQ0FBQyxNQUFNLEVBQUUsWUFBWTtBQUMzQixNQUFFLENBQUMseUJBQXlCLEVBQUUsVUFBVSxJQUFJLEVBQUU7QUFDNUMsVUFBSSxPQUFPLEdBQUc7QUFDWixrQkFBVSxFQUFFLE9BQU87T0FDcEIsQ0FBQTtBQUNELFVBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUN0QixJQUFJLENBQUM7ZUFBTSxJQUFJLEVBQUU7T0FBQSxDQUFDLFNBQ2IsQ0FBQyxJQUFJLENBQUMsQ0FBQTtLQUNmLENBQUMsQ0FBQTtHQUNILENBQUMsQ0FBQTtDQUNILENBQUMsQ0FBQSIsImZpbGUiOiIvdXNyL3NyYy9hcHAvdGVzdC9zcGVjL2NvbW1hbmRzLnRlc3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgZGVzY3JpYmUgaXQgYmVmb3JlICovXG5pbXBvcnQge2V4cGVjdH0gZnJvbSAnY2hhaSdcbmltcG9ydCBjb21tYW5kcyBmcm9tICcuLi8uLi9zcmMvY29tbWFuZHMnXG5cbmJlZm9yZShmdW5jdGlvbiAoKSB7XG4gIGxldCBzdGFydCA9IGZ1bmN0aW9uIChjaGFubmVsLCBsZXZlbCkge1xuICAgIGV4cGVjdChjaGFubmVsLCAnTWlzc2luZyBwYXlsb2FkLmNoYW5uZWxfaWQnKS50by5iZS5va1xuICAgIGV4cGVjdChsZXZlbCwgJ01pc3NpbmcgcGF5bG9hZC50ZXh0JykudG8uYmUub2tcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHtvazogdHJ1ZX0pXG4gIH1cbiAgbGV0IHN0b3AgPSBmdW5jdGlvbiAoY2hhbm5lbCkge1xuICAgIGV4cGVjdChjaGFubmVsLCAnTWlzc2luZyBwYXlsb2FkLmNoYW5uZWxfaWQnKS50by5iZS5va1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoe29rOiB0cnVlfSlcbiAgfVxuICBsZXQgc3RhdCA9IGZ1bmN0aW9uIChjaGFubmVsKSB7XG4gICAgZXhwZWN0KGNoYW5uZWwsICdNaXNzaW5nIHBheWxvYWQuY2hhbm5lbF9pZCcpLnRvLmJlLm9rXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7b2s6IHRydWV9KVxuICB9XG4gIHRoaXMuY21kcyA9IGNvbW1hbmRzKHN0YXJ0LCBzdG9wLCBzdGF0KVxufSlcblxuZGVzY3JpYmUoJ2NvbW1hbmRzJywgZnVuY3Rpb24gKCkge1xuICBkZXNjcmliZSgnb24nLCBmdW5jdGlvbiAoKSB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gYSBwcm9taXNlJywgZnVuY3Rpb24gKGRvbmUpIHtcbiAgICAgIGxldCBwYXlsb2FkID0ge1xuICAgICAgICBjaGFubmVsX2lkOiAnaGVsbG8nLFxuICAgICAgICB0ZXh0OiAnMSBtaW51dGUnXG4gICAgICB9XG4gICAgICB0aGlzLmNtZHMub24ocGF5bG9hZClcbiAgICAgICAgLnRoZW4oKCkgPT4gZG9uZSgpKVxuICAgICAgICAuY2F0Y2goZG9uZSlcbiAgICB9KVxuICB9KVxuXG4gIGRlc2NyaWJlKCdvZmYnLCBmdW5jdGlvbiAoKSB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gYSBwcm9taXNlJywgZnVuY3Rpb24gKGRvbmUpIHtcbiAgICAgIGxldCBwYXlsb2FkID0ge1xuICAgICAgICBjaGFubmVsX2lkOiAnaGVsbG8nXG4gICAgICB9XG4gICAgICB0aGlzLmNtZHMub2ZmKHBheWxvYWQpXG4gICAgICAgIC50aGVuKCgpID0+IGRvbmUoKSlcbiAgICAgICAgLmNhdGNoKGRvbmUpXG4gICAgfSlcbiAgfSlcblxuICBkZXNjcmliZSgnbGV2ZWwnLCBmdW5jdGlvbiAoKSB7XG4gICAgaXQoJ3Nob3VsZCBwYXJzZSBwYXlsb2FkLnRleHQgaW50byBhIHZhbGlkIGxldmVsJywgZnVuY3Rpb24gKGRvbmUpIHtcbiAgICAgIGxldCBwYXlsb2FkID0ge1xuICAgICAgICBjaGFubmVsX2lkOiAnaGVsbG8nLFxuICAgICAgICB0ZXh0OiAnbGV2ZWwgMSBob3VyJ1xuICAgICAgfVxuICAgICAgdGhpcy5jbWRzLmxldmVsKHBheWxvYWQpXG4gICAgICAgIC50aGVuKChtc2cpID0+IHtcbiAgICAgICAgICBleHBlY3QobXNnKS50by5tYXRjaCgvMSBob3VyLylcbiAgICAgICAgICBkb25lKClcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKGRvbmUpXG4gICAgfSlcbiAgfSlcblxuICBkZXNjcmliZSgnc3RhdCcsIGZ1bmN0aW9uICgpIHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBhIHByb21pc2UnLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgICAgbGV0IHBheWxvYWQgPSB7XG4gICAgICAgIGNoYW5uZWxfaWQ6ICdoZWxsbydcbiAgICAgIH1cbiAgICAgIHRoaXMuY21kcy5zdGF0dXMocGF5bG9hZClcbiAgICAgICAgLnRoZW4oKCkgPT4gZG9uZSgpKVxuICAgICAgICAuY2F0Y2goZG9uZSlcbiAgICB9KVxuICB9KVxufSlcbiJdfQ==",
    "map": {
      "version": 3,
      "sources": [
        "/usr/src/app/test/spec/commands.test.js"
      ],
      "names": [],
      "mappings": "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",
      "file": "/usr/src/app/test/spec/commands.test.js",
      "sourcesContent": [
        "/* global describe it before */\nimport {expect} from 'chai'\nimport commands from '../../src/commands'\n\nbefore(function () {\n  let start = function (channel, level) {\n    expect(channel, 'Missing payload.channel_id').to.be.ok\n    expect(level, 'Missing payload.text').to.be.ok\n    return Promise.resolve({ok: true})\n  }\n  let stop = function (channel) {\n    expect(channel, 'Missing payload.channel_id').to.be.ok\n    return Promise.resolve({ok: true})\n  }\n  let stat = function (channel) {\n    expect(channel, 'Missing payload.channel_id').to.be.ok\n    return Promise.resolve({ok: true})\n  }\n  this.cmds = commands(start, stop, stat)\n})\n\ndescribe('commands', function () {\n  describe('on', function () {\n    it('should return a promise', function (done) {\n      let payload = {\n        channel_id: 'hello',\n        text: '1 minute'\n      }\n      this.cmds.on(payload)\n        .then(() => done())\n        .catch(done)\n    })\n  })\n\n  describe('off', function () {\n    it('should return a promise', function (done) {\n      let payload = {\n        channel_id: 'hello'\n      }\n      this.cmds.off(payload)\n        .then(() => done())\n        .catch(done)\n    })\n  })\n\n  describe('level', function () {\n    it('should parse payload.text into a valid level', function (done) {\n      let payload = {\n        channel_id: 'hello',\n        text: 'level 1 hour'\n      }\n      this.cmds.level(payload)\n        .then((msg) => {\n          expect(msg).to.match(/1 hour/)\n          done()\n        })\n        .catch(done)\n    })\n  })\n\n  describe('stat', function () {\n    it('should return a promise', function (done) {\n      let payload = {\n        channel_id: 'hello'\n      }\n      this.cmds.status(payload)\n        .then(() => done())\n        .catch(done)\n    })\n  })\n})\n"
      ]
    },
    "ast": null,
    "mtime": 1429488306194
  },
  "/usr/src/app/src/commands.js:{}:4.7.16": {
    "code": "\"use strict\";\n\nvar _interopRequire = function (obj) { return obj && obj.__esModule ? obj[\"default\"] : obj; };\n\nvar _ = _interopRequire(require(\"lodash-fp\"));\n\nvar debug = _interopRequire(require(\"debug\"));\n\n// let error = debug('ephembot:commands')\nvar log = debug(\"ephembot:commands\");\n// Make logs go to stdout instead of stderr\nlog.log = console.log.bind(console);\n\n// Injected dependencies\nexports = module.exports = function commandsModule(start, stop, stat) {\n  return {\n\n    /**\n     * Turns ephembot on with the default level of 15 minutes\n     *\n     * @return promise\n     * @example\n     *   /ephembot on\n     */\n    on: function on(cmd) {\n      log(\"on\", cmd.channel_id);\n\n      return start(cmd.channel_id, { num: 15, unit: \"minutes\" }).then(function () {\n        return \"Ephemeral level set to 15 minutes\";\n      });\n    },\n\n    /**\n     * Turns ephembot on with the provided level\n     *\n     * @example\n     *   /ephembot level 10 hours\n     */\n    level: (function (_level) {\n      var _levelWrapper = function level(_x) {\n        return _level.apply(this, arguments);\n      };\n\n      _levelWrapper.toString = function () {\n        return _level.toString();\n      };\n\n      return _levelWrapper;\n    })(function (cmd) {\n      var num = Number(cmd.text.split(\" \")[1]);\n      var unit = cmd.text.split(\" \")[2];\n\n      var level = { num: num, unit: unit };\n      log(\"level\", level);\n\n      if (_.isNaN(level)) {\n        return Promise.reject(new Error(\"Invalid level\"));\n      }\n\n      return start(cmd.channel_id, level).then(function () {\n        return \"Ephemeral level set to \" + level.num + \" \" + level.unit;\n      });\n    }),\n\n    /**\n     * Turns ephembot off\n     *\n     * @example\n     *   /ephembot off\n     */\n    off: function off(cmd) {\n      log(\"off\", cmd.channel_id);\n\n      return stop(cmd.channel_id).then(function () {\n        return \"Ephembot has been turned off\";\n      });\n    },\n\n    /**\n     * Returns the current level\n     *\n     * @example\n     *   /ephembot status\n     */\n    status: function status(cmd) {\n      log(\"status\", cmd.channel_id);\n\n      return stat(cmd.channel_id).then(function (level) {\n        return \"Level: {level.num} {level.unit}\";\n      });\n    }\n  };\n};\nexports[\"@require\"] = [\"start\", \"stop\", \"stat\"];\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi91c3Ivc3JjL2FwcC9zcmMvY29tbWFuZHMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztJQUFPLENBQUMsMkJBQU0sV0FBVzs7SUFDbEIsS0FBSywyQkFBTSxPQUFPOzs7QUFHekIsSUFBSSxHQUFHLEdBQUcsS0FBSyxDQUFDLG1CQUFtQixDQUFDLENBQUE7O0FBRXBDLEdBQUcsQ0FBQyxHQUFHLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUE7OztBQUduQyxPQUFPLEdBQUcsTUFBTSxDQUFDLE9BQU8sR0FBRyxTQUFTLGNBQWMsQ0FBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRTtBQUNyRSxTQUFPOzs7Ozs7Ozs7QUFTTCxRQUFNLFlBQVUsR0FBRyxFQUFFO0FBQ25CLFNBQUcsQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFBOztBQUV6QixhQUFPLEtBQUssQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLEVBQUMsR0FBRyxFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFDLENBQUMsQ0FDckQsSUFBSSxDQUFDLFlBQVk7QUFDaEIsZUFBTyxtQ0FBbUMsQ0FBQTtPQUMzQyxDQUFDLENBQUE7S0FDTDs7Ozs7Ozs7QUFRRDs7Ozs7Ozs7OztPQUFTLFVBQVUsR0FBRyxFQUFFO0FBQ3RCLFVBQUksR0FBRyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBO0FBQ3hDLFVBQUksSUFBSSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBOztBQUVqQyxVQUFJLEtBQUssR0FBRyxFQUFDLEdBQUcsRUFBSCxHQUFHLEVBQUUsSUFBSSxFQUFKLElBQUksRUFBQyxDQUFBO0FBQ3ZCLFNBQUcsQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUE7O0FBRW5CLFVBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsRUFBRTtBQUNsQixlQUFPLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxLQUFLLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQTtPQUNsRDs7QUFFRCxhQUFPLEtBQUssQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLEtBQUssQ0FBQyxDQUNoQyxJQUFJLENBQUMsWUFBWTtBQUNoQixlQUFPLHlCQUF5QixHQUFHLEtBQUssQ0FBQyxHQUFHLEdBQUcsR0FBRyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUE7T0FDaEUsQ0FBQyxDQUFBO0tBQ0wsQ0FBQTs7Ozs7Ozs7QUFRRCxTQUFPLGFBQVUsR0FBRyxFQUFFO0FBQ3BCLFNBQUcsQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFBOztBQUUxQixhQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQ3hCLElBQUksQ0FBQyxZQUFZO0FBQ2hCLDhDQUFxQztPQUN0QyxDQUFDLENBQUE7S0FDTDs7Ozs7Ozs7QUFRRCxZQUFVLGdCQUFVLEdBQUcsRUFBRTtBQUN2QixTQUFHLENBQUMsUUFBUSxFQUFFLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQTs7QUFFN0IsYUFBTyxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUN4QixJQUFJLENBQUMsVUFBVSxLQUFLLEVBQUU7QUFDckIsaURBQXdDO09BQ3pDLENBQUMsQ0FBQTtLQUNMO0dBQ0YsQ0FBQTtDQUNGLENBQUE7QUFDRCxPQUFPLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFBIiwiZmlsZSI6Ii91c3Ivc3JjL2FwcC9zcmMvY29tbWFuZHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gtZnAnXG5pbXBvcnQgZGVidWcgZnJvbSAnZGVidWcnXG5cbi8vIGxldCBlcnJvciA9IGRlYnVnKCdlcGhlbWJvdDpjb21tYW5kcycpXG5sZXQgbG9nID0gZGVidWcoJ2VwaGVtYm90OmNvbW1hbmRzJylcbi8vIE1ha2UgbG9ncyBnbyB0byBzdGRvdXQgaW5zdGVhZCBvZiBzdGRlcnJcbmxvZy5sb2cgPSBjb25zb2xlLmxvZy5iaW5kKGNvbnNvbGUpXG5cbi8vIEluamVjdGVkIGRlcGVuZGVuY2llc1xuZXhwb3J0cyA9IG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gY29tbWFuZHNNb2R1bGUgKHN0YXJ0LCBzdG9wLCBzdGF0KSB7XG4gIHJldHVybiB7XG5cbiAgICAvKipcbiAgICAgKiBUdXJucyBlcGhlbWJvdCBvbiB3aXRoIHRoZSBkZWZhdWx0IGxldmVsIG9mIDE1IG1pbnV0ZXNcbiAgICAgKlxuICAgICAqIEByZXR1cm4gcHJvbWlzZVxuICAgICAqIEBleGFtcGxlXG4gICAgICogICAvZXBoZW1ib3Qgb25cbiAgICAgKi9cbiAgICAnb24nOiBmdW5jdGlvbiAoY21kKSB7XG4gICAgICBsb2coJ29uJywgY21kLmNoYW5uZWxfaWQpXG5cbiAgICAgIHJldHVybiBzdGFydChjbWQuY2hhbm5lbF9pZCwge251bTogMTUsIHVuaXQ6ICdtaW51dGVzJ30pXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gJ0VwaGVtZXJhbCBsZXZlbCBzZXQgdG8gMTUgbWludXRlcydcbiAgICAgICAgfSlcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogVHVybnMgZXBoZW1ib3Qgb24gd2l0aCB0aGUgcHJvdmlkZWQgbGV2ZWxcbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogICAvZXBoZW1ib3QgbGV2ZWwgMTAgaG91cnNcbiAgICAgKi9cbiAgICAnbGV2ZWwnOiBmdW5jdGlvbiAoY21kKSB7XG4gICAgICBsZXQgbnVtID0gTnVtYmVyKGNtZC50ZXh0LnNwbGl0KCcgJylbMV0pXG4gICAgICBsZXQgdW5pdCA9IGNtZC50ZXh0LnNwbGl0KCcgJylbMl1cblxuICAgICAgbGV0IGxldmVsID0ge251bSwgdW5pdH1cbiAgICAgIGxvZygnbGV2ZWwnLCBsZXZlbClcblxuICAgICAgaWYgKF8uaXNOYU4obGV2ZWwpKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoJ0ludmFsaWQgbGV2ZWwnKSlcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHN0YXJ0KGNtZC5jaGFubmVsX2lkLCBsZXZlbClcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiAnRXBoZW1lcmFsIGxldmVsIHNldCB0byAnICsgbGV2ZWwubnVtICsgJyAnICsgbGV2ZWwudW5pdFxuICAgICAgICB9KVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBUdXJucyBlcGhlbWJvdCBvZmZcbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogICAvZXBoZW1ib3Qgb2ZmXG4gICAgICovXG4gICAgJ29mZic6IGZ1bmN0aW9uIChjbWQpIHtcbiAgICAgIGxvZygnb2ZmJywgY21kLmNoYW5uZWxfaWQpXG5cbiAgICAgIHJldHVybiBzdG9wKGNtZC5jaGFubmVsX2lkKVxuICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGBFcGhlbWJvdCBoYXMgYmVlbiB0dXJuZWQgb2ZmYFxuICAgICAgICB9KVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBjdXJyZW50IGxldmVsXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqICAgL2VwaGVtYm90IHN0YXR1c1xuICAgICAqL1xuICAgICdzdGF0dXMnOiBmdW5jdGlvbiAoY21kKSB7XG4gICAgICBsb2coJ3N0YXR1cycsIGNtZC5jaGFubmVsX2lkKVxuXG4gICAgICByZXR1cm4gc3RhdChjbWQuY2hhbm5lbF9pZClcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGxldmVsKSB7XG4gICAgICAgICAgcmV0dXJuIGBMZXZlbDoge2xldmVsLm51bX0ge2xldmVsLnVuaXR9YFxuICAgICAgICB9KVxuICAgIH1cbiAgfVxufVxuZXhwb3J0c1snQHJlcXVpcmUnXSA9IFsnc3RhcnQnLCAnc3RvcCcsICdzdGF0J11cbiJdfQ==",
    "map": {
      "version": 3,
      "sources": [
        "/usr/src/app/src/commands.js"
      ],
      "names": [],
      "mappings": ";;;;IAAO,CAAC,2BAAM,WAAW;;IAClB,KAAK,2BAAM,OAAO;;;AAGzB,IAAI,GAAG,GAAG,KAAK,CAAC,mBAAmB,CAAC,CAAA;;AAEpC,GAAG,CAAC,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;;;AAGnC,OAAO,GAAG,MAAM,CAAC,OAAO,GAAG,SAAS,cAAc,CAAE,KAAK,EAAE,IAAI,EAAE,IAAI,EAAE;AACrE,SAAO;;;;;;;;;AASL,QAAM,YAAU,GAAG,EAAE;AACnB,SAAG,CAAC,IAAI,EAAE,GAAG,CAAC,UAAU,CAAC,CAAA;;AAEzB,aAAO,KAAK,CAAC,GAAG,CAAC,UAAU,EAAE,EAAC,GAAG,EAAE,EAAE,EAAE,IAAI,EAAE,SAAS,EAAC,CAAC,CACrD,IAAI,CAAC,YAAY;AAChB,eAAO,mCAAmC,CAAA;OAC3C,CAAC,CAAA;KACL;;;;;;;;AAQD;;;;;;;;;;OAAS,UAAU,GAAG,EAAE;AACtB,UAAI,GAAG,GAAG,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAA;AACxC,UAAI,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAA;;AAEjC,UAAI,KAAK,GAAG,EAAC,GAAG,EAAH,GAAG,EAAE,IAAI,EAAJ,IAAI,EAAC,CAAA;AACvB,SAAG,CAAC,OAAO,EAAE,KAAK,CAAC,CAAA;;AAEnB,UAAI,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE;AAClB,eAAO,OAAO,CAAC,MAAM,CAAC,IAAI,KAAK,CAAC,eAAe,CAAC,CAAC,CAAA;OAClD;;AAED,aAAO,KAAK,CAAC,GAAG,CAAC,UAAU,EAAE,KAAK,CAAC,CAChC,IAAI,CAAC,YAAY;AAChB,eAAO,yBAAyB,GAAG,KAAK,CAAC,GAAG,GAAG,GAAG,GAAG,KAAK,CAAC,IAAI,CAAA;OAChE,CAAC,CAAA;KACL,CAAA;;;;;;;;AAQD,SAAO,aAAU,GAAG,EAAE;AACpB,SAAG,CAAC,KAAK,EAAE,GAAG,CAAC,UAAU,CAAC,CAAA;;AAE1B,aAAO,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,CACxB,IAAI,CAAC,YAAY;AAChB,8CAAqC;OACtC,CAAC,CAAA;KACL;;;;;;;;AAQD,YAAU,gBAAU,GAAG,EAAE;AACvB,SAAG,CAAC,QAAQ,EAAE,GAAG,CAAC,UAAU,CAAC,CAAA;;AAE7B,aAAO,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,CACxB,IAAI,CAAC,UAAU,KAAK,EAAE;AACrB,iDAAwC;OACzC,CAAC,CAAA;KACL;GACF,CAAA;CACF,CAAA;AACD,OAAO,CAAC,UAAU,CAAC,GAAG,CAAC,OAAO,EAAE,MAAM,EAAE,MAAM,CAAC,CAAA",
      "file": "/usr/src/app/src/commands.js",
      "sourcesContent": [
        "import _ from 'lodash-fp'\nimport debug from 'debug'\n\n// let error = debug('ephembot:commands')\nlet log = debug('ephembot:commands')\n// Make logs go to stdout instead of stderr\nlog.log = console.log.bind(console)\n\n// Injected dependencies\nexports = module.exports = function commandsModule (start, stop, stat) {\n  return {\n\n    /**\n     * Turns ephembot on with the default level of 15 minutes\n     *\n     * @return promise\n     * @example\n     *   /ephembot on\n     */\n    'on': function (cmd) {\n      log('on', cmd.channel_id)\n\n      return start(cmd.channel_id, {num: 15, unit: 'minutes'})\n        .then(function () {\n          return 'Ephemeral level set to 15 minutes'\n        })\n    },\n\n    /**\n     * Turns ephembot on with the provided level\n     *\n     * @example\n     *   /ephembot level 10 hours\n     */\n    'level': function (cmd) {\n      let num = Number(cmd.text.split(' ')[1])\n      let unit = cmd.text.split(' ')[2]\n\n      let level = {num, unit}\n      log('level', level)\n\n      if (_.isNaN(level)) {\n        return Promise.reject(new Error('Invalid level'))\n      }\n\n      return start(cmd.channel_id, level)\n        .then(function () {\n          return 'Ephemeral level set to ' + level.num + ' ' + level.unit\n        })\n    },\n\n    /**\n     * Turns ephembot off\n     *\n     * @example\n     *   /ephembot off\n     */\n    'off': function (cmd) {\n      log('off', cmd.channel_id)\n\n      return stop(cmd.channel_id)\n        .then(function () {\n          return `Ephembot has been turned off`\n        })\n    },\n\n    /**\n     * Returns the current level\n     *\n     * @example\n     *   /ephembot status\n     */\n    'status': function (cmd) {\n      log('status', cmd.channel_id)\n\n      return stat(cmd.channel_id)\n        .then(function (level) {\n          return `Level: {level.num} {level.unit}`\n        })\n    }\n  }\n}\nexports['@require'] = ['start', 'stop', 'stat']\n"
      ]
    },
    "ast": null,
    "mtime": 1430414558413
  },
  "/usr/src/app/test/integration/ephembot.test.js:{}:4.7.16": {
    "code": "\"use strict\";\n\nvar _interopRequire = function (obj) { return obj && obj.__esModule ? obj[\"default\"] : obj; };\n\n/* global describe it before after afterEach */\n\nvar expect = require(\"chai\").expect;\n\nvar fixture = _interopRequire(require(\"../fixture/get_history.fixture\"));\n\nvar nock = _interopRequire(require(\"nock\"));\n\nvar path = _interopRequire(require(\"path\"));\n\nvar IoC = _interopRequire(require(\"electrolyte\"));\n\nIoC.loader(IoC.node(path.resolve(__dirname, \"../../\")));\nIoC.loader(IoC.node(path.resolve(__dirname, \"../../src\")));\n\nvar app = IoC.create(\"index\");\nvar db = IoC.create(\"database\");\n\nvar CHANNEL_ID = \"UIJF3243\";\nvar res = {\n  ok: true,\n  channel: CHANNEL_ID,\n  ts: \"stub\"\n};\n\nvar request = require(\"supertest\")(app);\n\ndescribe(\"POST /ephemeral\", function () {\n  before(function () {\n    // nock.recorder.rec()\n    nock.enableNetConnect(/^.*127\\.0\\.0\\.1.*$/);\n  });\n\n  after(function () {\n    // nock.recorder.play()\n    nock.disableNetConnect(/^.*127\\.0\\.0\\.1.*$/);\n  });\n\n  afterEach(function () {\n    nock.cleanAll();\n  });\n\n  it(\"text=on&channel_id=\" + CHANNEL_ID + \" should turn ephembot on\", function (done) {\n    nock(\"https://slack.com\").filteringPath(function filteringPath(path) {\n      console.log(\"PATH\", path);\n      return path.match(/channels\\.history/g);\n    }).get(\"/api/channels.history?token=&channel=\" + CHANNEL_ID + \"&latest=XXX\").reply(200, fixture[0]);\n\n    nock(\"https://slack.com\").post(\"/api/chat.delete\").times(40).reply(200, res);\n\n    var body = \"text=on&channel_id=\" + CHANNEL_ID;\n    request.post(\"/ephemeral\").send(body).expect(200, function (err) {\n      if (err) return done(err);\n      db.findOne(CHANNEL_ID).then(function (data) {\n        expect(data).to.be.ok;\n        done(err);\n      });\n    });\n  });\n\n  it(\"should respond 400 to unsupported commands\", function (done) {\n    var body = \"text=butts&channel_id=\" + CHANNEL_ID;\n    request.post(\"/ephemeral\").send(body).expect(400, done);\n  });\n});\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi91c3Ivc3JjL2FwcC90ZXN0L2ludGVncmF0aW9uL2VwaGVtYm90LnRlc3QuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0lBRVEsTUFBTSxXQUFPLE1BQU0sRUFBbkIsTUFBTTs7SUFDUCxPQUFPLDJCQUFNLGdDQUFnQzs7SUFDN0MsSUFBSSwyQkFBTSxNQUFNOztJQUNoQixJQUFJLDJCQUFNLE1BQU07O0lBRWhCLEdBQUcsMkJBQU0sYUFBYTs7QUFDN0IsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQTtBQUN2RCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFBOztBQUUxRCxJQUFNLEdBQUcsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFBO0FBQy9CLElBQU0sRUFBRSxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUE7O0FBRWpDLElBQU0sVUFBVSxHQUFHLFVBQVUsQ0FBQTtBQUM3QixJQUFNLEdBQUcsR0FBRztBQUNWLE1BQU0sSUFBSTtBQUNWLFdBQVcsVUFBVTtBQUNyQixNQUFNLE1BQU07Q0FDYixDQUFBOztBQUVELElBQUksT0FBTyxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQTs7QUFFdkMsUUFBUSxDQUFDLGlCQUFpQixFQUFFLFlBQVk7QUFDdEMsUUFBTSxDQUFDLFlBQVk7O0FBRWpCLFFBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFBO0dBRTVDLENBQUMsQ0FBQTs7QUFFRixPQUFLLENBQUMsWUFBWTs7QUFFaEIsUUFBSSxDQUFDLGlCQUFpQixDQUFDLG9CQUFvQixDQUFDLENBQUE7R0FDN0MsQ0FBQyxDQUFBOztBQUVGLFdBQVMsQ0FBQyxZQUFZO0FBQ3BCLFFBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQTtHQUNoQixDQUFDLENBQUE7O0FBRUYsSUFBRSx5QkFBdUIsVUFBVSwrQkFBNEIsVUFBVSxJQUFJLEVBQUU7QUFDN0UsUUFBSSxDQUFDLG1CQUFtQixDQUFDLENBQ3RCLGFBQWEsQ0FBQyxTQUFTLGFBQWEsQ0FBRSxJQUFJLEVBQUU7QUFDM0MsYUFBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUE7QUFDekIsYUFBTyxJQUFJLENBQUMsS0FBSyxDQUFDLG9CQUFvQixDQUFDLENBQUE7S0FDeEMsQ0FBQyxDQUNELEdBQUcsMkNBQXlDLFVBQVUsaUJBQWMsQ0FDcEUsS0FBSyxDQUFDLEdBQUcsRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTs7QUFFekIsUUFBSSxDQUFDLG1CQUFtQixDQUFDLENBQ3RCLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUN4QixLQUFLLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQTs7QUFFNUIsUUFBSSxJQUFJLDJCQUF5QixVQUFVLEFBQUUsQ0FBQTtBQUM3QyxXQUFPLENBQ0osSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUNsQixJQUFJLENBQUMsSUFBSSxDQUFDLENBQ1YsTUFBTSxDQUFDLEdBQUcsRUFBRSxVQUFVLEdBQUcsRUFBRTtBQUMxQixVQUFJLEdBQUcsRUFBRSxPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQTtBQUN6QixRQUFFLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLElBQUksRUFBRTtBQUMxQyxjQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUE7QUFDckIsWUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFBO09BQ1YsQ0FBQyxDQUFBO0tBQ0gsQ0FBQyxDQUFBO0dBQ0wsQ0FBQyxDQUFBOztBQUVGLElBQUUsQ0FBQyw0Q0FBNEMsRUFBRSxVQUFVLElBQUksRUFBRTtBQUMvRCxRQUFJLElBQUksOEJBQTRCLFVBQVUsQUFBRSxDQUFBO0FBQ2hELFdBQU8sQ0FDSixJQUFJLENBQUMsWUFBWSxDQUFDLENBQ2xCLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FDVixNQUFNLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFBO0dBQ3JCLENBQUMsQ0FBQTtDQUNILENBQUMsQ0FBQSIsImZpbGUiOiIvdXNyL3NyYy9hcHAvdGVzdC9pbnRlZ3JhdGlvbi9lcGhlbWJvdC50ZXN0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZ2xvYmFsIGRlc2NyaWJlIGl0IGJlZm9yZSBhZnRlciBhZnRlckVhY2ggKi9cblxuaW1wb3J0IHtleHBlY3R9IGZyb20gJ2NoYWknXG5pbXBvcnQgZml4dHVyZSBmcm9tICcuLi9maXh0dXJlL2dldF9oaXN0b3J5LmZpeHR1cmUnXG5pbXBvcnQgbm9jayBmcm9tICdub2NrJ1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCdcblxuaW1wb3J0IElvQyBmcm9tICdlbGVjdHJvbHl0ZSdcbklvQy5sb2FkZXIoSW9DLm5vZGUocGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJy4uLy4uLycpKSlcbklvQy5sb2FkZXIoSW9DLm5vZGUocGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJy4uLy4uL3NyYycpKSlcblxuY29uc3QgYXBwID0gSW9DLmNyZWF0ZSgnaW5kZXgnKVxuY29uc3QgZGIgPSBJb0MuY3JlYXRlKCdkYXRhYmFzZScpXG5cbmNvbnN0IENIQU5ORUxfSUQgPSAnVUlKRjMyNDMnXG5jb25zdCByZXMgPSB7XG4gICdvayc6IHRydWUsXG4gICdjaGFubmVsJzogQ0hBTk5FTF9JRCxcbiAgJ3RzJzogJ3N0dWInXG59XG5cbmxldCByZXF1ZXN0ID0gcmVxdWlyZSgnc3VwZXJ0ZXN0JykoYXBwKVxuXG5kZXNjcmliZSgnUE9TVCAvZXBoZW1lcmFsJywgZnVuY3Rpb24gKCkge1xuICBiZWZvcmUoZnVuY3Rpb24gKCkge1xuICAgIC8vIG5vY2sucmVjb3JkZXIucmVjKClcbiAgICBub2NrLmVuYWJsZU5ldENvbm5lY3QoL14uKjEyN1xcLjBcXC4wXFwuMS4qJC8pXG5cbiAgfSlcblxuICBhZnRlcihmdW5jdGlvbiAoKSB7XG4gICAgLy8gbm9jay5yZWNvcmRlci5wbGF5KClcbiAgICBub2NrLmRpc2FibGVOZXRDb25uZWN0KC9eLioxMjdcXC4wXFwuMFxcLjEuKiQvKVxuICB9KVxuXG4gIGFmdGVyRWFjaChmdW5jdGlvbiAoKSB7XG4gICAgbm9jay5jbGVhbkFsbCgpXG4gIH0pXG5cbiAgaXQoYHRleHQ9b24mY2hhbm5lbF9pZD0ke0NIQU5ORUxfSUR9IHNob3VsZCB0dXJuIGVwaGVtYm90IG9uYCwgZnVuY3Rpb24gKGRvbmUpIHtcbiAgICBub2NrKCdodHRwczovL3NsYWNrLmNvbScpXG4gICAgICAuZmlsdGVyaW5nUGF0aChmdW5jdGlvbiBmaWx0ZXJpbmdQYXRoIChwYXRoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdQQVRIJywgcGF0aClcbiAgICAgICAgcmV0dXJuIHBhdGgubWF0Y2goL2NoYW5uZWxzXFwuaGlzdG9yeS9nKVxuICAgICAgfSlcbiAgICAgIC5nZXQoYC9hcGkvY2hhbm5lbHMuaGlzdG9yeT90b2tlbj0mY2hhbm5lbD0ke0NIQU5ORUxfSUR9JmxhdGVzdD1YWFhgKVxuICAgICAgLnJlcGx5KDIwMCwgZml4dHVyZVswXSlcblxuICAgIG5vY2soJ2h0dHBzOi8vc2xhY2suY29tJylcbiAgICAgIC5wb3N0KCcvYXBpL2NoYXQuZGVsZXRlJylcbiAgICAgIC50aW1lcyg0MCkucmVwbHkoMjAwLCByZXMpXG5cbiAgICBsZXQgYm9keSA9IGB0ZXh0PW9uJmNoYW5uZWxfaWQ9JHtDSEFOTkVMX0lEfWBcbiAgICByZXF1ZXN0XG4gICAgICAucG9zdCgnL2VwaGVtZXJhbCcpXG4gICAgICAuc2VuZChib2R5KVxuICAgICAgLmV4cGVjdCgyMDAsIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgaWYgKGVycikgcmV0dXJuIGRvbmUoZXJyKVxuICAgICAgICBkYi5maW5kT25lKENIQU5ORUxfSUQpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICBleHBlY3QoZGF0YSkudG8uYmUub2tcbiAgICAgICAgICBkb25lKGVycilcbiAgICAgICAgfSlcbiAgICAgIH0pXG4gIH0pXG5cbiAgaXQoJ3Nob3VsZCByZXNwb25kIDQwMCB0byB1bnN1cHBvcnRlZCBjb21tYW5kcycsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgbGV0IGJvZHkgPSBgdGV4dD1idXR0cyZjaGFubmVsX2lkPSR7Q0hBTk5FTF9JRH1gXG4gICAgcmVxdWVzdFxuICAgICAgLnBvc3QoJy9lcGhlbWVyYWwnKVxuICAgICAgLnNlbmQoYm9keSlcbiAgICAgIC5leHBlY3QoNDAwLCBkb25lKVxuICB9KVxufSlcbiJdfQ==",
    "map": {
      "version": 3,
      "sources": [
        "/usr/src/app/test/integration/ephembot.test.js"
      ],
      "names": [],
      "mappings": ";;;;;;IAEQ,MAAM,WAAO,MAAM,EAAnB,MAAM;;IACP,OAAO,2BAAM,gCAAgC;;IAC7C,IAAI,2BAAM,MAAM;;IAChB,IAAI,2BAAM,MAAM;;IAEhB,GAAG,2BAAM,aAAa;;AAC7B,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC,CAAC,CAAA;AACvD,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,EAAE,WAAW,CAAC,CAAC,CAAC,CAAA;;AAE1D,IAAM,GAAG,GAAG,GAAG,CAAC,MAAM,CAAC,OAAO,CAAC,CAAA;AAC/B,IAAM,EAAE,GAAG,GAAG,CAAC,MAAM,CAAC,UAAU,CAAC,CAAA;;AAEjC,IAAM,UAAU,GAAG,UAAU,CAAA;AAC7B,IAAM,GAAG,GAAG;AACV,MAAM,IAAI;AACV,WAAW,UAAU;AACrB,MAAM,MAAM;CACb,CAAA;;AAED,IAAI,OAAO,GAAG,OAAO,CAAC,WAAW,CAAC,CAAC,GAAG,CAAC,CAAA;;AAEvC,QAAQ,CAAC,iBAAiB,EAAE,YAAY;AACtC,QAAM,CAAC,YAAY;;AAEjB,QAAI,CAAC,gBAAgB,CAAC,oBAAoB,CAAC,CAAA;GAE5C,CAAC,CAAA;;AAEF,OAAK,CAAC,YAAY;;AAEhB,QAAI,CAAC,iBAAiB,CAAC,oBAAoB,CAAC,CAAA;GAC7C,CAAC,CAAA;;AAEF,WAAS,CAAC,YAAY;AACpB,QAAI,CAAC,QAAQ,EAAE,CAAA;GAChB,CAAC,CAAA;;AAEF,IAAE,yBAAuB,UAAU,+BAA4B,UAAU,IAAI,EAAE;AAC7E,QAAI,CAAC,mBAAmB,CAAC,CACtB,aAAa,CAAC,SAAS,aAAa,CAAE,IAAI,EAAE;AAC3C,aAAO,CAAC,GAAG,CAAC,MAAM,EAAE,IAAI,CAAC,CAAA;AACzB,aAAO,IAAI,CAAC,KAAK,CAAC,oBAAoB,CAAC,CAAA;KACxC,CAAC,CACD,GAAG,2CAAyC,UAAU,iBAAc,CACpE,KAAK,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC,CAAC,CAAC,CAAA;;AAEzB,QAAI,CAAC,mBAAmB,CAAC,CACtB,IAAI,CAAC,kBAAkB,CAAC,CACxB,KAAK,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC,GAAG,EAAE,GAAG,CAAC,CAAA;;AAE5B,QAAI,IAAI,2BAAyB,UAAU,AAAE,CAAA;AAC7C,WAAO,CACJ,IAAI,CAAC,YAAY,CAAC,CAClB,IAAI,CAAC,IAAI,CAAC,CACV,MAAM,CAAC,GAAG,EAAE,UAAU,GAAG,EAAE;AAC1B,UAAI,GAAG,EAAE,OAAO,IAAI,CAAC,GAAG,CAAC,CAAA;AACzB,QAAE,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,UAAU,IAAI,EAAE;AAC1C,cAAM,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAA;AACrB,YAAI,CAAC,GAAG,CAAC,CAAA;OACV,CAAC,CAAA;KACH,CAAC,CAAA;GACL,CAAC,CAAA;;AAEF,IAAE,CAAC,4CAA4C,EAAE,UAAU,IAAI,EAAE;AAC/D,QAAI,IAAI,8BAA4B,UAAU,AAAE,CAAA;AAChD,WAAO,CACJ,IAAI,CAAC,YAAY,CAAC,CAClB,IAAI,CAAC,IAAI,CAAC,CACV,MAAM,CAAC,GAAG,EAAE,IAAI,CAAC,CAAA;GACrB,CAAC,CAAA;CACH,CAAC,CAAA",
      "file": "/usr/src/app/test/integration/ephembot.test.js",
      "sourcesContent": [
        "/* global describe it before after afterEach */\n\nimport {expect} from 'chai'\nimport fixture from '../fixture/get_history.fixture'\nimport nock from 'nock'\nimport path from 'path'\n\nimport IoC from 'electrolyte'\nIoC.loader(IoC.node(path.resolve(__dirname, '../../')))\nIoC.loader(IoC.node(path.resolve(__dirname, '../../src')))\n\nconst app = IoC.create('index')\nconst db = IoC.create('database')\n\nconst CHANNEL_ID = 'UIJF3243'\nconst res = {\n  'ok': true,\n  'channel': CHANNEL_ID,\n  'ts': 'stub'\n}\n\nlet request = require('supertest')(app)\n\ndescribe('POST /ephemeral', function () {\n  before(function () {\n    // nock.recorder.rec()\n    nock.enableNetConnect(/^.*127\\.0\\.0\\.1.*$/)\n\n  })\n\n  after(function () {\n    // nock.recorder.play()\n    nock.disableNetConnect(/^.*127\\.0\\.0\\.1.*$/)\n  })\n\n  afterEach(function () {\n    nock.cleanAll()\n  })\n\n  it(`text=on&channel_id=${CHANNEL_ID} should turn ephembot on`, function (done) {\n    nock('https://slack.com')\n      .filteringPath(function filteringPath (path) {\n        console.log('PATH', path)\n        return path.match(/channels\\.history/g)\n      })\n      .get(`/api/channels.history?token=&channel=${CHANNEL_ID}&latest=XXX`)\n      .reply(200, fixture[0])\n\n    nock('https://slack.com')\n      .post('/api/chat.delete')\n      .times(40).reply(200, res)\n\n    let body = `text=on&channel_id=${CHANNEL_ID}`\n    request\n      .post('/ephemeral')\n      .send(body)\n      .expect(200, function (err) {\n        if (err) return done(err)\n        db.findOne(CHANNEL_ID).then(function (data) {\n          expect(data).to.be.ok\n          done(err)\n        })\n      })\n  })\n\n  it('should respond 400 to unsupported commands', function (done) {\n    let body = `text=butts&channel_id=${CHANNEL_ID}`\n    request\n      .post('/ephemeral')\n      .send(body)\n      .expect(400, done)\n  })\n})\n"
      ]
    },
    "ast": null,
    "mtime": 1430416798393
  }
}